{"componentChunkName":"component---src-templates-blog-post-js","path":"/team-secrets/","result":{"data":{"site":{"siteMetadata":{"title":"Ruairí's Blog"}},"markdownRemark":{"id":"08123e60-f164-5c3a-bdaa-13b0678bfb29","excerpt":"In this article I will be discussing a tool called pass. This article assumes you use a Unix style shell for development, so working on Mac, Linux, WSL or…","html":"<p>In this article I will be discussing a tool called <a href=\"https://www.passwordstore.org/\">pass</a>. This article assumes you use a Unix style shell for development, so working on Mac, Linux, WSL or similar.</p>\n<h2>TL;DR</h2>\n<p><a href=\"#command-summary\">Command Summary</a></p>\n<h2>Contents</h2>\n<ul>\n<li><a href=\"#why-pass\">Why Pass?</a></li>\n<li><a href=\"#secrets-while-developing\">Secrets While Developing</a></li>\n<li><a href=\"#a-sample-app\">A Sample App</a></li>\n<li><a href=\"#using-pass-to-help-with-local-development\">Using Pass to Help With Local Development</a></li>\n<li><a href=\"#backing-up-secrets\">Backing Up Secrets</a></li>\n<li><a href=\"#adding-a-team-member\">Adding a Team Member</a></li>\n<li><a href=\"#removing-a-team-member\">Removing a Team Member</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n<li><a href=\"#command-summary\">Command Summary</a></li>\n</ul>\n<h2>Why Pass? <a name=\"why-pass\"></a></h2>\n<p>Why use <a href=\"https://www.passwordstore.org/\">pass</a> and not some other tool like <a href=\"https://1password.com\">1password</a>, <a href=\"https://www.dashlane.com\">Dashlane</a> and others which maybe have more features and better platform support?</p>\n<p>Pass is free, open source and works on most systems that developers use. The ability to use it in your terminal and make it part of the workflow makes it a great tool for developers. If your company does pay for one of the other tools though, they might be a better choice for you. If not, <code class=\"language-text\">pass</code> is a great option.</p>\n<h2>Secrets While Developing <a name=\"secrets-while-developing\"></a></h2>\n<p>If you are building some software that talks to other software, there’s a good chance you are reading secrets in your code. If you are calling services with something like <a href=\"https://curl.se\">curl</a> you likely input commands similar to <code class=\"language-text\">curl -H \"Authorization: token my-super-secret-token\" https://some-auth-needing-service.com</code> into your terminal.</p>\n<p>If you work in a team and you have some development credentials your team uses, you have probably encountered issues with sharing and keeping track of those secrets.</p>\n<p>In this post we will look at <a href=\"https://www.passwordstore.org/\">pass</a> as an option to help with this. We will look at a potential local workflow that uses <code class=\"language-text\">pass</code> so you don’t ever need to store secrets in plaintext locally. Then we will look at how to share these secrets with your team in a way that’s reasonable enough to maintain.</p>\n<p>The next section will show a sample app to test out the methods we will use but feel free to skip that section if you don’t need to use a sample app.</p>\n<h2>A Sample App <a name=\"a-sample-app\"></a></h2>\n<p>We will use an app based on backstage.</p>\n<p><a href=\"https://github.com/backstage/backstage\">https://github.com/backstage/backstage</a></p>\n<p>This is a useful example as we can configure it to use GitHub auth to allow users to login and interact with GitHub. The actual sample app for this is here:</p>\n<p><a href=\"https://github.com/ruarfff/backstage-example\">https://github.com/ruarfff/backstage-example</a></p>\n<p>By default this example app is expecting 3 environment variables to exist.</p>\n<p><code class=\"language-text\">GITHUB_TOKEN</code>\n<code class=\"language-text\">AUTH_GITHUB_CLIENT_ID</code>\n<code class=\"language-text\">AUTH_GITHUB_CLIENT_SECRET</code></p>\n<p>They are referenced in the application configuration here:</p>\n<p><a href=\"https://github.com/ruarfff/backstage-example/blob/2ebd761ce316384f15165b506ce50ed67afa0515/app-config.yaml#L27\">GITHUB_TOKEN</a></p>\n<p><a href=\"https://github.com/ruarfff/backstage-example/blob/2ebd761ce316384f15165b506ce50ed67afa0515/app-config.yaml#L53-L56\">AUTH_GITHUB</a></p>\n<p>If you were deploying this to production you might use some kind of <a href=\"https://www.vaultproject.io\">vault</a>, <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">kube secrets</a> or something of that nature to load these into the environment. We won’t look at that here. Instead we will look at what you would do it you needed to get this running locally and wanted to use a development GitHub setup for it. Similar methods would apply to a broad range of problems like this.</p>\n<p>If you try to run the application you’ll get an error (a lot of unimportant output left out in the following example):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone git@github.com:ruarfff/backstage-example.git\ncd backstage-example\nyarn\nyarn dev\n\n[1] Backend failed to start up, Error: Failed to initialize github auth provider, Missing required config value at 'auth.providers.github.development.clientId'</code></pre></div>\n<p>To create secrets and follow along you will need a GitHub account. Go here <a href=\"https://github.com/settings/applications/new\">https://github.com/settings/applications/new</a></p>\n<p>Fill it in like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fd26d4830691372a7809bd4fdacc93db/9c177/1-gh-auth.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.35443037974683%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVklEQVQoz42STW6DMBCFcwHAYI9tjDEG82MMIcmiUrtrpd6lUhe9/7ITp6s2aSI9Izzyx3vjYUcKjuJlXVZWlDVKKhNfjFQNZeXlwFXtcGU5WDfN66lpx24M47xNYZvXo18OQpkMz1FxE04Jq23vw8ENAaBMCE2yAotJRtMcsrvOsrKD39t+7oagdFvEtFhH/cP/wOiMaVvngSuQGnUr6lXnZgqHblwq4y4YuqXR9r5zZTrrfNNO2DZ+CEWhJDk84EyYcZvfPw/rU9NvuCOsIUyTAh6KzdWo21XbBVQPpRPai6onBXsI1sbhbbs4ZJw2CM2lzlm8s/wOzHA8fjki75fTeWbYvwttv0DZpAhTWTB5HUYxUam6lZWR2nBlcOxMOaZGwPzKylj5y+8I5WnC5Pscvt7C56v7eKGjY3KIDQOJ/8lFN50JF5mUmTw/c4oVyKn4pb/wN+lSTOcNSqoAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Register OAuth App\"\n        title=\"Register OAuth App\"\n        src=\"/static/fd26d4830691372a7809bd4fdacc93db/f058b/1-gh-auth.png\"\n        srcset=\"/static/fd26d4830691372a7809bd4fdacc93db/c26ae/1-gh-auth.png 158w,\n/static/fd26d4830691372a7809bd4fdacc93db/6bdcf/1-gh-auth.png 315w,\n/static/fd26d4830691372a7809bd4fdacc93db/f058b/1-gh-auth.png 630w,\n/static/fd26d4830691372a7809bd4fdacc93db/9c177/1-gh-auth.png 880w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The local UI for the app is:</p>\n<p><code class=\"language-text\">http://localhost:3000</code></p>\n<p>The backend runs locally on port 7000 and the callback URL for it is:</p>\n<p><code class=\"language-text\">http://localhost:7000/api/auth/github/handler/frame</code></p>\n<p>On the next page generate a new client secret. Make note of the client id and the secret.</p>\n<p>You’ll need a token for creating repositories. Go here <a href=\"https://github.com/settings/tokens/new\">https://github.com/settings/tokens/new</a></p>\n<p>Creating a token that can work with repositories should be enough to test things out:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ecc0a19a9e0cb1e145754cd1bc5526a/9c177/2-token.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVQoz31S2U7DMBDsDzSHj/i+Nk4ctwVKJV74/w9j3SKggCqNVz52dsZr74gITCUbwMWFctWPrBu+MZBppOJf4NGOcBFSZlztO4JbAUqEcouQt0nafU+vhWg30n7kX2hkqVypL9bPbDKoPC91rU+5HBeM9RzzycHmoLpUbSzGg3EJk6UOjTwJY33zrFyik57Ls42bh4ONldtNOERtsIWriAkowCZNmGpkNPDjhiKtr1AuNh6pSB0xA7UNzPVEdQP5bRsHcm4NwAjLYS5PykSpozSR60hkohKYhJGbgfBr/id2PxdYxcMJb8GFwVbhxISsXJZ2psKPTD8io/MA23Y8u5DRmHEQYcUSzdfI72XuyZiB7+FjPj5fXGxk7GqAFYEd6h+Tb5jXw1JOQjmsZfxsQ0YXQvv+z4f5TcatlDfIVWqPS2mCtlGZoCz2L+DzPCIjDqfz5e0dxdGnT0vKtf22uVVs+vfmPwBy0EUpVyHNuwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Create Token\"\n        title=\"Create Token\"\n        src=\"/static/4ecc0a19a9e0cb1e145754cd1bc5526a/f058b/2-token.png\"\n        srcset=\"/static/4ecc0a19a9e0cb1e145754cd1bc5526a/c26ae/2-token.png 158w,\n/static/4ecc0a19a9e0cb1e145754cd1bc5526a/6bdcf/2-token.png 315w,\n/static/4ecc0a19a9e0cb1e145754cd1bc5526a/f058b/2-token.png 630w,\n/static/4ecc0a19a9e0cb1e145754cd1bc5526a/9c177/2-token.png 880w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Take note of the token.</p>\n<p>How did you take note of those secrets? Are they secret? Are they safe? Hopefully you have a good way of storing secrets already. If you aren’t using <code class=\"language-text\">pass</code>, the next section will take a look at that and maybe you’ll also consider it a useful tool for this kind of thing.</p>\n<h2>Using Pass to Help With Local Development <a name=\"using-pass-to-help-with-local-development\"></a></h2>\n<p>Install pass. I am on mac so did:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install pass</code></pre></div>\n<p>For Debian it’s:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt-get install pass</code></pre></div>\n<p>See the <a href=\"https://www.passwordstore.org/\">pass site</a> for instructions about installing on other platforms.</p>\n<p>Now we will set up a <a href=\"https://gnupg.org\">gpg</a> key. This is what we will use for encryption in pass. I found <a href=\"https://sanctum.geek.nz/arabesque/gnu-linux-crypto-gnupg-keys/\">this article</a> good for learning more about gpg.</p>\n<p>Now pick a good passphrase. From now on I will refer to that as <code class=\"language-text\">$PASSPHRASE</code>. You will be asked to enter it while creating your key.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --gen-key</code></pre></div>\n<p>Check the key:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --list-keys</code></pre></div>\n<p>You should see something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/you/.gnupg/pubring.kbx\n----------------------------------------------------\npub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]\n      AB3A5ED268BD87CD06F8F30B6881F49AF5BB8EAD\nuid           [ultimate] you &lt;you@email.com>\nsub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]</code></pre></div>\n<p>Now copy the ID for that key. In the example above the ID is <code class=\"language-text\">AB3A5ED268BD87CD06F8F30B6881F49AF5BB8EAD</code>. From now on we will refer to that as <code class=\"language-text\">$GPG_KEY</code>.</p>\n<p>Now we will setup pass. Note, by default pass uses <code class=\"language-text\">~/.password-store</code>. If you want to keep your personal password store and your team one separate, you can configure separate directories.</p>\n<p>The directory pass uses can be configured like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export PASSWORD_STORE_DIR=~/.work-password-store</code></pre></div>\n<p>Example of an alias to use:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">alias workpass='PASSWORD_STORE_DIR=~/.work-password-store pass'</code></pre></div>\n<p>If you decide to use an alias, replace <code class=\"language-text\">pass</code> with <code class=\"language-text\">workpass</code> (or whatever alias you setup) in all the following examples.</p>\n<p>Initialise pass:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass init $GPG_KEY</code></pre></div>\n<p>Earlier, if you followed along, you created a GitHub token. Save the token with pass like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass insert GitHub/backstage-example-token\nEnter password for GitHub/backstage-example-token:</code></pre></div>\n<p>You can get the token back again:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass GitHub/backstage-example-token</code></pre></div>\n<p>You will be prompted for a password the first time when reading a value from pass and again after the login times out.</p>\n<p>Use the token, extracting from pass, like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -H \"Authorization: token $(pass GitHub/backstage-example-token)\" -H \"Accept: application/vnd.github.v3+json\" https://api.github.com/user/repos</code></pre></div>\n<p>One advantage of this approach is you do not have to store the token in plaintext at any point or have it visible on your screen as you use the terminal. If you type <code class=\"language-text\">history</code> you won’t see any record of the password.</p>\n<p>In our example application we need 2 more secrets.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass insert GitHub/backstage-example-client-id</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass insert GitHub/backstage-example-client-secret</code></pre></div>\n<p>There’s a lot of ways you could use these secrets now to run our sample app. I propose this one. Add a file somewhere on your machine or even in the repo with this content:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export GITHUB_TOKEN=\"$(pass GitHub/backstage-example-token)\"\nexport AUTH_GITHUB_CLIENT_ID=\"$(pass GitHub/backstage-example-client-id)\"\nexport AUTH_GITHUB_CLIENT_SECRET=\"$(pass GitHub/backstage-example-client-secret)\"</code></pre></div>\n<p>In the following example I assume you created a file in the project directory with that content. Now run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">source secrets &amp;&amp; yarn dev</code></pre></div>\n<p>All going well, you should have a login page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c6d4c29fc7e34e45de742393b8185db9/9c177/3-oauth-app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQY09WLzQ6CMBCE+9ae9AEUhRiNJ7xhigi1RF4M2l1M+uO2xotBPTv5sjubnWEbUaayymS1bS+7W5M0fFHkxOx4WNanfXfN2jqV57UoE8HJPP1K8HmRM29twAScMcE7T9wRnSMXRds6T6d9EV9Maf3GoBVNjTjQBOhh7BVMxJRi+FljBKImA9/KP/Wn5QfVl7vYUvRilgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Backstage login\"\n        title=\"Backstage login\"\n        src=\"/static/c6d4c29fc7e34e45de742393b8185db9/f058b/3-oauth-app.png\"\n        srcset=\"/static/c6d4c29fc7e34e45de742393b8185db9/c26ae/3-oauth-app.png 158w,\n/static/c6d4c29fc7e34e45de742393b8185db9/6bdcf/3-oauth-app.png 315w,\n/static/c6d4c29fc7e34e45de742393b8185db9/f058b/3-oauth-app.png 630w,\n/static/c6d4c29fc7e34e45de742393b8185db9/9c177/3-oauth-app.png 880w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f042d6a34f000567bab37cdde46d8454/71ce0/4-popup.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 174.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAIAAAAblL1PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEf0lEQVRIx5VVW28bRRT2j+CdFySQqPJQEnJr2pRKVQlFLQgJ8YCAIgoFIRClEjwVERSiAgWlDVUdI5w4ikMSciFRKKUXNepDEsdOnEsTJ41vu469F19317uzM7vLWS9x7MQW4ujzeG7fzPnOzJm1vf3Vl8Ourovub9qHnDfHf7dPjXaPDnX2/XJ10PVdf29nr1npcDquDvbbp8bsk6OO6QnnrUnX7WnH1Ljtwhef37/x/ZX+Doe7b/i3ocHBQeevvV1d1+w37d3dP3ddu27v6YGyp8cBQ+6BAZfLNTDgBnP2uWxPtjafOH7y7JnX2tpOnzrV1tLS+nx9Y0Njc0NDU21dQ31DM9SbW441NR2BSmPjkWcP1dTW1R9+ru5wXb2tb2oim0xFKSpm2g5Nm39Q0jTNskyS56FOUXTBYtYoNKEMhsI2nuMNw9B13SgxqxmlYnMer1HFNE2zcRxn1fQSgx5BEMf+mL57f2Z2fgGahJDyCbqqYhvPV9gZDGO89mjDs7AYjlBVJhAbw7IVx6xOrVL/HpmizIVhEjheCkxMKbACTCLlQ9ZOJjmZTJqSNE2SFUlGFkQZ6QZh0/nNSJZoWEGqmN8dykML/0u2AlZKFiRF18noPbrm9btPv3rnvXZvVlSAYvHLyEwiUUqGGTAY58WWczPvdqx82x+qfXPGMRYEZTlJOUBmmHKyggkORDLPvPL3TyPUvRXh6PmHl2+s/DcZBgCm24b2Uaf/iRf+rHnjwVNn7qwFc6A8J8rWhApkUVZkhAGKShiOi8aY6wOrl36YvfVgNZGIA1MlOsKwB0Kows4olclxyTTLp5bX1peWV4PBrWAwMO+Zn3k4G6FiCZaPxZmsICGVlJOJJikoSu8EtrbXA1tb2yGoL/iWPd4l39KKb2n50cYm1D3exWQ6q2LNuoJlmotuQ5lXVFhibsEHvlg9UJa7XUaGY1SL9wQAfAtWnIrYDVgJWczL6ayQyYlQgjCrAlEACJK8d/kORhuuK4jxLvqX/KsLi/7A4+CifxViNufxzc57w1E6j7AA21Y+50LAqqUQ5ALkiQVQoaADZFjRTKICVExUjE3Aj2CTbkCEATpSD5DBbdAG4d0ORUIRCjRbGZKXlURSWg/ntmPCZjS3EcnRrAihKiNDlgIhGIo8DoLAnWKE8jLKCArNSHE+v8ObZTIrq2oVty0jukbMV8T8Qf7vqjGhqBU0E1lRDbh2FgoCNQzP3F7TAla1/WSwAEe9PHHxxbFPXhr/tK2Ad/76+tzt9rOTl6ATmqcnPmsd+aDbNwIe6IXnaY+8zkZOjHx4dOh86/D7xwoAMuDk6MfQCc3jIxfq3G/96HHvJ8MNQ0gFJzWka8goQFdkLMsYQ49q9ZgqMNLgIPcfFciGJYxCWIqPbwF7is04aEQrvp67R2XSIF9C4QjHwfeJDoVDcSZJsygclxMpFONQlFGyIi5OLkkMc1e4fSSdyUiSJAhCJpsRpXxOwumcKkjwBuGMAG8wsXwsI+vVvwzVDHazRaPRVCrF/E9jWRY+cv8AGbpIiO0MnOsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GitHub OAuth popup\"\n        title=\"GitHub OAuth popup\"\n        src=\"/static/f042d6a34f000567bab37cdde46d8454/71ce0/4-popup.png\"\n        srcset=\"/static/f042d6a34f000567bab37cdde46d8454/c26ae/4-popup.png 158w,\n/static/f042d6a34f000567bab37cdde46d8454/6bdcf/4-popup.png 315w,\n/static/f042d6a34f000567bab37cdde46d8454/71ce0/4-popup.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/610014fe98cfc13c1df896c5ef877703/c946b/5-backstage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACW0lEQVQoz02Q2U8TURTG51nUNx8awZcWok2JSyoYVGSr0CJKiG0TaYxijBSjAaaltbTDIgVDYtE/xvhijApqQaQsTVtJYLrTVugMNjD7XM+AJJ788uW7Z+75Tu5gFTptlaHB/PqlLeDvDvjvTo/aZvzm6TGzYibbx18YRhxdr4i20aFzTx+U95grHlnLeyyn7neWWY2Y6mzlmca6O4Hx7jeTlpmJzmkCgtqnho1+jyUwAXqDGDRNeup9A6cfW4/daz9u6zhpu13WfeuErQNTqVTapuumKa9pzN064jSOuWFVw3B/sw9v8g62+PBm3+BV1zM93luD22udfTUO+2X8Sb3nedcUgWm1WoIgEEL5/JYgcALP8tw+QjKoKHKyLHLcvsAxYCSRF3gGIekAGcAuXbxAECM5Gi2Et8KbVCxOR0jqV2I3sklFSToWB1OMkMX15J/1VCmW2IVPik+C7mK1+vNOl6f/7VpT/1zr0OJNx3ybc8GABw2OYAs+36KY+WZ8oa73g/7hu2v2j40DwVr71yt9ClhVpcbpHArFcu+/RD79IIOrGeD7aubbSlph+UBXMrM/E58XybmlBHRml/6BqdVql8tVyGfDq6GtTFISWJFnQJEsHj4MSQL8AYQEhEQkC0jiFT0A0+l0Xq83m82GQsuJRJIk4xsbm7lcvkhR6XQmmUwxLAsZkiwrSbIs/QdWXV0NwzRNR6OxVCpdKpUoiioWYZYqFArQFwTYqRTLsqIooqOSJAnTaDRutxu6sBwGOI5jGAYifm9vUzQNl/ij2tnZ2dvbg6zDI1z7C/u1ywFjUK9QAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Logged in\"\n        title=\"Logged in\"\n        src=\"/static/610014fe98cfc13c1df896c5ef877703/f058b/5-backstage.png\"\n        srcset=\"/static/610014fe98cfc13c1df896c5ef877703/c26ae/5-backstage.png 158w,\n/static/610014fe98cfc13c1df896c5ef877703/6bdcf/5-backstage.png 315w,\n/static/610014fe98cfc13c1df896c5ef877703/f058b/5-backstage.png 630w,\n/static/610014fe98cfc13c1df896c5ef877703/c946b/5-backstage.png 805w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Backing Up Secrets <a name=\"backing-up-secrets\"></a></h2>\n<p>I did make a comment earlier that you shouldn’t store secrets in a git repo (even a private one) but it can be OK to store encrypted secrets in one. As long as you don’t store the key along with it of course. Pass does store structural data like the name of the secret so be aware of that when using with git. <strong>The secrets are encrypted but the names are not</strong>.</p>\n<p>For this next step you should have a remote git repository you feel comfortable using to backup encrypted secrets.</p>\n<p>Type:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass git init</code></pre></div>\n<p>Add an origin as in this example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass git remote add origin git@github.com:you/your-pass.git</code></pre></div>\n<p>To sync all those secrets we created already do:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass git push -u --all</code></pre></div>\n<p>For subsequent updates do:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass git push</code></pre></div>\n<p>You should now see the encrypted secrets up in the repo.</p>\n<p>Here’s an example in a temporary GitHub repo I created for this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/427917a686929fa726c2b8f86949f3ba/9c177/6-repo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVQY02WQa26EMAyEuUB3gSROHMd5QKGLWvX+x+uEtvzYlT4cJ9ZoPAzOi3GMSiEZy+QjrhTUUvSc+zurCwn9ONMTw2Q8jtmy6EKcZ19YKpS30d4nd/Gq7GJ8mFkv6+OztA+pR3s/UllDzMCfYBF4PPEnHidniEkyNvScfleFf4ili1mR6NUW+uG6SF7q+ijLjgrl293cJou0nGqQErUhF2uLWvECg3/nnjlAsx3f6/4FtO42qCGJec1tT3XTuqFBRZ/KxqlhOlw7IBgcfI9aZsf4hcCSwNz5k6CdszcuYvoD7zknukrE52MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Secrets backed up\"\n        title=\"Secrets backed up\"\n        src=\"/static/427917a686929fa726c2b8f86949f3ba/f058b/6-repo.png\"\n        srcset=\"/static/427917a686929fa726c2b8f86949f3ba/c26ae/6-repo.png 158w,\n/static/427917a686929fa726c2b8f86949f3ba/6bdcf/6-repo.png 315w,\n/static/427917a686929fa726c2b8f86949f3ba/f058b/6-repo.png 630w,\n/static/427917a686929fa726c2b8f86949f3ba/9c177/6-repo.png 880w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Adding a Team Member <a name=\"adding-a-team-member\"></a></h2>\n<p>For now let’s assume you want to share that secret store we just created with another team member. We will go through each step required to allow that. It’s a bit tedious but only needs to be done once per team member. We will look at adding members as readonly and as read/write.</p>\n<h3>Readonly</h3>\n<p>For a new team member to get setup they must:</p>\n<ul>\n<li>Setup a gpg key</li>\n<li>Export and send the public key to you</li>\n<li>Install pass</li>\n</ul>\n<p>Then you must:</p>\n<ul>\n<li>Trust their key</li>\n<li>Re-encrypt the store with the new key</li>\n<li>Push the updated store to the git repo</li>\n</ul>\n<p>Then they must:</p>\n<ul>\n<li>Clone the pass store (or pull down the updates if they cloned already)</li>\n</ul>\n<h3>Tutorial of those steps</h3>\n<p>Assuming our new team member has already generated a key, they will run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --list-keys</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/your-colleague/.gnupg/pubring.kbx\n----------------------------------------------------\npub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]\n      C351DB397FDFFD4499AB760435C0B93754D6ACD0\nuid           [ultimate] your-colleague &lt;your-colleague@email.com>\nsub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]</code></pre></div>\n<p>They must copy the ID for the key to export it as in this example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --export --armor C351DB397FDFFD4499AB760435C0B93754D6ACD0 > pass-publickey.asc</code></pre></div>\n<p>Now they must send the key file to you. It is reasonably safe to send a public key over email or chat but if you have a secure way to share the key, even better.</p>\n<p>Next they can clone the store. This example clones to the default password store directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone git@github.com:you/your-pass.git ~/.password-store</code></pre></div>\n<p>If the team member already uses pass or wants to keep the team and personal stores separate, they can use the method we looked at before:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone git@github.com:you/your-pass.git ~/.work-password-store\n\nalias workpass='PASSWORD_STORE_DIR=~/.work-password-store pass'</code></pre></div>\n<p>At this point they will be able to list the secrets but not read them:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass\nPassword Store\n├── GitHub\n│   ├── backstage-example-client-id\n│   ├── backstage-example-client-secret\n│   └── backstage-example-token</code></pre></div>\n<p>The next step is done on your machine.</p>\n<p>Assume your team members sent you their public key in a file called <code class=\"language-text\">pass-publickey.asc</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --import pass-publickey.asc\n\ngpg --list-keys</code></pre></div>\n<p>You should see an output with something similar to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/you/.gnupg/pubring.kbx\n----------------------------------------------------\npub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]\n      AB3A5ED268BD87CD06F8F30B6881F49AF5BB8EAD\nuid           [ultimate] you &lt;you@email.com>\nsub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]\n\npub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]\n      C351DB397FDFFD4499AB760435C0B93754D6ACD0\nuid           [unknown] your-colleague &lt;your-colleague@email.com>\nsub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]</code></pre></div>\n<p>You have added the key for ‘your-colleague’. We now need to trust the key. Notice that your key has <code class=\"language-text\">[ultimate]</code> but the new one has <code class=\"language-text\">[unknown]</code>. Also note the ID for the new key. That’s <code class=\"language-text\">C351DB397FDFFD4499AB760435C0B93754D6ACD0</code> in the example above. From now on we will refer to that key as <code class=\"language-text\">$GPG_ID</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export GPG_ID='C351DB397FDFFD4499AB760435C0B93754D6ACD0'</code></pre></div>\n<p>Edit the key. This will activate and interactive session with gpg.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --edit-key $GPG_ID</code></pre></div>\n<p>Type the trust command:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg> trust</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pub  rsa3072/35C0B93754D6ACD0\n     created: 2020-11-02  expires: 2022-11-02  usage: SC\n     trust: unknown      validity: unknown\nsub  rsa3072/84E6664F5F6A5734\n     created: 2020-12-16  expires: 2022-12-16  usage: E\n[unknown] (1). your-colleague &lt;your-colleague@email.com>\n\nPlease decide how far you trust this user to correctly verify other users' keys\n(by looking at passports, checking fingerprints from different sources, etc.)\n\n  1 = I don't know or won't say\n  2 = I do NOT trust\n  3 = I trust marginally\n  4 = I trust fully\n  5 = I trust ultimately\n  m = back to the main menu\n\nYour decision? 5</code></pre></div>\n<p>Say yes until it is accepted and then exit gpg.</p>\n<blockquote>\n<p>Do you really <strong>need</strong> <code class=\"language-text\">ultimate</code>? You do not necessarily need it but it will get very annoying if you use a lower level of trust so I would say just go with ultimate.</p>\n</blockquote>\n<p>Now you need to update the password store with the new key as in this example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass init `cat $PASSWORD_STORE_DIR/.gpg-id` $GPG_ID</code></pre></div>\n<p>That command is short hand for listing every public key ID in the init command. We store the ID for each public key, representing each team member, in the <code class=\"language-text\">.gpg-id</code> file in the repo. This command will add the new public key ID to the <code class=\"language-text\">.gpg-id</code> file and re-encrypt the store. This will allow your team member to decrypt the store with their key but they will not be able to encrypt.</p>\n<p>Run <code class=\"language-text\">pass git push</code></p>\n<p>Your team member can now run <code class=\"language-text\">pass git pull</code> or just do a <code class=\"language-text\">git pull</code> in the password store directory.</p>\n<p>Now your team member can run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass GitHub/backstage-example-token</code></pre></div>\n<p>They should see the decrypted secret.</p>\n<h3>Read/Write</h3>\n<p>To allow your team member to encrypt the store they must have trusted all the public keys in the <code class=\"language-text\">.gpg-id</code> file. Their own public key must also have been trusted on the machine that encrypted the store last. We essentially need to setup a circle of trust with gpg keys.</p>\n<p>I think it’s reasonable to actually commit all public gpg keys to the pass store repository to make it easy for a new team member to go through and trust each one. It’s possible to script this although I don’t have a good script handy since gpg edit is interactive and I haven’t used this in a team big enough where it was too annoying to trust each key one by one.</p>\n<p>So to get write access, you follow the same steps that we did for <a href=\"#readonly\">Readonly</a> but with an additional step to trust all existing public keys on the machine that wants write permissions.</p>\n<p>All those steps are true for every new member we add. Everyone must have all the public keys and have trusted them.</p>\n<h2>Removing a Team Member <a name=\"removing-a-team-member\"></a></h2>\n<p>If you ever need to remove a team member, remove their public key from the <code class=\"language-text\">.gpg-id</code> file and re-encrypt the store.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass init `cat $PASSWORD_STORE_DIR/.gpg-id`</code></pre></div>\n<h2>Conclusion <a name=\"conclusion\"></a></h2>\n<p>From this point on the secret store will work as a git repository and all the considerations will apply there around keeping in sync and handling conflicts. You may want to protect the main branch and use pull requests for modifying secrets for example.</p>\n<p>Of course consider some good practices here. I would not use this to store highly sensitive data or production credentials. There’s always a risk someone can get hold of this but that is always the case. At least keeping the data encrypted at rest gives you the best chance of avoiding accidental leaks during a normal development workflow.</p>\n<p>This is one method I have seen evolve over years of dealing with secrets in teams. I hope this description helps. If you have more interesting ways of doing this I would love to hear about them! Also if you see something I got wrong here, I’d really appreciate if you let me know.</p>\n<h2>Command Summary <a name=\"command-summary\"></a></h2>\n<h3>Setting up a new pass store</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --gen-key</code></pre></div>\n<p>Check the key:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --list-keys</code></pre></div>\n<p>You need to copy the key ID. This gets just the key IDs:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --list-keys --with-colons | grep fpr | cut -d: -f10</code></pre></div>\n<p>Setup pass:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export GPG_KEY='you-key-id'\npass init $GPG_KEY\npass insert some-secret\npass git init\npass git push -u --all</code></pre></div>\n<h3>Getting read access to an existing store</h3>\n<p>Generate a gpg key as above.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --export --armor $GPG_KEY > pass-publickey.asc</code></pre></div>\n<p>Send <code class=\"language-text\">pass-publickey.asc</code> to someone who can decrypt the store.</p>\n<p><strong>On their machine:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --import pass-publickey.asc\ngpg --edit-key $GPG_ID\n\ngpg> trust</code></pre></div>\n<p>Trust the key ultimately.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass init `cat $PASSWORD_STORE_DIR/.gpg-id` $GPG_ID\npass git push</code></pre></div>\n<p><strong>Back on your machine:</strong></p>\n<p>Either:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone git@github.com:you/your-pass.git ~/.password-store</code></pre></div>\n<p>or if you already setup the repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pass git pull</code></pre></div>\n<h3>Getting write access to an existing store</h3>\n<p>Same as read access but you also need to trust each public key in <code class=\"language-text\">.gpg-id</code>. Either each team member send you their exported key or you have them stored in one place. Maybe in the pass store repo itself?</p>\n<p><strong>For each gpg key:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gpg --import ${the-key-file}\ngpg --edit-key $GPG_ID\n\ngpg> trust</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>","frontmatter":{"title":"Managing local app secrets and sharing secrets with your team","date":"January 11, 2021","description":"Storing application secrets locally in plain text can be risky and lead to them being accidentally committed to repositories. Sharing secrets across a team can be a pain too. This post describes one solution that could help."}},"previous":{"fields":{"slug":"/tech-stuff-found-2nd-half-2020/"},"frontmatter":{"title":"Tech stuff found in the second half of 2020"}},"next":{"fields":{"slug":"/github-codespaces/"},"frontmatter":{"title":"Using Devcontainer With GitHub Codespaces"}}},"pageContext":{"id":"08123e60-f164-5c3a-bdaa-13b0678bfb29","previousPostId":"f1690744-cb13-568f-88a2-43e44b8980cc","nextPostId":"27bb0dd0-f3e5-5af0-80a2-4e2b2568e5a5"}},"staticQueryHashes":["2841359383","916993862"]}