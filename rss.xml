<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Ruarfff blog]]></title><description><![CDATA[A blog.]]></description><link>https://ruarfff.com</link><generator>GatsbyJS</generator><lastBuildDate>Tue, 06 Sep 2022 23:14:18 GMT</lastBuildDate><item><title><![CDATA[Understanding python async with FastAPI]]></title><description><![CDATA[Writing asynchronous code in python is quite powerful and can perform pretty well if you use something like uvloop: uvloop makes asyncio…]]></description><link>https://ruarfff.com/understanding-python-async/</link><guid isPermaLink="false">https://ruarfff.com/understanding-python-async/</guid><pubDate>Fri, 26 Aug 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Writing asynchronous code in python is quite powerful and can perform pretty well if you use something like &lt;a href=&quot;https://uvloop.readthedocs.io/&quot;&gt;uvloop&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;uvloop makes asyncio fast. In fact, it is at least 2x faster than nodejs, gevent, as well as any other Python asynchronous framework. The performance of uvloop-based asyncio is close to that of Go programs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Writing asynchronous code in python is also pretty easy to mess up.&lt;/p&gt;
&lt;p&gt;This post is an attempt to understand async python a little better and make it easier to spot the common mistakes.&lt;/p&gt;
&lt;p&gt;There’s a repo if you’d like to have the code examples: &lt;a href=&quot;https://github.com/ruarfff/understanding-python-async&quot;&gt;https://github.com/ruarfff/understanding-python-async&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In this post we will look at:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;async/concurrent vs parallel&lt;/li&gt;
&lt;li&gt;interesting things to know about async in python&lt;/li&gt;
&lt;li&gt;async with FastAPI&lt;/li&gt;
&lt;li&gt;what do do if something you use doesn’t support async&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Coding along&lt;/h2&gt;
&lt;p&gt;Grab the sample code:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:ruarfff/understanding-python-async.git &amp;amp;&amp;amp; cd understanding-python-async&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;You should also have &lt;a href=&quot;https://curl.se/&quot;&gt;curl&lt;/a&gt; installed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can use docker (recommended) or setup your own python environment.&lt;/p&gt;
&lt;h3&gt;With docker&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;make build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Without docker&lt;/h3&gt;
&lt;p&gt;If you’re not using docker, make sure to have python &gt;= 3.8 installed.&lt;/p&gt;
&lt;p&gt;You should be using a unix like shell e.g. Linux, Mac, WSL.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/pyenv/pyenv&quot;&gt;pyenv&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pyenv install 3.10.6

pyenv global 3.10.6&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Setup a &lt;a href=&quot;https://docs.python.org/3/library/venv.html&quot;&gt;virtual environment&lt;/a&gt; and run all commands in this context&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;python -m venv ./.venv

source .venv/bin/activate&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Install requirements &lt;code class=&quot;language-text&quot;&gt;pip install -r requirements.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In the examples below, runt he python scripts directly instead of using &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Async Vs Parallel&lt;/h2&gt;
&lt;p&gt;Parallel and asynchronous are not the same thing. If you have a good mental model for async vs parallel feel free to skip this section.&lt;/p&gt;
&lt;p&gt;When I was in college I wrote a mobile game. I had to learn about &lt;a href=&quot;https://gameprogrammingpatterns.com/game-loop.html&quot;&gt;the game loop&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Within the loop, I had code to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;process inputs&lt;/li&gt;
&lt;li&gt;update the game state based on reactions to inputs and existing algorithms&lt;/li&gt;
&lt;li&gt;render the game&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It was all perfectly synchronous so I couldn’t have anything take too long or the game would become unplayable. I became obsessed with improving performance but I always hit limits. I was attempting to render at 30FPS (frames per second meaning the loop must carry out all processing at least 30 times per second). Every time I coded up a new game agent or increased the number of agents on the screen, the FPS would suffer and I’d go mad trying to figure out how to optimise performance again. Then one day, I discovered the joy and pain of async programming.&lt;/p&gt;
&lt;p&gt;Mobile games ran on a single processor but using threading, you could simulate parallelism. It was, in fact, asynchronous but you didn’t really have to think too hard about scheduling the threads. You hand that job over to the operating system. It did make things a lot more complicated and harder to understand though and that’s the major tradeoff.&lt;/p&gt;
&lt;p&gt;This might be fairly inaccurate but I like to think of asyncio (and its Cython-based friend uvloop) as a sort of game loop. It’s not running in parallel but the loop will keep looping if you don’t block it. If you do block it, you mess the whole thing up.&lt;/p&gt;
&lt;p&gt;Where that mental model breaks down is when we think about CPU bound VS IO-bound.&lt;/p&gt;
&lt;p&gt;Asynchronous code makes sense when there’s a lot of waiting or the code is IO-Bound. It’s somewhat more intuitive. Like when you are coding. Consider an example flow:&lt;/p&gt;
&lt;h4&gt;Task - get some code to production&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;you write some code&lt;/li&gt;
&lt;li&gt;run and test the code&lt;/li&gt;
&lt;li&gt;commit and push the code&lt;/li&gt;
&lt;li&gt;watch the build pipeline&lt;/li&gt;
&lt;li&gt;get distracted and start chatting on slack/teams&lt;/li&gt;
&lt;li&gt;go for lunch&lt;/li&gt;
&lt;li&gt;remember you had a build pipeline running&lt;/li&gt;
&lt;li&gt;test the deployment&lt;/li&gt;
&lt;li&gt;done&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are steps you don’t wait for e.g. watching the build pipeline. This is asynchronous and frees you up to do other things. It’s not necessarily more efficient but it’s better than sitting there waiting for the build pipeline to finish. You got other tasks done while also getting the code to production.&lt;/p&gt;
&lt;p&gt;A build pipeline has steps that can be run in &lt;strong&gt;parallel&lt;/strong&gt; e.g. testing and linting. This can be done in parallel if we give each step all its own resources and a dedicated machine. We could do all the steps &lt;strong&gt;asynchronously&lt;/strong&gt; on one large machine but we can use many smaller, cheaper machines to do the work in parallel.&lt;/p&gt;
&lt;p&gt;You can think of async as one resource doing many things at once and figuring out how not to wait for each thing to be finished. Parallel processing is multiple resources each working on separate tasks or parts of a task.&lt;/p&gt;
&lt;p&gt;Throughout the rest of this post, we will be focusing on the asynchronous model. When writing python apps with a framework like FastAPI, we are generally doing IO-Bound work e.g. downstream requests, reading databases, files etc. The asynchronous model is most useful in this case.&lt;/p&gt;
&lt;p&gt;We will focus primarily on the patterns for using &lt;a href=&quot;https://docs.python.org/3/library/asyncio-task.html&quot;&gt;coroutines&lt;/a&gt; and async/await.&lt;/p&gt;
&lt;h2&gt;Example of async code using asyncio&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; asyncio
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; datetime
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; time

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; colorama &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; init
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; colorama &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Back&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Style


&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GREEN &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Starting synchronous work.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    synchronous_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    synchronous_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    end_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start_time

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GREEN
        &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE
        &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Ending synchronous work. Total time: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;end_time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;total_seconds&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token format-spec&quot;&gt; .2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MAGENTA &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Starting awaiting async functions.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; async_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTYELLOW_EX &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; async_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTRED_EX &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    end_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start_time

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MAGENTA
        &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE
        &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Ending awaiting async functions. Total time: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;end_time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;total_seconds&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token format-spec&quot;&gt; .2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTBLUE_EX &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Starting running async.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    tasks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        async_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTYELLOW_EX &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        async_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTRED_EX &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;gather&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;tasks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    end_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start_time

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTBLUE_EX
        &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE
        &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Ending running async. Total time: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;end_time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;total_seconds&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token format-spec&quot;&gt; .2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RESET_ALL&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;synchronous_work&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CYAN &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pretending to wait.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;async_work&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;colour&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;colour &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pretending to wait async.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    init&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Run it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;make async-example&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/461840d2b32c17eb2c4cd62bfd0a3830/58bb7/async1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVQoz23DbUyMAQDA8WdjQ4a6lOpaSiInuw98yIa2ZjabpmRI3fV23aWo7prukKH4kNel6667ruue5170MhsqVjbmg2q2mKmQDVFY3rLxhdnfSh9q9dt+QviOQGL2yJHvDCAyKZjo5FAid4Wi2BdD5MZwZAuX4TdvAYvnL5x2EYvn+c1Z2FZzge2eehLFOra5rGwXXShFNRG+lYRURCJLDyMwW44sJ3RywGQZ/jlL8M9ZOquw2eImoeUOW723iPe0s8V7mw3uBlaJZ4lprmLNjSpir19E6atB6TWj9FWzyd1JvPiUeKmPeOnxjMJ+rQpViYaDR7JQ6zVkFOWgKtKSdljHAW0eBzPzSSpMI9gqJ9gmJ8weRoQ5nejqSqKry1l9dWahz2zmU3MT791uRj0SI14PIx6Jj00SbSkiktKLI8HGCXUpxzOnZhVwLEuDMVOHQVVAqboAw1ShI6mYR6nldKeY6E020rP7/+6kMvoum3nsbeSJw8mgzceg/RoDdT4Gaq/Rb21luL6Rv77z/PZe5I/vf0Gd/ZBDh9+Qlz+ErvAVWt0QmiOvKU7u4VSIC1OQB5NMwhgkYgyWMC13cSzAiSlI5NyKWlxRp2mIqsAZdWay8KSpirF79Yx0WvnYVcuHLgujd61867iEs+4+5eaXnLU8o8LST0VtP+V1Q5TZhzHa33LU9o4S6yj6aYUrBRINZZ3YDO049DexG9qwlbRhKWrH2dKH+OAF9Z3PcUy894re1hZ+Ok7yzVnJuPPMrEKs9gVxhl8oir+zXj9OXMk4ionFP1DovqDIHWNd7mfW5Y6xNu8rielPyUi9Q9rerjn/A7vM37Tc3kUnAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Async example&quot;
        title=&quot;Async example&quot;
        src=&quot;/static/461840d2b32c17eb2c4cd62bfd0a3830/f058b/async1.png&quot;
        srcset=&quot;/static/461840d2b32c17eb2c4cd62bfd0a3830/c26ae/async1.png 158w,
/static/461840d2b32c17eb2c4cd62bfd0a3830/6bdcf/async1.png 315w,
/static/461840d2b32c17eb2c4cd62bfd0a3830/f058b/async1.png 630w,
/static/461840d2b32c17eb2c4cd62bfd0a3830/40601/async1.png 945w,
/static/461840d2b32c17eb2c4cd62bfd0a3830/58bb7/async1.png 985w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This contrived example shows a simple case where asynchronous code got things done faster than blocking code.&lt;/p&gt;
&lt;p&gt;Running 2 tasks that each take 2 seconds asynchronously allows them to be finished in 2 seconds.&lt;/p&gt;
&lt;p&gt;If you await 2 async functions in sequence, it’s sort of like it was done synchronously so if you really want multiple steps to run asynchronously you can use utilities such as the &lt;code class=&quot;language-text&quot;&gt;asyncio.gather&lt;/code&gt; function in that example.&lt;/p&gt;
&lt;h2&gt;It’s Async all the way down&lt;/h2&gt;
&lt;p&gt;You must use async all the way down. If you block at any point within an async function, you block everything.&lt;/p&gt;
&lt;p&gt;We will explore this more in the FastAPI section but for now, it’s important to be aware that this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;pthon&quot;&gt;&lt;pre class=&quot;language-pthon&quot;&gt;&lt;code class=&quot;language-pthon&quot;&gt;async def synchronous_work_in_async_function():
    time.sleep(2)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Has very different effects to this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;async_work&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;The GIL&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://wiki.python.org/moin/GlobalInterpreterLock&quot;&gt;python GIL&lt;/a&gt; (global interpreter lock) can lead to some issues when writing async code. For the most part, you’ll probably never notice if you’re writing IO-bound apps but for CPU bound, it may become an issue.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The GIL prevents race conditions and ensures thread safety.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;All threads in python share the same memory space. The GIL helps ensure thread safety for multiple threads interacting with the same variable.&lt;/p&gt;
&lt;p&gt;An example of where this might be important. Python uses a ref count to determine if something should be garbage collected.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; sys


&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    a_thing &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;a thing&quot;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getrefcount&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a_thing&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    another_thing &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a_thing
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getrefcount&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;another_thing&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;del&lt;/span&gt; a_thing
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getrefcount&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;another_thing&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/48887812fc0849fb6a53ff3bdcb792fb/e9beb/gil.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.68354430379747%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAY0lEQVQY05WPOwrAIBBErf2ALkkRRNa1ivc/4IRsEVJINMWDKYbHjNmPDf3sYGbknFFKgYigtaa51grnnOK9n2KISEMIQRnlVZkKU0qw1j4rRtzF1ZUmxjgt/rr8XrB660t4AXMfc60ROUStAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;GIL Output&quot;
        title=&quot;GIL Output&quot;
        src=&quot;/static/48887812fc0849fb6a53ff3bdcb792fb/f058b/gil.png&quot;
        srcset=&quot;/static/48887812fc0849fb6a53ff3bdcb792fb/c26ae/gil.png 158w,
/static/48887812fc0849fb6a53ff3bdcb792fb/6bdcf/gil.png 315w,
/static/48887812fc0849fb6a53ff3bdcb792fb/f058b/gil.png 630w,
/static/48887812fc0849fb6a53ff3bdcb792fb/e9beb/gil.png 730w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If multiple threads are updating references, you might get an accidental garbage collection or a memory leak. The lock is there to ensure this doesn’t happen and garbage collection is done safely.&lt;/p&gt;
&lt;p&gt;The downside is this can affect performance.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In hindsight, the GIL is not ideal, since it prevents multithreaded CPython programs from taking full advantage of multiprocessor systems in certain situations.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There are ways around this. Some libraries aren’t effected by the GIL e.g. &lt;a href=&quot;https://numpy.org/&quot;&gt;Numpy.&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When writing a web app with FastAPI, using async/await and a library like &lt;a href=&quot;https://www.uvicorn.org/&quot;&gt;uvicorn&lt;/a&gt;, the GIL is less of an issue as we are primarily IO bound.&lt;/p&gt;
&lt;h2&gt;Async FastAPI&lt;/h2&gt;
&lt;p&gt;FastAPI is &lt;a href=&quot;https://fastapi.tiangolo.com/?h=perfor#performance&quot;&gt;quite fast&lt;/a&gt;, unless you make it not fast :)&lt;/p&gt;
&lt;p&gt;How does that happen?&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://fastapi.tiangolo.com/async/&quot;&gt;async docs for FastAPI&lt;/a&gt; are really good. We won’t repeat much from them here but instead look at some examples.&lt;/p&gt;
&lt;p&gt;A “hello world” FastAPI app looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; fastapi &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; FastAPI

app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; FastAPI&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When we start up our FastAPI service, it will handle requests asynchronously on the eventloop. One worker should be able to handle many requests in this scenario.&lt;/p&gt;
&lt;p&gt;Let’s see what that looks like. If you have the &lt;a href=&quot;https://github.com/zoe/understanding-python-async&quot;&gt;examples repo&lt;/a&gt; you can run ./test-endpoints.sh to see all these outputs or feel free to follow along step by step here.&lt;/p&gt;
&lt;p&gt;Create a hello world sample like the following:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;touch src/fastapi_example.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; fastapi &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; FastAPI
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; time
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; datetime
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; asyncio

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; colorama &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; init
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; colorama &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Back&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Style

app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; FastAPI&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GREEN &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Hello world started at: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start_time&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can hit the same endpoint multiple times simultaneously with curl.&lt;/p&gt;
&lt;p&gt;Create a text file like this:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;touch test_urls.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Add this content:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Start your FastAPI app:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;uvicorn src.fastapi_example:app --reload&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;In another console, run the test script:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;./test-endpoints.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;You should see output similar to the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{&quot;message&quot;:&quot;Hello World&quot;}{&quot;message&quot;:&quot;Hello World&quot;}{&quot;message&quot;:&quot;Hello World&quot;}{&quot;message&quot;:&quot;Hello World&quot;}{&quot;message&quot;:&quot;So slow&quot;}{&quot;message&quot;:&quot;So slow&quot;}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the application logs:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e8eb2dda5c9a4489b601ceb05264d8d8/36c33/async-normal.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0ElEQVQoz23Qy27TUBSFYT+AHRfaxI6Pz9XHaZgzLhKFqkgMekMNoU3txLm0QCugFMTL/yiuhBqJwac92NLaSzvI/6SoJsd8kRS3lvLWYb7Klr1RlHeu3ZXfCopbg7oR6DtJOusSvQrp7G0Ksp8J4rSPqRR+6iinBbbWuFqjL3IGc4+tFC9WA3zjUBOBqPv0qm3icUj8MdoQZD96ZCcp5krha9daB/qZQ49zdpsSe6UYLgbtQXkpyKuM3tU28SgkHkUbAvErIR9l6JmkmFv83GHnCjfX6EoyWHnsTDG8KfELi6wFepGTTnt0TkPi04i4nY+C7CFBnPcx68DG4BuLbRSuMeiJZLD02KlieL0OdKhKIJuMtO7ROQuJzyLidj4Ksu8J4qiPvpT4iWvZiW7JkWBQe8yFZNgMKCpLPs4Qkz7JpEv8KSQeRxsC8ZCQn2eYqWqfXjYFdqbbhmai2F08aThfN8xRjSCtenQ+/Keh+J0ix1n7N790lMsCt9QUK4OpJbvXJXauGX4u8SuHmuWYpSSddumchMTHEfFx+E+Q1Dv0XnaRb3LsgcG+NegDhTs0iL0+/l2B2pfsvi9xh5bsdZ90P2Hn6Dlb9yHP7iO2nvgLj1Ia855LFnIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Async example output&quot;
        title=&quot;Async example output&quot;
        src=&quot;/static/e8eb2dda5c9a4489b601ceb05264d8d8/f058b/async-normal.png&quot;
        srcset=&quot;/static/e8eb2dda5c9a4489b601ceb05264d8d8/c26ae/async-normal.png 158w,
/static/e8eb2dda5c9a4489b601ceb05264d8d8/6bdcf/async-normal.png 315w,
/static/e8eb2dda5c9a4489b601ceb05264d8d8/f058b/async-normal.png 630w,
/static/e8eb2dda5c9a4489b601ceb05264d8d8/40601/async-normal.png 945w,
/static/e8eb2dda5c9a4489b601ceb05264d8d8/36c33/async-normal.png 946w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;That was perhaps too fast to prove anything.&lt;/p&gt;
&lt;p&gt;Update your endpoint with &lt;code class=&quot;language-text&quot;&gt;await asyncio.sleep(4)&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GREEN &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Hello world started at: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start_time&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Run the test again:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ddeb3e6e88a2fa6368dbf4878fd42f22/97bfd/async-normal-waiting.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABk0lEQVQoz2XOvW7TUBiHcSO2+PgkzontOP48x3Yc21URSxcWuAGG3gRXAhINMAAJqEAHhnz2Hp+qpgNRhp+ed/rrtYoPGeZHSrnKyVYR5fpf81VMtdaYVYJZp+hVQvE9o/01Z/LOxXllI98I5OtT1sXPhu5Qc7lrqLcFL/Ydi21BvTVc7lra3ZxmW/V9dHV4SbTxcTcCtZFnrOqrpjxmzI8avY/75vsIc0ioj4bikGL2Sa865Fzc1wR/x7h/HNSdZHznnLDmvw3VN83ifcl8WdDd1Cw+lVQfDe3jvazovtS0n2vqm4JuuSC4VYyPDmonUftTlrwWiFwwGoyIZhGBH5ClGVN/iu/5RGGEzjU603iBx8AfIK8Ew2vB8O05S2YOUjkopTCFIU1TmqZBa02cxBhjaLuWZtEQJiGitBFjgf3Mxn5+znJygaMc3JHbD4RhSJ7nzGaz/k6ShLIsKUyBH/qIxEZMBMIRCPnU/1jDRCJcwWg46geCICCKIiaTCZ7nMZ1O+9E4jlGewg6fPrRthBBnHgARdvW03aeCbgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Async example with ait output&quot;
        title=&quot;Async example with ait output&quot;
        src=&quot;/static/ddeb3e6e88a2fa6368dbf4878fd42f22/f058b/async-normal-waiting.png&quot;
        srcset=&quot;/static/ddeb3e6e88a2fa6368dbf4878fd42f22/c26ae/async-normal-waiting.png 158w,
/static/ddeb3e6e88a2fa6368dbf4878fd42f22/6bdcf/async-normal-waiting.png 315w,
/static/ddeb3e6e88a2fa6368dbf4878fd42f22/f058b/async-normal-waiting.png 630w,
/static/ddeb3e6e88a2fa6368dbf4878fd42f22/40601/async-normal-waiting.png 945w,
/static/ddeb3e6e88a2fa6368dbf4878fd42f22/97bfd/async-normal-waiting.png 1078w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Despite each call not responding for 4 seconds, they all kicked off at the same time. FastAPI is handling requests asynchronously.&lt;/p&gt;
&lt;p&gt;Now to demonstrate where things can go wrong, let’s add another endpoint:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/slow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;slow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GREEN &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Slow started at: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start_time&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;So slow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here’s we’re using the blocking &lt;code class=&quot;language-text&quot;&gt;time.sleep&lt;/code&gt; instead of the non blocking &lt;code class=&quot;language-text&quot;&gt;asyncio.sleep&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Use the &lt;code class=&quot;language-text&quot;&gt;curl_configs/test_urls_slow.txt&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;url = &quot;http://127.0.0.1:8000/slow&quot;
url = &quot;http://127.0.0.1:8000/slow&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The order is important. We want the slow ones to kick off first.&lt;/p&gt;
&lt;p&gt;Update the curl command to allow 6 concurrent requests:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;curl --parallel --parallel-immediate --parallel-max 6 --config curl_configs/test_urls_slow.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 445px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b0ae9fdeabfe7c074d4568048609b8f9/e66bf/slow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACWUlEQVQoz0WPz09SAQDHuZabW8BDTFFQUdCpl7ZW0+YPQvAJPB4PEB7oemqKCj5+hMrTAM0fqJWbh+5d2qpT1zq29Wd9Wnjo8Nl3+x4+28f0c+0X76Mf2JvTaUhNmtIJdalJPdrkJHbKYbDGeeKy/Z8nLjiR31EJVRkbHaPf68bucRJ7HqcyXyY/m8f0R/vNp9Ad+9MlrkJn3IQuaIXOaYXPuJEuaPqOuVVuaC2dcatc8zF6Q33piPFBD85BF/YxF8kXKrWAQdn/BtNn/Qda5oDpkEJ0ZQs5u4WU3UTRdlE3iwSUFVKvi8RWc6Q2CiReFZC1HOOLMzgWntLl7WPzmcad/5qr+VNM5i86nU2Fh7lZbIaMcBBB2I/wuJHE0UjSWfDjqC/zqCzS21imt5HEdiBhPoxiPpIRNB8DqyKeNZkRLYrpwfc81rcJbGt+XJU4rpKCsxhj6DCNp5amOyfirWVwFCQ8tSyemkp/UcayJ2IphRD0EJadIOadQBtTx7cC1pqCkJ3DpccY2JNxFaIMV5fxHqToXl9gtJrGsbWEt6riraZw7kaw7gSw6iLWchhBDyMU7zF1fM1jqSewbvjpr8bpK8foK8kMGCncRypdOyLDhkqPHsF9lMFtpHGUZCz6EpZKGGF3EdtmAGHrnv/CdT/OagJnRcFZVhgy0owcZ7Bvi4wYGXr2IgwbGUYMlb5SDPO/5H/CvIiQCyJsB9vbTrZtL2J/+QR32o876WMo6cO7KjK5FsERmWJSk3DGZpjQJCa0MINJH7b4FLaVWSxnKcytDOZLFXNL5S+D8mD6OLaESQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Async with blocking example output&quot;
        title=&quot;Async with blocking example output&quot;
        src=&quot;/static/b0ae9fdeabfe7c074d4568048609b8f9/e66bf/slow.png&quot;
        srcset=&quot;/static/b0ae9fdeabfe7c074d4568048609b8f9/c26ae/slow.png 158w,
/static/b0ae9fdeabfe7c074d4568048609b8f9/6bdcf/slow.png 315w,
/static/b0ae9fdeabfe7c074d4568048609b8f9/e66bf/slow.png 445w&quot;
        sizes=&quot;(max-width: 445px) 100vw, 445px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Oops! We just blocked all requests from being processed.&lt;/p&gt;
&lt;p&gt;The main takeaway from this is, you just can’t mix asynchronous and synchronous functionality in a FastAPI application this way.&lt;/p&gt;
&lt;p&gt;Consider this next example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/sync-slow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sync_slow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTRED_EX &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Sync slow started at: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start_time&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; sec.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;So slow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice, we are not specifying &lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt; on the function definition.&lt;/p&gt;
&lt;p&gt;Use the &lt;code class=&quot;language-text&quot;&gt;curl_configs/test_urls_sync_slow.txt&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;url = &quot;http://127.0.0.1:8000/sync-slow&quot;
url = &quot;http://127.0.0.1:8000/sync-slow&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;
url = &quot;http://127.0.0.1:8000/&quot;

`curl --parallel --parallel-immediate --parallel-max 6 --config curl_configs/test_urls_sync_slow.txt`&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f2d7d2a4b192b76d713040f6ed8e133b/60b8f/sync-slow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABZ0lEQVQoz3XMzU8TURjF4dmQQHrndnCGTqfTe+/cadAgEMpHE/CDpCHSohgQlm7duCB8hLSUQUESSdghxpVtNP6jP+OQuKEsnrznnMXrfNhrcPz5GQfZCkefXnCYrbCfLef56Ow5B9ly3rtfmrw8rzG54zO9U+LpA5zzj6v8OHnFTWeN25N1vnXW/ufbzt3+z/dem/fXM1z0FrjqNvjaXRrKaV3Xefdnkc1Bne1fS7wd1Nnoz+R5a7DA6/4sb/qzbP1usP5zim42x2k2Ty+rD+V4x48QTY+J1QjVsqi2JW4ZSs0Y3U5JNidRGxavGeDteniXguKlSzG/9zkyFoiRAqEboicUScmgA0W5GJKEhif6MTa0yHGXMX8UMSrujA3nSOUiPEFYDtFGYxJDrOK8pzWLTW2+qVqVKCkjfZeCX0C4AiHuc2RFIqQgCAKiKKJSqeR830drjTGGarVKalNUrJChRJQffvgXlIjlD8HcPfYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Async with example output&quot;
        title=&quot;Async with example output&quot;
        src=&quot;/static/f2d7d2a4b192b76d713040f6ed8e133b/f058b/sync-slow.png&quot;
        srcset=&quot;/static/f2d7d2a4b192b76d713040f6ed8e133b/c26ae/sync-slow.png 158w,
/static/f2d7d2a4b192b76d713040f6ed8e133b/6bdcf/sync-slow.png 315w,
/static/f2d7d2a4b192b76d713040f6ed8e133b/f058b/sync-slow.png 630w,
/static/f2d7d2a4b192b76d713040f6ed8e133b/40601/sync-slow.png 945w,
/static/f2d7d2a4b192b76d713040f6ed8e133b/60b8f/sync-slow.png 1217w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you don’t specify your endpoint as being async i.e. as &lt;a href=&quot;https://docs.python.org/3/library/asyncio-task.html&quot;&gt;a coroutine&lt;/a&gt;, FastAPI will look after it for you instead as it will assume this route contains blocking calls whereas if you specify &lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;, it’s up to you to make sure it really is asynchronous.&lt;/p&gt;
&lt;p&gt;Rules of thumb:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;if all your code uses coroutines i.e. all use async/await, use async when defining your route&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;if any of your code is blocking e.g. using requests, some non aio ORM etc. do not use async when specifying the route&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you use &lt;a href=&quot;https://docs.python-requests.org/en/latest/&quot;&gt;requests&lt;/a&gt; or standard &lt;a href=&quot;https://www.sqlalchemy.org/&quot;&gt;SQLAlchemy&lt;/a&gt; anywhere in a route, you will block the execution.&lt;/p&gt;
&lt;p&gt;Consider alternatives like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aiohttp.org/en/stable/&quot;&gt;https://docs.aiohttp.org/en/stable/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.sqlalchemy.org/en/14/orm/extensions/asyncio.html&quot;&gt;https://docs.sqlalchemy.org/en/14/orm/extensions/asyncio.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Pubsub&lt;/h2&gt;
&lt;p&gt;FastAPI is great at managing async within the context of the framework e.g. in a route. It cannot account for any code you write that may be running on some schedule or handling incoming events. Especially if you’re using the same event loop.&lt;/p&gt;
&lt;p&gt;To illustrate, let’s add some pubsub:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pip install --upgrade google-cloud-pubsub&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This example is pretty contrived and GCP specific but does demonstrate a common mistake.&lt;/p&gt;
&lt;p&gt;If you don’t want to use docker and would like to follow along please &lt;a href=&quot;https://cloud.google.com/sdk/docs/install&quot;&gt;install the gcloud cli&lt;/a&gt; and run the following to start a pubsub emulator:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gcloud beta emulators pubsub start --project=example-project&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$(gcloud beta emulators pubsub env-init)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;If you are using docker compose, the emulator is already setup for you in the sample code.&lt;/p&gt;
&lt;p&gt;We are doing this so we can see what happens when our FastAPI application listens to messages out side of standard web requests.&lt;/p&gt;
&lt;p&gt;Update our FastAPI app to handle messages:&lt;/p&gt;
&lt;p&gt;Import the pubsub lib:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; google&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cloud &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; pubsub_v1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Setup a subscription:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;create_standard_subscription&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    project_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;example-project&quot;&lt;/span&gt;
    topic_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;testing&quot;&lt;/span&gt;
    subscription_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;testing-subscription&quot;&lt;/span&gt;

    publisher &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pubsub_v1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PublisherClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    subscriber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pubsub_v1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SubscriberClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    subscription_path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; subscriber&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscription_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;project_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subscription_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    topic_path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; publisher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;topic_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;project_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; topic_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        subscriber&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_subscription&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            request&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; subscription_path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; topic_path&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Subscription already exists&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pubsub_v1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscriber&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        start_time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;non-blocking&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;BLUE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Starting async message at: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start_time&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ack&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;elif&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blocking&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                Back&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LIGHTMAGENTA_EX
                &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; Fore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WHITE
                &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Starting sync message at: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start_time&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                flush&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ack&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    subscriber&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscribe&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;subscription_path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Listening for messages on &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;subscription_path&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;..\n&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;on_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;startup&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startup_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    create_standard_subscription&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Configure a pubsub client to send messages e.g.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;touch src/pubsub_client.py&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;With the following content:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; google&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cloud &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; pubsub_v1 &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; pubsub
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; itertools


&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    publisher &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pubsub&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PublisherClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    project_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;example-project&quot;&lt;/span&gt;
    topic_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;testing&quot;&lt;/span&gt;

    publisher &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pubsub&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PublisherClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    topic_path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; publisher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;topic_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;project_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; topic_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        topic &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; publisher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_topic&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; topic_path&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Created topic: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Topic already exists&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Run 5 non-blocking&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; itertools&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;repeat&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        future &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; publisher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;publish&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic_path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;b&quot;non-blocking&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;future&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Run 5 blocking&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; itertools&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;repeat&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        future &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; publisher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;publish&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic_path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;b&quot;blocking&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;future&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We are going to send some messages to our app and see how it responds in different scenarios.&lt;/p&gt;
&lt;p&gt;Start the app:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;make up&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Run the client in another session:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;make pubsub&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or if you are not using docker:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;python src/pubsub_client.py&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Created topic: projects/example-project/topics/testing
Run 5 non-blocking
1
2
3
4
5
Run 5 blocking
6
7
8
9
10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see output int he app console like this:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/68cb8fa86fe907b091567e2360763122/01dae/pubsub_output.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 26.58227848101266%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZElEQVQY0z3JT0sicQDG8XkNe6jLRnXrJcQWKrUZsR08RNCxUSmZGYV2s7bw0upYWbG40Bso7A8RlZsQhZsb40y/dZyxWtR7h3oV33AOHR4+D88j+ZaL+L8X8S8X+fTtjOHkueeAvM/g0jUT248EMjafs3XG1h18aZsvWy4jep1R3SaYe2QiY9Df85He7g9IwXyb8V9txvNtAjtNRn628G036VttMLTmMpNzCekOUxsu05suk+k6M1sNQlmHkF5nOvdAKCvoHp2nKyAj6SlBJiXIpgQ/VgV66h/pFcHXhRq7CZMr9Y7LuMmlZlCKVylpFqexWy4Ug9+qxUWswp5WZSnZIrnYRLLlP9izZTo2Ine44Yrns/ZEKyaw5DJO1ECEb6mFKzzMWVRnb6hF/nr9Xi7jRg1eE01e4v+RCppJQalSUEwOVYsDxeRAtTiJ2xxrwvved8XkSL33PFQsr3f+jqcJx8sbY5cQCVphsi8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Pubsub output&quot;
        title=&quot;Pubsub output&quot;
        src=&quot;/static/68cb8fa86fe907b091567e2360763122/f058b/pubsub_output.png&quot;
        srcset=&quot;/static/68cb8fa86fe907b091567e2360763122/c26ae/pubsub_output.png 158w,
/static/68cb8fa86fe907b091567e2360763122/6bdcf/pubsub_output.png 315w,
/static/68cb8fa86fe907b091567e2360763122/f058b/pubsub_output.png 630w,
/static/68cb8fa86fe907b091567e2360763122/01dae/pubsub_output.png 721w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;All the messages were processed asynchronously. The pubsub is using a callback and the eventloop used by FastAPI is not effected.&lt;/p&gt;
&lt;h3&gt;Where async + pubsub can go wrong&lt;/h3&gt;
&lt;p&gt;You may be tempted to use something like &lt;a href=&quot;https://pypi.org/project/gcloud-aio-pubsub/&quot;&gt;gcloud-aio-pubsub&lt;/a&gt; with your fastapi app. You can use something like &lt;a href=&quot;https://pypi.org/project/nest-asyncio/&quot;&gt;nest-asyncio&lt;/a&gt; to hook into the fastapi eventloop. This will allow you to use the same eventloop for your pubsub client and let you use standard async await with event handling.&lt;/p&gt;
&lt;p&gt;You should avoid this however. It is very easy to add a blocking call into an event handler. This will block the event loop and prevent any other events and web requests from being processed thus holding up your whole application.&lt;/p&gt;
&lt;p&gt;It is advisable to keep it simple. Let fastapi deal with the complexity of asyncio and use a background thread for pubsub.&lt;/p&gt;
&lt;h2&gt;Useful links&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.aiohttp.org/en/stable/&quot;&gt;https://docs.aiohttp.org/en/stable/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.sqlalchemy.org/en/14/orm/extensions/asyncio.html&quot;&gt;https://docs.sqlalchemy.org/en/14/orm/extensions/asyncio.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/alex-sherman/unsync&quot;&gt;https://github.com/alex-sherman/unsync&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://asherman.io/projects/unsync.html&quot;&gt;https://asherman.io/projects/unsync.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://fastapi.tiangolo.com/async/&quot;&gt;https://fastapi.tiangolo.com/async/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mikeckennedy/async-await-jetbrains-webcast&quot;&gt;https://github.com/mikeckennedy/async-await-jetbrains-webcast&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/61316540/how-to-get-python-fastapi-async-await-functionality-to-work-properly&quot;&gt;https://stackoverflow.com/questions/61316540/how-to-get-python-fastapi-async-await-functionality-to-work-properly&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://asgi.readthedocs.io/en/latest/&quot;&gt;https://asgi.readthedocs.io/en/latest/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://uvloop.readthedocs.io/&quot;&gt;https://uvloop.readthedocs.io/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://www.uvicorn.org/&quot;&gt;https://www.uvicorn.org/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/41063331/how-to-use-asyncio-with-existing-blocking-library&quot;&gt;https://stackoverflow.com/questions/41063331/how-to-use-asyncio-with-existing-blocking-library&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[How to only run a job on a pull request in CircleCI]]></title><description><![CDATA[I wanted a thing to only happen when a pull request is opened. I also wanted to do some cleanup when the pull request is closed. In my last…]]></description><link>https://ruarfff.com/circleci-pr-only/</link><guid isPermaLink="false">https://ruarfff.com/circleci-pr-only/</guid><pubDate>Tue, 27 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I wanted a thing to only happen when a pull request is opened. I also wanted to do some cleanup when the pull request is closed. In my last place we used GitHub actions and this was super easy.
Now I am using &lt;a href=&quot;https://circleci.com/&quot;&gt;CircleCI&lt;/a&gt; and this wasn’t so easy.&lt;/p&gt;
&lt;p&gt;In this post we will look at how to only run a job on a pull request in CircleCI. There is one major caveat. We also need a way to trigger the job on a pull request. We will look at how to do this with the &lt;a href=&quot;https://circleci.com/docs/api/v2/&quot;&gt;CircleCI web api&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Conditionally run a job&lt;/h2&gt;
&lt;p&gt;There are a few options you can use to only run a job on a pull request in CircleCI. There is the option to
&lt;a href=&quot;https://discuss.circleci.com/t/only-build-pull-requests-not-every-branch/200&quot;&gt;only ever build on a pull request&lt;/a&gt; but this is all or nothing
i.e. you can never run a build on a branch without opening a pull request.&lt;/p&gt;
&lt;p&gt;Another option is, within a job, you can inspect the &lt;a href=&quot;https://circleci.com/docs/2.0/env-vars/&quot;&gt;environment variables&lt;/a&gt; to see if there is a pull request number like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${CIRCLE_PULL_REQUEST&lt;span class=&quot;token operator&quot;&gt;##&lt;/span&gt;*&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Is a pull request&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is OK but it would be nice to conditionally run a whole job instead. It is not possible to read environment variables when the pipeline is loaded. It is only possible when a job is run.
To work around this we can use the &lt;a href=&quot;https://circleci.com/developer/orbs/orb/circleci/continuation&quot;&gt;circleci/continuation&lt;/a&gt; orb.
If you are trying this out, make sure to update your project settings in &lt;strong&gt;Advanced Settings -&gt; Enable dynamic config using setup workflows&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;CircleCI expects all your configuration in one file called &lt;code class=&quot;language-text&quot;&gt;.circleci/config.yml&lt;/code&gt;. The continuation orb takes over as the entry point giving you access to the environment variables and then runs the pipeline using whatever configuration you tell it to.
It’s a little bit weird but it works.&lt;/p&gt;
&lt;p&gt;This is an example of using the continuation orb to conditionally run a job only on a pull request.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.circleci/config.yml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.1&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;orbs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;continuation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; circleci/continuation@0.2.0
&lt;span class=&quot;token key atrule&quot;&gt;workflows&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;continuation/continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;configuration_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.circleci/main.yml&quot;&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;parameters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/circleci/params.json
          &lt;span class=&quot;token key atrule&quot;&gt;pre-steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
                  if [ -z &quot;${CIRCLE_PULL_REQUEST##*/}&quot; ]
                  then
                    IS_PR=false
                  else
                    IS_PR=true
                  fi
                  echo &apos;{ &quot;is_pr&quot;: &apos;$IS_PR&apos; }&apos; &gt;&gt; /home/circleci/params.json&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note, we mentioning PR here but you could do more or less anything to configure your pipeline there. &lt;code class=&quot;language-text&quot;&gt;/home/circleci/params.json&lt;/code&gt; is written to and specified with &lt;code class=&quot;language-text&quot;&gt;parameters: /home/circleci/params.json&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.circleci/main.yml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.1&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;parameters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;is_pr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; boolean
    &lt;span class=&quot;token key atrule&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;false&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;do_something&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cimg/base&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2021.04&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; something
            &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo &apos;You get the picture&apos;

&lt;span class=&quot;token key atrule&quot;&gt;workflows&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;

   &lt;span class=&quot;token key atrule&quot;&gt;whence-pr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &amp;lt;&amp;lt; pipeline.parameters.is_pr &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;do_something&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; something&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We called the file &lt;code class=&quot;language-text&quot;&gt;main.yml&lt;/code&gt; here but it could be any file. You just need to specify it in the parameter called &lt;code class=&quot;language-text&quot;&gt;configuration_path&lt;/code&gt;. &lt;a href=&quot;https://circleci.com/blog/building-cicd-pipelines-using-dynamic-config/&quot;&gt;This post&lt;/a&gt; also shows another way to generate the configuration on the fly.&lt;/p&gt;
&lt;p&gt;Now we have passed the &lt;code class=&quot;language-text&quot;&gt;is_pr&lt;/code&gt; parameter to the pipeline. We can conditionally run things using &lt;code class=&quot;language-text&quot;&gt;when: &amp;lt;&amp;lt; pipeline.parameters.is_pr &gt;&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There is one major issue with this approach. Our build may have run before a PR (pull request) was ever opened. Opening a PR will not trigger a build in CircleCI.&lt;/p&gt;
&lt;h2&gt;Triggering CircleCI pipeline when a pull request is opened&lt;/h2&gt;
&lt;p&gt;First thing you must do is grab a &lt;a href=&quot;https://circleci.com/docs/2.0/managing-api-tokens/&quot;&gt;CircleCi API token&lt;/a&gt;. A &lt;a href=&quot;https://app.circleci.com/settings/user/tokens&quot;&gt;personal API token&lt;/a&gt; will do for this example.&lt;/p&gt;
&lt;p&gt;You can trigger a pipeline run like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;SCM&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;github
&lt;span class=&quot;token assign-left variable&quot;&gt;ORG&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;your-org-here
&lt;span class=&quot;token assign-left variable&quot;&gt;PROJECT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;your-project-here
&lt;span class=&quot;token assign-left variable&quot;&gt;CIRCLE_BRANCH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;a-derived-branch

&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-X&lt;/span&gt; POST &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Circle-Token: &lt;span class=&quot;token variable&quot;&gt;${CIRCLE_TOKEN}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Content-Type: application/json&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Accept: application/json&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;branch&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${CIRCLE_BRANCH}&lt;/span&gt;&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;}&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    https://circleci.com/api/v2/project/&lt;span class=&quot;token variable&quot;&gt;${SCM}&lt;/span&gt;/&lt;span class=&quot;token variable&quot;&gt;${ORG}&lt;/span&gt;/&lt;span class=&quot;token variable&quot;&gt;${PROJECT}&lt;/span&gt;/pipeline&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hopefully it’s clear what values you need to change there. How you will run this bit depends on what tools you have available to you. I was using GitHub and even though we use CircleCI, there are enough free &lt;a href=&quot;https://github.com/features/actions&quot;&gt;GitHub Action&lt;/a&gt; minutes for me to setup an action like this:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.github/workflows/pr.yml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Trigger Build on PR

&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;opened&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reopened&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;trigger-build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;latest

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Trigger CircleCI
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;CIRCLE_BRANCH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; github.head_ref &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;CIRCLE_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; secrets.CIRCLE_TOKEN &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;ORG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; your&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;org&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;here
          &lt;span class=&quot;token key atrule&quot;&gt;PROJECT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; your&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;here
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
          curl -X POST \
          -H &quot;Circle-Token: ${CIRCLE_TOKEN}&quot; \
          -H &apos;Content-Type: application/json&apos; \
          -H &apos;Accept: application/json&apos; \
          -d &quot;{\&quot;branch\&quot;:\&quot;${CIRCLE_BRANCH}\&quot;}&quot; \
          https://circleci.com/api/v2/project/github/${ORG}/${PROJECT}/pipeline&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This feels like an incredible hack but it works.&lt;/p&gt;
&lt;h2&gt;A side note on doing something when a PR is merged&lt;/h2&gt;
&lt;p&gt;This has nothing to do with CircleCI but if you happen to have access to GitHub actions this might be useful.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.github/workflows/pr-closed.yml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; On PR Closed

&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;closed&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;on-pr-closed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;latest
    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Print PR number
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;PR_NUMBER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; github.event.number &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
          echo &quot;${PR_NUMBER}&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Check the Mood of a Slack Channel using Machine Learning]]></title><description><![CDATA[Sentiment a thought, opinion, or idea based on a feeling about a situation, or a way of thinking about something Sentiment analysis, in the…]]></description><link>https://ruarfff.com/slack-sentiment/</link><guid isPermaLink="false">https://ruarfff.com/slack-sentiment/</guid><pubDate>Wed, 10 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://dictionary.cambridge.org/dictionary/english/sentiment&quot;&gt;Sentiment&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;a thought, opinion, or idea based on a feeling about a situation, or a way of thinking about something&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Sentiment_analysis&quot;&gt;Sentiment analysis&lt;/a&gt;, in the context of this article, is the use of natural language processing to quantify the general opinion or mood of some text. We will keep it simple and only look at determining if some text is positive or negative. Positive being generally complimentary in nature. Negative being generally critical in nature. To add some level of (perhaps impractical) practicality we will look at analysing text from a &lt;a href=&quot;https://slack.com/&quot;&gt;Slack&lt;/a&gt; channel.&lt;/p&gt;
&lt;p&gt;In this article we will:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Download chat history from a public slack channel (which is optional as you can really use any text)&lt;/li&gt;
&lt;li&gt;Use some python tools to process and inspect the chat data&lt;/li&gt;
&lt;li&gt;Use a pre-trained model to classify sentences from the chat as positive or negative&lt;/li&gt;
&lt;li&gt;Train our own custom model with some training data&lt;/li&gt;
&lt;li&gt;Test our own model and use it on the slack data&lt;/li&gt;
&lt;li&gt;Prepare a docker image with our model so we can deploy and use it as a service&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you just want to look at some code, &lt;a href=&quot;https://github.com/ruarfff/slack-sentiment&quot;&gt;this GitHub repository&lt;/a&gt; has everything. The &lt;a href=&quot;https://jupyter.org&quot;&gt;jupyter notebook&lt;/a&gt; in it also includes a lot of the instructions from here. In this article we will look at all the steps in excruciating detail so we really understand how it all works.&lt;/p&gt;
&lt;h2&gt;Setup&lt;/h2&gt;
&lt;p&gt;The easiest thing to do it the clone &lt;a href=&quot;https://github.com/ruarfff/slack-sentiment&quot;&gt;this GitHub repository&lt;/a&gt;. It is using &lt;a href=&quot;https://packaging.python.org/tutorials/managing-dependencies/#managing-dependencies&quot;&gt;pipenv&lt;/a&gt; to manage dependencies so if you follow the &lt;a href=&quot;https://github.com/ruarfff/slack-sentiment/blob/main/README.md&quot;&gt;Readme&lt;/a&gt; and you have a recent version of &lt;a href=&quot;https://www.python.org&quot;&gt;python&lt;/a&gt; as well as &lt;a href=&quot;https://pipenv-fork.readthedocs.io/en/latest/&quot;&gt;pipenv&lt;/a&gt; installed, you should be good to go.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone git@github.com:ruarfff/slack-sentiment.git

&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; slack-sentiment

pipenv &lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--dev&lt;/span&gt;

pipenv run notebook&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The example is mostly run in a &lt;a href=&quot;https://jupyter.org&quot;&gt;jupyter notebook&lt;/a&gt;. Of course feel free to use your own setup instead and copy code from here as needed. If you don’t want to use &lt;code class=&quot;language-text&quot;&gt;pipenv&lt;/code&gt; you can also install all the dependencies listed in the Pipfile using pip directly.&lt;/p&gt;
&lt;p&gt;e.g.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pip &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; jupyter slack-sdk nltk numpy pandas matplotlib&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Get Data from a Slack Channel&lt;/h2&gt;
&lt;p&gt;I know I don’t need to say this but obviously be careful and understand the sensitivity of your slack data. I ran this against a slack channel with friends. I used slack as I thought it was a nice example for taking data from an arbitrary source and processing it. It was also a fun example to use.&lt;/p&gt;
&lt;p&gt;I won’t go into too much detail here as the &lt;a href=&quot;https://api.slack.com&quot;&gt;slack documentation&lt;/a&gt; is good but here’s a brief explanation of how to get the chat history for a channel.&lt;/p&gt;
&lt;p&gt;You will need to get the ID for the channel and a token to make a request to the slack api.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To get the slack channel ID:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There is probably an easier way but the one I use is to right click the channel name in the channel menu and select “Copy link”. The link will look something like &lt;code class=&quot;language-text&quot;&gt;https://your-org.slack.com/archives/C12345&lt;/code&gt;. The channel ID is the last piece. That’s &lt;code class=&quot;language-text&quot;&gt;C12345&lt;/code&gt; in the example URL.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To get a token:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Setup a bot user following these instructions &lt;a href=&quot;https://api.slack.com/bot-users&quot;&gt;https://api.slack.com/bot-users&lt;/a&gt;.
The OAuth scope must allow &lt;code class=&quot;language-text&quot;&gt;channels:history&lt;/code&gt;. Add the bot user to the channel you wish to read messages from. The channel should be public. I have not tested any of this with private channels.&lt;/p&gt;
&lt;p&gt;The next section assumes you have 2 environment variables:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;SLACK_SENTIMENT_BOT_TOKEN&lt;/code&gt; - The bot token we setup previously.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;SLACK_SENTIMENT_CHANNEL_ID&lt;/code&gt; - The channel ID we retrieved previously.&lt;/p&gt;
&lt;p&gt;If you are not familiar with how to setup environment variables, feel free to just replace those values with hardcoded values but obviously be careful not to accidentally push your token up to Github or something like that :)
Incidentally, I do have a &lt;a href=&quot;https://dev.to/ruarfff/managing-local-app-secrets-and-sharing-secrets-with-your-team-34m1&quot;&gt;post on managing secrets while developing&lt;/a&gt; if you’re interested.&lt;/p&gt;
&lt;p&gt;The following python example gets all the slack messages for a channel and prints them:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Get a timestamp for 7 days ago in a weird way. I need to lean more python.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# This is only used if we want to limit how far back in time we go for fetching slack messages.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; datetime &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; timedelta&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; date
today &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;today&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
week_ago &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; today &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; timedelta&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;days&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
week_ago_timestamp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;combine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;week_ago&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; datetime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1970&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; timedelta&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seconds&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; os
&lt;span class=&quot;token comment&quot;&gt;# Import WebClient from Python SDK (github.com/slackapi/python-slack-sdk)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; slack_sdk &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; WebClient
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; slack_sdk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;errors &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; SlackApiError
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; json
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; time &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; sleep

token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;environ&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;SLACK_SENTIMENT_BOT_TOKEN&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
channel_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;environ&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;SLACK_SENTIMENT_CHANNEL_ID&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
page_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;

client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; WebClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

conversation_history &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
has_more &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
cursor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; has_more&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        has_more &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;
        result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;conversations_history&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            channel&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;channel_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            limit&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;page_size&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            cursor&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;cursor
            &lt;span class=&quot;token comment&quot;&gt;# If you wanted to limit to the last 7 days uncomment the next line and put a , after cursor on the previous line&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;# oldest = week_ago_timestamp&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        conversation_history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;extend&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;messages&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        has_more &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;has_more&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;response_metadata&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Still fetching&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            cursor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;response_metadata&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;next_cursor&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# Avoid being rate limited&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Done!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;except&lt;/span&gt; SlackApiError &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Error getting conversations: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conversation_history&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Prepare the Data&lt;/h2&gt;
&lt;p&gt;In data engineering a huge amount of time is spent organising and cleaning data. Slack is just one example of a wide variety of extremely versatile data sources. In the following example we will gently dip our toes into that kind of work. Let’s take our slack messages and clean them up a bit. Let’s also break them up into sentences and words.&lt;/p&gt;
&lt;p&gt;I will just drop our main data cleaning function in here and then go through it line by line.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; nltk
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tokenize &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; word_tokenize&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sent_tokenize
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; itertools

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get_test_data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    all_text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;text&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; message &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; conversation_history &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;text&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    tokenized_text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;sent_tokenize&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; text &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; all_text&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    sentences &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;itertools&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;chain&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;tokenized_text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    tokenized_words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;word_tokenize&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sentence&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; sentence &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; sentences&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;itertools&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;chain&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;tokenized_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sentences&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

main_sentences&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; main_words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; get_test_data&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Line by line&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;all_text = [message[&apos;text&apos;] for message in conversation_hissory if &apos;text&apos; in message]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The response from the Slack API stores the text from the slack conversation in a field called text. We don’t want any of the other information like the user who posted it or the time it was posted. That line iterates over each response and extracts the text to a new list.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;tokenized_text = [sent_tokenize(text) for text in all_text]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Iterate over all the text and use NLTK’s sentence tokeniser to split the text up into sentences.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sentences = list(itertools.chain(*tokenized_text))&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The previous line actually gave us a list of lists since &lt;code class=&quot;language-text&quot;&gt;sent_tokenize&lt;/code&gt; returns a list. This line flattens that to a single list.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;tokenized_words = [word_tokenize(sentence) for sentence in sentences]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This line used NLTK’s word tokeniser to split each slack message up into words.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;words = list(itertools.chain(*tokenized_words))&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;word_tokenize&lt;/code&gt; returns a list so we ended up with a list of lists. This line flattens that to a single list.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;return (sentences, words)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Here we are returning a &lt;a href=&quot;https://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuple&quot;&gt;tuple&lt;/a&gt; containing the sentences and words. In this case, a tuple is just a handy way to return multiple things from a function without going to the bother of creating a new data type for it.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;main_sentences, main_words = get_test_data()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We then assign the values from the returned tuple to 2 new variables. We will use these variables again throughout the rest of this example.&lt;/p&gt;
&lt;h2&gt;Use a Pre-trained Model&lt;/h2&gt;
&lt;p&gt;We will be training our own model and we will look at how to deploy our own trained model soon. First it could be useful to look at an example of using a pre-trained model. We will use NLTK’s &lt;a href=&quot;https://www.nltk.org/api/nltk.sentiment.html&quot;&gt;SentimentIntensityAnalyzer&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You can import and setup the model like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; download
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; matplotlib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pyplot &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; plt
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sentiment &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; SentimentIntensityAnalyzer

&lt;span class=&quot;token comment&quot;&gt;# The SentimentIntensityAnalyzer model needs us to pull down the vader_lexicon&lt;/span&gt;
download&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;vader_lexicon&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

sia &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SentimentIntensityAnalyzer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then you can take one of the sentences from our slack “corpus” and pass it in:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;sia&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;polarity_scores&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_sentences&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;compound&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That will return a number. If the number is greater than 0 then we say the sentence has a positive sentiment.&lt;/p&gt;
&lt;p&gt;Here’s an example that checks each sentence and draws a pie chart showing the ratio of positive vs negative.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;num_pos &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
num_neg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;is_positive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sentence&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; sia&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;polarity_scores&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sentence&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;compound&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; s &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; main_sentences&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; is_positive&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        num_pos &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        num_neg &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

labels &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Positive&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Negative&apos;&lt;/span&gt;
sizes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;num_pos&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; num_neg&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

fig1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ax1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subplots&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
ax1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pie&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sizes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; labels&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;labels&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; autopct&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;%1.1f%%&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        shadow&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; startangle&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
ax1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;axis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;equal&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

plt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;show&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Example output:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 333px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4607b4e1790fd5a65197a704f1b44c75/24c7e/sent-example-pie.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACK0lEQVQoz22Tz2sTQRTHh0b04FXwoPUHmqZNYkARwYMH/wI9SwUjqHhJaLGb3TTJrvFgeylUFFKkB8GimFSTgLSk/gKliIo92AZ7CLb5QaQSbTW/dnfmPZndhPxoHwMzzOPz3ve9eUOw06B50CjT1DoCbVwD4DYj3AMNj874/jn3+3rsq3VycWZCwIcXaWoC/+S5m9EdYNMMEMfervYIcYv3GRl++UAaRP9+feQg3j2D398YClgHDACqqtbqKiLee79KPFGLmNjjTxBpPhJ0o3JMD5/EwHGUBzD/rYsnlNL1bLaQy66sFfYFk8SX6PEnLWKciPORgBvlo7rsxLALxUM4PWjA0CGbGorvv0sTb3SX5xG5MWURZok4NxW40oBlB8+sOLCYbk9uwEawa08WydCsRUoQX3y3+JyIC5HA1SZsx9sn0NeL6YX2zrVg9+MPHOaaXxAxdU6a3AidRrkfZAeE7GDCKynohg3Z43NLxBvjrRJfXfCPbYVcKPeh4ihL/T881pJg47ILy92ymZF5eb24dyRGxNc3RyUI2Zg8wHipdr7CLhAP4/Slnxu/MplMNpvTNK31ziY/FP14y+vGsJUqTmqWyqt1YdAGo1Zc+6IC/tvarFSqjLEWbM5Ypa6VZ4Z1oRekIxi0YrCPv7DvAA059aXEDkPSmmoABlClrPQpuRm5XL5ztqqcqo6frz4V1HzabDI0rRtu/wAaY/W/pVqpqNfKrBl7+8f4D2R6k6ankoBLAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Sentiment pie chart showing neg and pos&quot;
        title=&quot;Sentiment pie chart showing neg and pos&quot;
        src=&quot;/static/4607b4e1790fd5a65197a704f1b44c75/24c7e/sent-example-pie.png&quot;
        srcset=&quot;/static/4607b4e1790fd5a65197a704f1b44c75/c26ae/sent-example-pie.png 158w,
/static/4607b4e1790fd5a65197a704f1b44c75/6bdcf/sent-example-pie.png 315w,
/static/4607b4e1790fd5a65197a704f1b44c75/24c7e/sent-example-pie.png 333w&quot;
        sizes=&quot;(max-width: 333px) 100vw, 333px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This was just to show an example but it might also demonstrate the importance of the next step. The results we got from the data in its current state may not have been very accurate. Let’s see what we can do to clean up the data and reduce the noise in there.&lt;/p&gt;
&lt;h2&gt;Clean the Data&lt;/h2&gt;
&lt;p&gt;From this point on we won’t be using the sentences from our dataset anymore. We will focus on the individual words instead. Let’s create a frequency distribution graph of the words. This is also to demonstrate how many of them are more or less useless.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;probability &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; FreqDist

fdist &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; FreqDist&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

fdist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;plot&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;cumulative&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
plt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;show&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ba090e062de841af01e288c0375f4f48/3c5de/sent-word-plot.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVQoz5WS627DIAxG+/6POE3d1DQNl5AAjo2BkEykXddU66QdWf4Dh88gDuu65pyFENZ767x3zr/GbashhHXjsMmzkqIbvPHIVAkvQMRr/5FTzlJ0YoRxohSZmeMLQggpJSJ6SJ5nJWXvQANFDn/IRHTtN7mUYowRQiDReYD0L3meZ621lDIQNQOMMCVmCvWMesweRGTm/djba8e6Ox6V9RhKzimleyB/V01+vnPONTmEnBISfWjb+2kEpHCbP6dbRQ45xZ28LIsQgohqGjMxC4fS4WWE81BLezRABkhZcBh28rquMUbvvdZaKSU6YZQyWvemNqX1semOrXhvLm+fzamTu09yR2sNAFJK61y3IaVExPPphAATeDsOztplWX6Rn+h707ZtKaUsy1145AtYgbR27oDefgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Word plot&quot;
        title=&quot;Word plot&quot;
        src=&quot;/static/ba090e062de841af01e288c0375f4f48/3c5de/sent-word-plot.png&quot;
        srcset=&quot;/static/ba090e062de841af01e288c0375f4f48/c26ae/sent-word-plot.png 158w,
/static/ba090e062de841af01e288c0375f4f48/6bdcf/sent-word-plot.png 315w,
/static/ba090e062de841af01e288c0375f4f48/3c5de/sent-word-plot.png 472w&quot;
        sizes=&quot;(max-width: 472px) 100vw, 472px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you run that, you probably see a lot of words like “I”, “if”, “me” etc. Also maybe some punctuations. These are not too useful for our analysis.&lt;/p&gt;
&lt;p&gt;Let’s look at a helper function to clean that up.&lt;/p&gt;
&lt;p&gt;When we start training our own model we will be using a method where we store each word along with its frequency and train a model using those features (the words and frequency) along with labels (positive and negative).&lt;/p&gt;
&lt;p&gt;We will need 2 functions. One to clean our data, removing noise such as meaningless words, punctuation etc. Then we need a function to convert a stream of words into a hashmap with words and number of occurences.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Assumes you previously had from nltk import download&lt;/span&gt;
download&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;stopwords&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
download&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;names&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;corpus &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; stopwords&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; names
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; string &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; punctuation

&lt;span class=&quot;token comment&quot;&gt;# A large set of names. We lowercase here as we will lowercase our own data first too&lt;/span&gt;
name_words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lower&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; n &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; names&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# A set of stopwords provided by NLTK (if, as etc.)&lt;/span&gt;
stop_words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stopwords&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;english&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clean_words&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;w &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; w &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lower&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; w &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; words &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isalpha&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; w &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; stop_words &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; w &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; name_words &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; w &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; punctuation&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s split &lt;code class=&quot;language-text&quot;&gt;clean_words&lt;/code&gt; and look at each bit.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;w for w in [w.lower() for w in words if w.isalpha()]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Go through all the words in the words array which is passed as an argument to our function. Check if a word is alphanumeric (no special characters we can’t use). Then extract that out to a new list.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;if w not in stop_words and w not in name_words and w not in punctuation&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This filters our list. We filter out all those stop words. We filter out any names and punctuations. This gives us a cleaner set to work with.&lt;/p&gt;
&lt;p&gt;You may be wondering what we are doing here? How can we analyse the data without context? We are going to use a pretty basic model. We will more or less be taking bags of words with labels and training a model with them. Then we will feed other bags of words to the model and have it make a guess at the sentiment. It doesn’t know anything about actual sentences. It mostly goes off of word frequency.&lt;/p&gt;
&lt;p&gt;To help us shape our data even more for later use we need one more function.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;word_counts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    counts &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; word &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; words&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        counts&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;word&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; counts&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;word&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; counts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This takes our words and puts them into a HashMap where the key is the word and the value is the number of times that word has shown up in our data.&lt;/p&gt;
&lt;p&gt;Now we can get the data ready.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;main_words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clean_words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
main_words_counts &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; word_counts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can create a new distribution graph and see if it looks better.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;fdist &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; FreqDist&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
fdist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;plot&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;cumulative&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
plt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;show&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 419px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c3a150f1b0ffd0bc1eaac152367cd581/d587d/sent-word-plot-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmklEQVQoz4WSW3ObMBSE8/9/WkwwvDjjsenFxiAhBEJInKMLKOWSxG2ddh8YDatPe7SjpxCCMUYIkdetVFqrL6XfTSmlUiqE8BRCEEI0nLcKLq0yxtgv5L1fF4iotf6EedNM3lKpqVCjs4jmbznn1gUAfCb3fd80DSIOxmSV6Acw+EBr5rxtGDYYEZtFABC8Z1IVbT/N4Qj/hQmhhJC2bVfbIJ6ooEIBorfLkP+ArbVzYcvYWxmAZavOlcgb2Q9g3/kHcAhBKcU5/7CNmTMHQN7rrOpqqUe3zGAtLHf5DZ7bvoM/buuMQcBzJWqpOjV4N59h5593bWutOefW2nEcrbXOue3r3Oh9N+CtVUWrc6EvTV8rkMMdDACMMUIIY4xSWpYlpXOLRVHkt1tFKGeMVZRWLC/K1x/X128/+17O8DRNK58kSRRFcRwfDofdbpem6el0Oh6P0cvL8y5K0nQfx8l+n+7j79nZObclhxC891rrruu0HgCgKApEXK0sywghiLg+aUqpMWa1NvgPreN0XXe5Xuu6fuj+gt8A3RYgvb1sUhcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Updated work plot&quot;
        title=&quot;Updated work plot&quot;
        src=&quot;/static/c3a150f1b0ffd0bc1eaac152367cd581/d587d/sent-word-plot-2.png&quot;
        srcset=&quot;/static/c3a150f1b0ffd0bc1eaac152367cd581/c26ae/sent-word-plot-2.png 158w,
/static/c3a150f1b0ffd0bc1eaac152367cd581/6bdcf/sent-word-plot-2.png 315w,
/static/c3a150f1b0ffd0bc1eaac152367cd581/d587d/sent-word-plot-2.png 419w&quot;
        sizes=&quot;(max-width: 419px) 100vw, 419px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Training Our Own Model&lt;/h2&gt;
&lt;p&gt;Now we will train a model so we can call ourselves AI scientists. We will use something called a &lt;a href=&quot;https://en.wikipedia.org/wiki/Naive_Bayes_classifier&quot;&gt;Naive Bayes classifier&lt;/a&gt;. NLTK provides one for us to use. Our main job here really is to provide a lot of labelled data to train the model and the library does the rest. Over time as we become more familiar with the data we might figure out clever ways of modifying it to improve our model. We will look briefly at that concept but will not go into it in any depth here.&lt;/p&gt;
&lt;p&gt;In &lt;a href=&quot;https://github.com/ruarfff/slack-sentiment&quot;&gt;the sample repo&lt;/a&gt; for this there are some data files. These can also be downloaded from the &lt;a href=&quot;https://archive.ics.uci.edu/ml/datasets/Sentiment+Labelled+Sentences&quot;&gt;Sentiment Labelled Sentences Data Set&lt;/a&gt;. We will also use some data provided by NLTK.&lt;/p&gt;
&lt;p&gt;First we load the files from the repo using the &lt;a href=&quot;https://pandas.pydata.org&quot;&gt;pandas library&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; pandas &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; pd

amazon &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_csv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sentiment_labelled_sentences/amazon_cells_labelled.txt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; names&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;review&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sentiment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sep&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;\t&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
imdb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_csv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sentiment_labelled_sentences/imdb_labelled.txt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; names&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;review&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sentiment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sep&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;\t&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
yelp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_csv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sentiment_labelled_sentences/yelp_labelled.txt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; names&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;review&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sentiment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sep&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;\t&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Those files must be located in a folder called &lt;code class=&quot;language-text&quot;&gt;sentiment_labelled_sentences&lt;/code&gt; in the same directory as the python script if using the code as is.&lt;/p&gt;
&lt;p&gt;Now we download the movie review corpus provided by NLTK.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Assumes you previously had from nltk import download&lt;/span&gt;
download&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;movie_reviews&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The next step is to take all that data and split it into 2 lists. One list of negative reviews. The other of positive reviews.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;reviews &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;amazon&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;review&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;imdb&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;review&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;yelp&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;review&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
sentiment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;amazon&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sentiment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;imdb&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sentiment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;yelp&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sentiment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

positive_reviews &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
negative_reviews &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;corpus &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; movie_reviews

&lt;span class=&quot;token comment&quot;&gt;# Process the corpus data which is split into files with IDs of pos and neg&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; f &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; movie_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fileids&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pos&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;word_counts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clean_words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;movie_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pos&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; f &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; movie_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fileids&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;neg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    negative_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;word_counts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clean_words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;movie_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;neg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Process the data we extracted from files into reviews and sentiment lists with matching indexes&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; r &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;enumerate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;reviews&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    review_words &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; word_tokenize&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; sentiment&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;word_counts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clean_words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;review_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pos&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        negative_reviews&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;word_counts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clean_words&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;review_words&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;neg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now that we have all that data prepared we can train a model.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classify &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; NaiveBayesClassifier

&lt;span class=&quot;token comment&quot;&gt;# We will use 80% of the data set for training and 20% for testing&lt;/span&gt;
split_pct &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;.80&lt;/span&gt;

pos_split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;split_pct&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
neg_split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;split_pct&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

train_set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;pos_split&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; negative_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;neg_split&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
test_set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;pos_split&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; negative_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;neg_split&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

model &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NaiveBayesClassifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train_set&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we split the data into training and testing sets:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;split_pct &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;.80&lt;/span&gt;

pos_split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;split_pct&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
neg_split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;split_pct&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

train_set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;pos_split&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; negative_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;neg_split&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
test_set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; positive_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;pos_split&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; negative_reviews&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;neg_split&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s hard to know what the optimal split is but I have
&lt;a href=&quot;https://stackoverflow.com/questions/13610074/is-there-a-rule-of-thumb-for-how-to-divide-a-dataset-into-training-and-validation&quot;&gt;read some discussion indicating 80/20 might be a good start&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once we have our data read, the actual training of the model is simply calling one function provided by NLTK:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;model &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NaiveBayesClassifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train_set&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point we can start using the model to classify all that data we prepared from slack.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classify&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_words_counts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is a good idea for us to use our test data and determine the accuracy of the model first though.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; nltk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classify&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; accuracy

&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; accuracy&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; test_set&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When I checked the model it was coming in between 65% and 70% accurate. At this point there’s some work to do to improve the model. I am not going to go into that now except to provide some basic pointers. Perhaps in a follow up article I will get into it. For now let’s look at some things you can do to see where things need improving.&lt;/p&gt;
&lt;p&gt;We can gather all the guesses that went wrong from the test data.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;errors &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; label&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; test_set&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    guess &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classify&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; guess &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; label&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        errors&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;label&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; guess&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errors&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Looking at the places where guesses went wrong, maybe we can modify the data to improve the training. Maybe take variations on a word and ad that to the training set.&lt;/p&gt;
&lt;p&gt;We can see which features our model believes are most informative.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;show_most_informative_features&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By getting a better understanding of how the model learns, we improve our ability to know how to train it. It’s difficult but also interesting.&lt;/p&gt;
&lt;h2&gt;Deploying a Model&lt;/h2&gt;
&lt;p&gt;Now we can save the model. You could push this model up somewhere and pull it in to some other useful location. For an example of how to deploy this model in a web service using docker please see the &lt;a href=&quot;https://github.com/ruarfff/slack-sentiment/blob/main/README.md&quot;&gt;Readme for this project&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You can imagine some process whereby you train a model at some interval or on some event and push the model to a location from which it gets pulled down for use in another application or service.&lt;/p&gt;
&lt;p&gt;Write the model to a file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; pickle

model_file &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.models/sentiment_classifier.pickle&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;wb&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
pickle&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dump&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; model_file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
model_file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For a full example of how to then use that model in a web service please make sure to look at the &lt;a href=&quot;https://github.com/ruarfff/slack-sentiment&quot;&gt;Example Repository&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A quick example of how if might work follows:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;model_file &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.models/sentiment_classifier.pickle&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;rb&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
model &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pickle&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;load&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;model_file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
model_file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; accuracy&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; test_set&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;show_most_informative_features&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classify&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main_words_counts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s it. Hopefully this has been useful. Thank you for reading.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;p&gt;I wrote this post as I was studying material from the following places:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.manning.com/liveproject/training-and-deploying-an-ml-model-as-a-microservice&quot;&gt;Training and Deploying an ML Model as a Microservice&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.datacamp.com/community/tutorials/text-analytics-beginners-nltk&quot;&gt;Text Analytics for Beginners using NLTK&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://realpython.com/python-nltk-sentiment-analysis/&quot;&gt;Sentiment Analysis: First Steps With Python’s NLTK Library&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/dev-genius/training-an-ml-model-for-sentiment-analysis-in-python-63b6b8c68792&quot;&gt;Training an ML Model for Sentiment Analysis in Python&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using Devcontainer With GitHub Codespaces]]></title><description><![CDATA[A while back I started using Devcontainer in VsCode. I really liked the editor integration and if you’re in a team, being able to share the…]]></description><link>https://ruarfff.com/github-codespaces/</link><guid isPermaLink="false">https://ruarfff.com/github-codespaces/</guid><pubDate>Sat, 16 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A while back I started using &lt;a href=&quot;https://code.visualstudio.com/docs/remote/devcontainerjson-reference&quot;&gt;Devcontainer&lt;/a&gt; in &lt;a href=&quot;https://code.visualstudio.com&quot;&gt;VsCode&lt;/a&gt;. I really liked the editor integration and if you’re in a team, being able to share the development environment like this is great. We have been able to do this for a while now with &lt;a href=&quot;https://www.docker.com/&quot;&gt;docker&lt;/a&gt; or even &lt;a href=&quot;https://www.vagrantup.com&quot;&gt;vagrant&lt;/a&gt; but getting a nice editor abstraction makes it easier to adopt.&lt;/p&gt;
&lt;p&gt;I recently got access to &lt;a href=&quot;https://github.com/features/codespaces&quot;&gt;Codespaces&lt;/a&gt; and discovered it also supports this setup.&lt;/p&gt;
&lt;p&gt;I am using it for &lt;a href=&quot;https://github.com/ruarfff/leetcode-jan-2021&quot;&gt;this python repo&lt;/a&gt;. There is also &lt;a href=&quot;https://github.com/microsoft/vscode-remote-try-python&quot;&gt;a more detail official example&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you don’t have access to Codespaces you can &lt;a href=&quot;https://github.com/features/codespaces/signup&quot;&gt;request early access&lt;/a&gt; - note that link may not age well.&lt;/p&gt;
&lt;p&gt;If you have access, you should see an option in the GitHub UI:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/718e66bd43001df484b552c78311c4d6/9c177/1-gh-repo-ui.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVQY012Q227DMAiG+wBTbWMb8CF24jR20nTr4WY3k/b+bzVl2SZ1EkII+OCHQ8rVp4Zdpa5a7pQhsM6g19aB4T349UEoe1RWSCtejBT2gNaBRglWAYJhDj26TqO3HDU6pVkZBsMSEDlyyM5n7BN9TFC7wxFQAMpvU4B5qDGNLmSDfmd+Spqm+a2t9zKtaV7K553n8fBX3juGcW7na0wnbb3B4LvC26BgKdblOq/3/rT0ZRnywpyfYKmJQ28oCMBvtQ5dUsYpvT2i1Etbb+18S6V1paFLzzBgSCWXKjVJTcpwGibySQCCdUNdp+U6vz7S0FwsluMzrNB3ZTgtEkgCKc0hjZaiUBs8Xx6X23tbH2N77aeVfP6/2VLQ1u33K70p32OpyWDcrtAsgOSWpy/V7C9hzGyiXAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Repo UI&quot;
        title=&quot;Repo UI&quot;
        src=&quot;/static/718e66bd43001df484b552c78311c4d6/f058b/1-gh-repo-ui.png&quot;
        srcset=&quot;/static/718e66bd43001df484b552c78311c4d6/c26ae/1-gh-repo-ui.png 158w,
/static/718e66bd43001df484b552c78311c4d6/6bdcf/1-gh-repo-ui.png 315w,
/static/718e66bd43001df484b552c78311c4d6/f058b/1-gh-repo-ui.png 630w,
/static/718e66bd43001df484b552c78311c4d6/9c177/1-gh-repo-ui.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you have not setup this repo before, you will be asked to create a new Codespace. After that, you will have a link to the space like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 536px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/40acc1a59f43d511ac7e7410b65c46ba/2d920/2-gh-codespaces-button.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVQoz42SXW/TMBSGezfE2vojdWwnduw4bpykS5N+LN2adR+oFBDwE7jhelzwAxB/HXUe2xBCQnp0pHOk9+gcve8AIAIQgTiEOASIjEAwHOMhwH4+HKERCCAk4HUwOkHDEwhfTSAKh2N0OkIDL3sEES7SvGyK2SKSJkrMrFlbV4dKsS+Nud8W367Z1xZS6or5rFk/i1FAIQ5ppMp6VS82UueJce1576oFy7L4/rz4sZ//fM+/d5CzRE1TWw5QQH/DTD6bry4yN+fSCJ0LnUcyi5WVOhcsi0ITUSOYhTgUyqZZOXj6FgZU22rWdrZoYjX14ieUrTxJVgAURiJVxg0mVHqCMM7Lpl33y2633Ozarm/X/aK7WnZX7bqXqUtMoW2lbQUQYbHisR5MqPDgCZ8vL272H/vbd7s3H+7eftreHLY3h7vD58vdfrW5LuqVtlXmaoAIjzUX+sXZmCamSEwhdO7P9q3H5GfaVjJ1MnUAh1zoSJqXPzOVlWW9Xm52XX93vr3NXP2gLFVWeplfdPT/b5+ZSLk0sbJCT4WeMmFonHoe5tNYWS4NQKQ8a9vV5bNVx30AD8f4dPTIMWrjwDOGBE0YJhw8nClVZl31Z8L+AUAkZCJJc2Uc5QlEJFJVki//S+zzhyfM12NLBKbqF0s+W5jHslo9AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Codespaces Button&quot;
        title=&quot;Codespaces Button&quot;
        src=&quot;/static/40acc1a59f43d511ac7e7410b65c46ba/2d920/2-gh-codespaces-button.png&quot;
        srcset=&quot;/static/40acc1a59f43d511ac7e7410b65c46ba/c26ae/2-gh-codespaces-button.png 158w,
/static/40acc1a59f43d511ac7e7410b65c46ba/6bdcf/2-gh-codespaces-button.png 315w,
/static/40acc1a59f43d511ac7e7410b65c46ba/2d920/2-gh-codespaces-button.png 536w&quot;
        sizes=&quot;(max-width: 536px) 100vw, 536px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Then you basically have VSCode in the browser:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/96015875c211f3478324f1338065bb72/9c177/3-gh-codespaces-ui.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVQoz43Py26DMBCFYd4jXIzHnhlsjAMObsGBRFHVm9RF3/9lqjZNN72k0rc4m39xMucH3w+Kmq7rxhj80NvWS2wE4B+kYk0mQ+PTegw3C3Hn/KjZKTSgjdTNFYozIDvtl343o7XkgpBUSRTAtbouA2rjvPdhIjatG4wLpt1KNP+KFdm0HsZprVWj0GpuFb2XAuhH50ycY4km3ka2fogpxBTGqetH64Pmtlb8/aoiq8gCWQGUSW3ilMj283o63T/FeeV2KxRXEssP1UX5RegCKdeYITs/xAr4cHp4fnk93j12IVaARQW/KmHDlBNl1gfjhlzoXVpCWsj3YF2puQAsAHNNuaLPfVFIvWmaXNMbLs9Uegu4R2MAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Codespaces UI&quot;
        title=&quot;Codespaces UI&quot;
        src=&quot;/static/96015875c211f3478324f1338065bb72/f058b/3-gh-codespaces-ui.png&quot;
        srcset=&quot;/static/96015875c211f3478324f1338065bb72/c26ae/3-gh-codespaces-ui.png 158w,
/static/96015875c211f3478324f1338065bb72/6bdcf/3-gh-codespaces-ui.png 315w,
/static/96015875c211f3478324f1338065bb72/f058b/3-gh-codespaces-ui.png 630w,
/static/96015875c211f3478324f1338065bb72/9c177/3-gh-codespaces-ui.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You don’t need any extra setup for this to work. You will get a handy development environment that persists so you can open it up on any machine with a browser without needing to install any extra development tools. You can work on one machine and move to another no problem.&lt;/p&gt;
&lt;p&gt;What if you want to customise the setup? That’s where devcontainer comes in. For my example repo, I wanted to use python 3.8 and I wanted pipenv to be installed. This is how I set that up.&lt;/p&gt;
&lt;h2&gt;Docker Setup&lt;/h2&gt;
&lt;p&gt;You can define the environment you want to use for development with a dockerfile. My docker file it really basic but you can do whatever you need here:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docker&quot;&gt;&lt;pre class=&quot;language-docker&quot;&gt;&lt;code class=&quot;language-docker&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; python:3.8&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt;  pip install pipenv&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I put this at the root of the project in a file called &lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For Codespaces to use this you need one more step.&lt;/p&gt;
&lt;p&gt;Create a file: &lt;code class=&quot;language-text&quot;&gt;.devcontainer/devcontainer.json&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Docker Setup&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Sets the run context to one level up instead of the .devcontainer folder so we can keep Dockerfile at the root.&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;context&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;..&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Set *default* container specific settings.json values on container create.&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;terminal.integrated.shell.linux&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token null keyword&quot;&gt;null&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;&quot;extensions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;&quot;postCreateCommand&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;pipenv sync --dev&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;&quot;runArgs&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;--network&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I like having the Dockerfile at the root of my project so I configured it that way but it’s also quite common to put the Dockerfile in the &lt;code class=&quot;language-text&quot;&gt;.devcontainers&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;terminal.integrated.shell.linux&quot;: null&lt;/code&gt; just says we don’t want to use my local VSCode shell settings since your own VSCode settings get imported if you are using settings sync. You can configure this to be more specific based on what’s in your Dockerfile.&lt;/p&gt;
&lt;p&gt;I want to use &lt;a href=&quot;https://pypi.org/project/pipenv/&quot;&gt;pipenv&lt;/a&gt; so having this run post creation &lt;code class=&quot;language-text&quot;&gt;&quot;postCreateCommand&quot;: &quot;pipenv sync --dev&quot;&lt;/code&gt; saves one extra step.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;runArgs&quot;: [ &quot;--network&quot;, &quot;host&quot;]&lt;/code&gt; because I don’t want to bother messing with ports.&lt;/p&gt;
&lt;p&gt;With all that setup, once you create a new Codespace, you should see it getting created like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d2bb9f16abeb32e3fade1668e7129b87/9c177/4-gh-output.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQoz5WR3WrCQBCF97Ia22x2d/Z/s5smMUoMirYSayMWe9P3f6GSRouFFip8HObMMHCYQSBtmpWMG0x4QsVNIBBGGp9QESfwDSb8N859AgoTDtIiJozUXhovdNqrSoVOmTCMa8YH1WcrDOUaE05BjSd4/dQim+bzxXqxeq7qpQuFC6XzhTReGa9sUCb0agPjmoIioIZcowi3Lx3S7nE6a/JpnYYSpKWgrtA/LO87wA0IM57gbbtHPq822/1y02bFnEsHwlwy97Ep6Es9hO9Hw3K761BR1bvu1Ky22mb3Mb0+218kVIyi+PXwhspZc3z/mNUr+nXD/0CYvIviw/GEhHIuFCBu+DNh8gGzLK8+AQbcNA+tMNVpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Codespaces build output&quot;
        title=&quot;Codespaces build output&quot;
        src=&quot;/static/d2bb9f16abeb32e3fade1668e7129b87/f058b/4-gh-output.png&quot;
        srcset=&quot;/static/d2bb9f16abeb32e3fade1668e7129b87/c26ae/4-gh-output.png 158w,
/static/d2bb9f16abeb32e3fade1668e7129b87/6bdcf/4-gh-output.png 315w,
/static/d2bb9f16abeb32e3fade1668e7129b87/f058b/4-gh-output.png 630w,
/static/d2bb9f16abeb32e3fade1668e7129b87/9c177/4-gh-output.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Now you have an environment setup the way you want.&lt;/p&gt;
&lt;p&gt;This is a very basic example but there’s a lot more you can do.&lt;/p&gt;
&lt;h2&gt;More Customisation&lt;/h2&gt;
&lt;p&gt;You will almost certainly want to look at &lt;a href=&quot;https://docs.github.com/en/github/developing-online-with-codespaces/personalizing-codespaces-for-your-account&quot;&gt;setting up GitHub dotfiles&lt;/a&gt; to customise the shell in Codespaces.&lt;/p&gt;
&lt;p&gt;Checkout the many examples in the &lt;a href=&quot;https://github.com/microsoft/vscode-dev-containers/tree/master/containers&quot;&gt;vscode-dev-containers repo&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Managing local app secrets and sharing secrets with your team]]></title><description><![CDATA[In this article I will be discussing a tool called pass. This article assumes you use a Unix style shell for development, so working on Mac…]]></description><link>https://ruarfff.com/team-secrets/</link><guid isPermaLink="false">https://ruarfff.com/team-secrets/</guid><pubDate>Mon, 11 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this article I will be discussing a tool called &lt;a href=&quot;https://www.passwordstore.org/&quot;&gt;pass&lt;/a&gt;. This article assumes you use a Unix style shell for development, so working on Mac, Linux, WSL or similar.&lt;/p&gt;
&lt;h2&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#command-summary&quot;&gt;Command Summary&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Contents&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#why-pass&quot;&gt;Why Pass?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#secrets-while-developing&quot;&gt;Secrets While Developing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#a-sample-app&quot;&gt;A Sample App&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#using-pass-to-help-with-local-development&quot;&gt;Using Pass to Help With Local Development&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#backing-up-secrets&quot;&gt;Backing Up Secrets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#adding-a-team-member&quot;&gt;Adding a Team Member&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#removing-a-team-member&quot;&gt;Removing a Team Member&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#command-summary&quot;&gt;Command Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Why Pass? &lt;a name=&quot;why-pass&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Why use &lt;a href=&quot;https://www.passwordstore.org/&quot;&gt;pass&lt;/a&gt; and not some other tool like &lt;a href=&quot;https://1password.com&quot;&gt;1password&lt;/a&gt;, &lt;a href=&quot;https://www.dashlane.com&quot;&gt;Dashlane&lt;/a&gt; and others which maybe have more features and better platform support?&lt;/p&gt;
&lt;p&gt;Pass is free, open source and works on most systems that developers use. The ability to use it in your terminal and make it part of the workflow makes it a great tool for developers. If your company does pay for one of the other tools though, they might be a better choice for you. If not, &lt;code class=&quot;language-text&quot;&gt;pass&lt;/code&gt; is a great option.&lt;/p&gt;
&lt;h2&gt;Secrets While Developing &lt;a name=&quot;secrets-while-developing&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;If you are building some software that talks to other software, there’s a good chance you are reading secrets in your code. If you are calling services with something like &lt;a href=&quot;https://curl.se&quot;&gt;curl&lt;/a&gt; you likely input commands similar to &lt;code class=&quot;language-text&quot;&gt;curl -H &quot;Authorization: token my-super-secret-token&quot; https://some-auth-needing-service.com&lt;/code&gt; into your terminal.&lt;/p&gt;
&lt;p&gt;If you work in a team and you have some development credentials your team uses, you have probably encountered issues with sharing and keeping track of those secrets.&lt;/p&gt;
&lt;p&gt;In this post we will look at &lt;a href=&quot;https://www.passwordstore.org/&quot;&gt;pass&lt;/a&gt; as an option to help with this. We will look at a potential local workflow that uses &lt;code class=&quot;language-text&quot;&gt;pass&lt;/code&gt; so you don’t ever need to store secrets in plaintext locally. Then we will look at how to share these secrets with your team in a way that’s reasonable enough to maintain.&lt;/p&gt;
&lt;p&gt;The next section will show a sample app to test out the methods we will use but feel free to skip that section if you don’t need to use a sample app.&lt;/p&gt;
&lt;h2&gt;A Sample App &lt;a name=&quot;a-sample-app&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We will use an app based on backstage.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/backstage/backstage&quot;&gt;https://github.com/backstage/backstage&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This is a useful example as we can configure it to use GitHub auth to allow users to login and interact with GitHub. The actual sample app for this is here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ruarfff/backstage-example&quot;&gt;https://github.com/ruarfff/backstage-example&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;By default this example app is expecting 3 environment variables to exist.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;GITHUB_TOKEN &lt;/code&gt;
&lt;code class=&quot;language-text&quot;&gt;AUTH_GITHUB_CLIENT_ID&lt;/code&gt;
&lt;code class=&quot;language-text&quot;&gt;AUTH_GITHUB_CLIENT_SECRET&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;They are referenced in the application configuration here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ruarfff/backstage-example/blob/2ebd761ce316384f15165b506ce50ed67afa0515/app-config.yaml#L27&quot;&gt;GITHUB_TOKEN&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ruarfff/backstage-example/blob/2ebd761ce316384f15165b506ce50ed67afa0515/app-config.yaml#L53-L56&quot;&gt;AUTH_GITHUB&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you were deploying this to production you might use some kind of &lt;a href=&quot;https://www.vaultproject.io&quot;&gt;vault&lt;/a&gt;, &lt;a href=&quot;https://kubernetes.io/docs/concepts/configuration/secret/&quot;&gt;kube secrets&lt;/a&gt; or something of that nature to load these into the environment. We won’t look at that here. Instead we will look at what you would do it you needed to get this running locally and wanted to use a development GitHub setup for it. Similar methods would apply to a broad range of problems like this.&lt;/p&gt;
&lt;p&gt;If you try to run the application you’ll get an error (a lot of unimportant output left out in the following example):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:ruarfff/backstage-example.git
cd backstage-example
yarn
yarn dev

[1] Backend failed to start up, Error: Failed to initialize github auth provider, Missing required config value at &apos;auth.providers.github.development.clientId&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To create secrets and follow along you will need a GitHub account. Go here &lt;a href=&quot;https://github.com/settings/applications/new&quot;&gt;https://github.com/settings/applications/new&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Fill it in like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fd26d4830691372a7809bd4fdacc93db/9c177/1-gh-auth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.35443037974683%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQoz42S247bIBCG8wKxh8Pg4WCDjbExTpzNxUrt5Up9l0q96PtfVuv0qps0kX6hEeLTN8AcgCvgSulW29DottEtmW4vOjKeS307cDcH4KpmGOK8nK6+n4apTGWby2U5XfP61piu5gpE8xCuQLZhzOUSU0HURxDHmlcgj7WoGNZPzdr6lM9hXIZUjOs56tt+zfA//F+4DeO0bH2cURkkh+QetXoHJuvnchmm1XbxhtVcVbv2udl2Q4g5DHNMhawn6wVqYPiCGWQ7bPn8La3vftxAdiA9SAccX2pbmcn1JxdWNCPq2Ljc2BG4fAl2PqZ8jlOZls33EzZOkWNyfzP2BJbG9Xl9S/mc1+vnn8XsY+nHFclXTIEgLuk+DAwlWesH3QbqgjId2V6aKE1Cl5UJZDptw1f+AEJVR6l/LOX3R/n1EX9+FylKSvuFEfY5ueWBmStQTU1U0+fKhAKOTDT/5Cv8B/nNTPZz+jjUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Register OAuth App&quot;
        title=&quot;Register OAuth App&quot;
        src=&quot;/static/fd26d4830691372a7809bd4fdacc93db/f058b/1-gh-auth.png&quot;
        srcset=&quot;/static/fd26d4830691372a7809bd4fdacc93db/c26ae/1-gh-auth.png 158w,
/static/fd26d4830691372a7809bd4fdacc93db/6bdcf/1-gh-auth.png 315w,
/static/fd26d4830691372a7809bd4fdacc93db/f058b/1-gh-auth.png 630w,
/static/fd26d4830691372a7809bd4fdacc93db/9c177/1-gh-auth.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The local UI for the app is:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;http://localhost:3000&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The backend runs locally on port 7000 and the callback URL for it is:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;http://localhost:7000/api/auth/github/handler/frame&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;On the next page generate a new client secret. Make note of the client id and the secret.&lt;/p&gt;
&lt;p&gt;You’ll need a token for creating repositories. Go here &lt;a href=&quot;https://github.com/settings/tokens/new&quot;&gt;https://github.com/settings/tokens/new&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Creating a token that can work with repositories should be enough to test things out:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4ecc0a19a9e0cb1e145754cd1bc5526a/9c177/2-token.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcklEQVQoz32SaW7bMBBGfYFI3NfhNqJE0ZYT10D/9P4HK5gEbZwWBh4IEOCb+YaYE9NJ2AIJQ165tDMVE/kLYYpy/V8IUycmdSpVSPsyMcp1wpaxfZxYd2XgZebvhfhE+UzlH4ZsbGj9DeIilOfSLmvf+rW2y9qvtd9yPQLuAXsoHXLzEX0oEBfj0pCV9hBHZhsKV25pr5D3iGfIXcKuw65DH0CTNnPluLRCOSbskGcqv0yoy/YD2x3yhesyMU84DESYmZ0I+x6bMEXY5wdQrnE9L+1qfTYuG5+ly8wUblAYpNITJt/ff3L6eiFMRzwgotReGYCIPlUbqoGF60iFeyZPRCTc98stpDpT6QNm3CDiyEXlY5tHmXI9ER5zvbzeQx4yxCXhlnATys3P5Q+W7by2Q9tAufZxgVRDqtrF+Z+F+S5TrkvdsXbjImHK+OQgW58sZOMSE/aZTJg6H7f7z19rO2YqY1lL7WPbllFx9H8M/xty0EUpWAsuaQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Create Token&quot;
        title=&quot;Create Token&quot;
        src=&quot;/static/4ecc0a19a9e0cb1e145754cd1bc5526a/f058b/2-token.png&quot;
        srcset=&quot;/static/4ecc0a19a9e0cb1e145754cd1bc5526a/c26ae/2-token.png 158w,
/static/4ecc0a19a9e0cb1e145754cd1bc5526a/6bdcf/2-token.png 315w,
/static/4ecc0a19a9e0cb1e145754cd1bc5526a/f058b/2-token.png 630w,
/static/4ecc0a19a9e0cb1e145754cd1bc5526a/9c177/2-token.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Take note of the token.&lt;/p&gt;
&lt;p&gt;How did you take note of those secrets? Are they secret? Are they safe? Hopefully you have a good way of storing secrets already. If you aren’t using &lt;code class=&quot;language-text&quot;&gt;pass&lt;/code&gt;, the next section will take a look at that and maybe you’ll also consider it a useful tool for this kind of thing.&lt;/p&gt;
&lt;h2&gt;Using Pass to Help With Local Development &lt;a name=&quot;using-pass-to-help-with-local-development&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Install pass. I am on mac so did:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;brew install pass&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For Debian it’s:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo apt-get install pass&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See the &lt;a href=&quot;https://www.passwordstore.org/&quot;&gt;pass site&lt;/a&gt; for instructions about installing on other platforms.&lt;/p&gt;
&lt;p&gt;Now we will set up a &lt;a href=&quot;https://gnupg.org&quot;&gt;gpg&lt;/a&gt; key. This is what we will use for encryption in pass. I found &lt;a href=&quot;https://sanctum.geek.nz/arabesque/gnu-linux-crypto-gnupg-keys/&quot;&gt;this article&lt;/a&gt; good for learning more about gpg.&lt;/p&gt;
&lt;p&gt;Now pick a good passphrase. From now on I will refer to that as &lt;code class=&quot;language-text&quot;&gt;$PASSPHRASE&lt;/code&gt;. You will be asked to enter it while creating your key.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --gen-key&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check the key:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --list-keys&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;/you/.gnupg/pubring.kbx
----------------------------------------------------
pub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]
      AB3A5ED268BD87CD06F8F30B6881F49AF5BB8EAD
uid           [ultimate] you &amp;lt;you@email.com&gt;
sub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now copy the ID for that key. In the example above the ID is &lt;code class=&quot;language-text&quot;&gt;AB3A5ED268BD87CD06F8F30B6881F49AF5BB8EAD&lt;/code&gt;. From now on we will refer to that as &lt;code class=&quot;language-text&quot;&gt;$GPG_KEY&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now we will setup pass. Note, by default pass uses &lt;code class=&quot;language-text&quot;&gt;~/.password-store&lt;/code&gt;. If you want to keep your personal password store and your team one separate, you can configure separate directories.&lt;/p&gt;
&lt;p&gt;The directory pass uses can be configured like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;export PASSWORD_STORE_DIR=~/.work-password-store&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Example of an alias to use:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;alias workpass=&apos;PASSWORD_STORE_DIR=~/.work-password-store pass&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you decide to use an alias, replace &lt;code class=&quot;language-text&quot;&gt;pass&lt;/code&gt; with &lt;code class=&quot;language-text&quot;&gt;workpass&lt;/code&gt; (or whatever alias you setup) in all the following examples.&lt;/p&gt;
&lt;p&gt;Initialise pass:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass init $GPG_KEY&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Earlier, if you followed along, you created a GitHub token. Save the token with pass like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass insert GitHub/backstage-example-token
Enter password for GitHub/backstage-example-token:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can get the token back again:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass GitHub/backstage-example-token&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You will be prompted for a password the first time when reading a value from pass and again after the login times out.&lt;/p&gt;
&lt;p&gt;Use the token, extracting from pass, like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -H &quot;Authorization: token $(pass GitHub/backstage-example-token)&quot; -H &quot;Accept: application/vnd.github.v3+json&quot; https://api.github.com/user/repos&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;One advantage of this approach is you do not have to store the token in plaintext at any point or have it visible on your screen as you use the terminal. If you type &lt;code class=&quot;language-text&quot;&gt;history&lt;/code&gt; you won’t see any record of the password.&lt;/p&gt;
&lt;p&gt;In our example application we need 2 more secrets.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass insert GitHub/backstage-example-client-id&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass insert GitHub/backstage-example-client-secret&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There’s a lot of ways you could use these secrets now to run our sample app. I propose this one. Add a file somewhere on your machine or even in the repo with this content:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;export GITHUB_TOKEN=&quot;$(pass GitHub/backstage-example-token)&quot;
export AUTH_GITHUB_CLIENT_ID=&quot;$(pass GitHub/backstage-example-client-id)&quot;
export AUTH_GITHUB_CLIENT_SECRET=&quot;$(pass GitHub/backstage-example-client-secret)&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the following example I assume you created a file in the project directory with that content. Now run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;source secrets &amp;amp;&amp;amp; yarn dev&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All going well, you should have a login page:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c6d4c29fc7e34e45de742393b8185db9/9c177/3-oauth-app.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVQY09WLyw6CMBBF+9eu5AMUhRiNq7rD8BBqifwYzLSY0BlTujOoa09OJjeZe8VeFYmuUl0d2tvx0cRNHmUyyuTqct7U11N3T9s60eVOFbHKE12GvFX5OpOCnfNOXpomn4mZ+GktEXGAmB0xkb/B+SUA8c0BARDR2gERjenN2INZqAEI+5lx1swsFr6Nf/Kn4xfVl7vYaWTiLQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Backstage login&quot;
        title=&quot;Backstage login&quot;
        src=&quot;/static/c6d4c29fc7e34e45de742393b8185db9/f058b/3-oauth-app.png&quot;
        srcset=&quot;/static/c6d4c29fc7e34e45de742393b8185db9/c26ae/3-oauth-app.png 158w,
/static/c6d4c29fc7e34e45de742393b8185db9/6bdcf/3-oauth-app.png 315w,
/static/c6d4c29fc7e34e45de742393b8185db9/f058b/3-oauth-app.png 630w,
/static/c6d4c29fc7e34e45de742393b8185db9/9c177/3-oauth-app.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f042d6a34f000567bab37cdde46d8454/71ce0/4-popup.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 174.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAIAAAAblL1PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEpElEQVRIx5WV+29TZRjH+0f4uz+ZkGj4YVDXUcaGJLDNEfGSGBJvgwgqJhjdFuYPMsacl6BZtoG6YVCGW2WTiyQY0GGYmjC6rd0Fxii9n/Vyetqenut7Pa85PevahjbGp98073nf5/Oe53n6Pm9t9qMHn+86UtP+lr39cHN3597ej1t6ju053tF0orOpu2PP8fam7s7dn7Q3n+hs7e1q7e16+Yvjr3396Rv9n+0/ddJ25FjHrW9OfXmh7+z4+YmfL7pcrnPnfhwYGBz+bvj06TMDg0PDIyMDg0MjI2ddLtfY2Njo6OjY2Pj4+PgP50dtTzY6d+3cve+FV1paWpuaWurrG5+trXPUOR2ObVvtjlqH01HndNY3bNu23VHnrKvb/vQzm7faa2u22Gvstbafrl9TRJFb4+KmJWKxeDxmjmKxuCAI2Ww2P163gk8sHk+EIhGbIAiMMcMwWIlZj5Ho2ox7jlUxSqktJaSskVFijDFZVi7/en3qz2mLJ4SUOxgI4cpvZoxhjO/df+Ce9YQjXBUHYuN5vuKaNUkrzRfhKGduTA2D0jJhQimljBnYHJWv5nc04XQ6Y6ZEqaoDVYeWFB0ajPBZzRfJUYoBRIpWWNIARHgdtnIuhWUVGAa5dIvb/OrUppf+ONQ7L6lAA9Diy+BkMlkKKxoEEMUFpf7A9MG+pb4LwS2vT39/JcAYlVTwGJwvWAkMMMGrYXHTi7/3T0anluT6t/8+8e3yf8OKZsoMm9Ejny888dxvm/fffmrf1EpQIhRLim45FGG+ACs60CE2hUgyleJi/NDYcsdXd27+dS+RjEuKjogBMVV1CGGFnGFGlFLpLC9kFu+teBeXAwFfILB61313+p874ehaghe4WCInqxCRcphQFcAIF1v1+VdWfT5/MMLFZucX3XPeee/SvHfp/oOH7jmve86TzkoIWzC2JZPFnK2wASI6xBpAPn9wZtYjZERrBiBSHnYZDFUdbZwTVYcaQJasOuVrqZcUrARWND2bk0VJyebknKxag4woZXOyrOrFw1d+SNYbI53NzXkWvIvLsx7v6qOAZ2HZu7g8456fcc+FIpwGsawBpSJsFaxaC1HD7BNLGkAAPgZrAJo9nhfCBGFsCmFCsIkzyvKCqBQu9HNGlHz+oD8YDoajOVm1OkTTQSKtrYQk/5r8MCKthCSOVzAuhyk1crIaCIYfBUIRLrZRIQ1AUQZcUo0LWkwwv9M5HaEqYReStHreMlrIxhRAFXImOkCMsHXlE6SYGaj4aAkjCiAqC5sxtpqK7r36UfOVoy1XPrDUdqPnwM2T+651NF82J1uvftg4+c4Zzy/MMD9l8Aof3jX53o6JQ40ThxvyarvR03ajZ/el93dcPNQwcXjn5Lv28Tf7Z11FeKMlIcQGZhQaFDFT0AAAAx3jjRlkZkEgLTRGoasMwyCEEPO6NHctVM4qUvFHpgbFlBRvTwvO37IMQhgMhVMpgeO4YCgYT6Y5HobieiID11IwkgQ5BW84lzSG+VaKCcmKoqqosiyLOVFRNUnFWQnJGpYULMoYQGLFWAYb1f8Zqhmh1BaNRjOZTPJ/Gs/zgiD8C2oTPR9c4+CWAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;GitHub OAuth popup&quot;
        title=&quot;GitHub OAuth popup&quot;
        src=&quot;/static/f042d6a34f000567bab37cdde46d8454/71ce0/4-popup.png&quot;
        srcset=&quot;/static/f042d6a34f000567bab37cdde46d8454/c26ae/4-popup.png 158w,
/static/f042d6a34f000567bab37cdde46d8454/6bdcf/4-popup.png 315w,
/static/f042d6a34f000567bab37cdde46d8454/71ce0/4-popup.png 463w&quot;
        sizes=&quot;(max-width: 463px) 100vw, 463px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/610014fe98cfc13c1df896c5ef877703/c946b/5-backstage.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVQoz02Q3U/TYBSHe+2YGgFDDMRELki84MKoEAQ2vmUIxCBo+IgxmbJhMBtdGYOuCyLIDUT/GG808UbUbVGBMcdYwj5KV7ZB9nY2bG3f9n1NR0z85cnJk3NxkvMjauvqGkz32siZ9lcvTA5bm2Pa7LSbHDaz094ya220TjRaJ25NTzVaxxuejtZPjdRPjdQ+GbrysPfCAzNRW3/jekfL8Mby+Lu1sc2V4XVmdGNlYG2pf3VxbPNN/6rHxMxZVhfbvc5rzx8bxgeMk4MXJwfLMkRUX7p8s7Pd8tZrWXb3+SjL64VeH2VecnZ7yU56roshu7xk68LsHdLW5LI3Uy+bXDN3SZtpyfFo3UdUVlYyDIMxzmaPVVWGiqTIRYyRIhc1VUZIleWiqpQQUjVVgUoJY60MwhgRNTU1DOPLCDgYPv4dB9GkEEmAg1QhEgf7CSGaLETi+UgCxNg/sSMxmiocpAq6s4UYWyCuVldT7kXH+71Ox1bf/I9eV+A+Fewh/T0ufzcZ6NYl0EUGW2yfbj/70Gr/3OH0N9m/Ns/oEBUVFRQ1H4plPm5FvvxMBMN8MMwHwnxgj/OHOH8oHdjT+bbDbv1Kft9hdd/lziEMBoPb7c5l+XBo+zjNalBSlZIGJYzU88ewBjFSMIIYq/rUyl5GL4ymaZ7nt3d2Uyk2kUgeHsYzmWweAI5Ls+xRSZIQxhpC+iWEtP8gqqqqaJoWBGF/P8pxnCiKAIB8Pg8AyOVygiBACHE5kiSpqor/RdM0wmg0ejweCGE6nQYAyLIsSZIoiicnJwAAjLFSjizLp6enZ2dnEMLzTbFY/Aub/8SLjJOGggAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Logged in&quot;
        title=&quot;Logged in&quot;
        src=&quot;/static/610014fe98cfc13c1df896c5ef877703/f058b/5-backstage.png&quot;
        srcset=&quot;/static/610014fe98cfc13c1df896c5ef877703/c26ae/5-backstage.png 158w,
/static/610014fe98cfc13c1df896c5ef877703/6bdcf/5-backstage.png 315w,
/static/610014fe98cfc13c1df896c5ef877703/f058b/5-backstage.png 630w,
/static/610014fe98cfc13c1df896c5ef877703/c946b/5-backstage.png 805w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Backing Up Secrets &lt;a name=&quot;backing-up-secrets&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I did make a comment earlier that you shouldn’t store secrets in a git repo (even a private one) but it can be OK to store encrypted secrets in one. As long as you don’t store the key along with it of course. Pass does store structural data like the name of the secret so be aware of that when using with git. &lt;strong&gt;The secrets are encrypted but the names are not&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;For this next step you should have a remote git repository you feel comfortable using to backup encrypted secrets.&lt;/p&gt;
&lt;p&gt;Type:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass git init&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Add an origin as in this example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass git remote add origin git@github.com:you/your-pass.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To sync all those secrets we created already do:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass git push -u --all&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For subsequent updates do:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass git push&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should now see the encrypted secrets up in the repo.&lt;/p&gt;
&lt;p&gt;Here’s an example in a temporary GitHub repo I created for this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/427917a686929fa726c2b8f86949f3ba/9c177/6-repo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQY02WPW27DMAwEfYE21osPUZQoq3YdNOj9j1cobfORAPNBEhjsckkoIXFCASohMmAOiYE0Qkau886aqCDX1cMTiwu4evCRRTfg6rGxWIT8vsaLSw9ezSmvHi4uRZRxfrX+KXbtH9fSBuVKueIdIHUBn/iTV5cCMEgFVuTyW5XFKLcpswKV11gXcHksUjcbZ9sOGyeLvV3Cu4uJChcjaVm76MbasxoXSyj/yfNnsnHu1+9x3MZxUzsiaQDJddR+FNvV9toPtb3YXtrOpQeQ5dEBSElmT8rNJ/ZxEkESlYR3SCf3OaTsI/8A7zknumyKiQUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Secrets backed up&quot;
        title=&quot;Secrets backed up&quot;
        src=&quot;/static/427917a686929fa726c2b8f86949f3ba/f058b/6-repo.png&quot;
        srcset=&quot;/static/427917a686929fa726c2b8f86949f3ba/c26ae/6-repo.png 158w,
/static/427917a686929fa726c2b8f86949f3ba/6bdcf/6-repo.png 315w,
/static/427917a686929fa726c2b8f86949f3ba/f058b/6-repo.png 630w,
/static/427917a686929fa726c2b8f86949f3ba/9c177/6-repo.png 880w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Adding a Team Member &lt;a name=&quot;adding-a-team-member&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;For now let’s assume you want to share that secret store we just created with another team member. We will go through each step required to allow that. It’s a bit tedious but only needs to be done once per team member. We will look at adding members as readonly and as read/write.&lt;/p&gt;
&lt;h3&gt;Readonly&lt;/h3&gt;
&lt;p&gt;For a new team member to get setup they must:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Setup a gpg key&lt;/li&gt;
&lt;li&gt;Export and send the public key to you&lt;/li&gt;
&lt;li&gt;Install pass&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then you must:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Trust their key&lt;/li&gt;
&lt;li&gt;Re-encrypt the store with the new key&lt;/li&gt;
&lt;li&gt;Push the updated store to the git repo&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then they must:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Clone the pass store (or pull down the updates if they cloned already)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Tutorial of those steps&lt;/h3&gt;
&lt;p&gt;Assuming our new team member has already generated a key, they will run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --list-keys&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;/your-colleague/.gnupg/pubring.kbx
----------------------------------------------------
pub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]
      C351DB397FDFFD4499AB760435C0B93754D6ACD0
uid           [ultimate] your-colleague &amp;lt;your-colleague@email.com&gt;
sub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;They must copy the ID for the key to export it as in this example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --export --armor C351DB397FDFFD4499AB760435C0B93754D6ACD0 &gt; pass-publickey.asc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now they must send the key file to you. It is reasonably safe to send a public key over email or chat but if you have a secure way to share the key, even better.&lt;/p&gt;
&lt;p&gt;Next they can clone the store. This example clones to the default password store directory:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:you/your-pass.git ~/.password-store&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If the team member already uses pass or wants to keep the team and personal stores separate, they can use the method we looked at before:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:you/your-pass.git ~/.work-password-store

alias workpass=&apos;PASSWORD_STORE_DIR=~/.work-password-store pass&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point they will be able to list the secrets but not read them:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass
Password Store
├── GitHub
│   ├── backstage-example-client-id
│   ├── backstage-example-client-secret
│   └── backstage-example-token&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The next step is done on your machine.&lt;/p&gt;
&lt;p&gt;Assume your team members sent you their public key in a file called &lt;code class=&quot;language-text&quot;&gt;pass-publickey.asc&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --import pass-publickey.asc

gpg --list-keys&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see an output with something similar to this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;/you/.gnupg/pubring.kbx
----------------------------------------------------
pub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]
      AB3A5ED268BD87CD06F8F30B6881F49AF5BB8EAD
uid           [ultimate] you &amp;lt;you@email.com&gt;
sub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]

pub   rsa3072 2020-11-02 [SC] [expires: 2022-11-02]
      C351DB397FDFFD4499AB760435C0B93754D6ACD0
uid           [unknown] your-colleague &amp;lt;your-colleague@email.com&gt;
sub   rsa3072 2020-11-02 [E] [expires: 2022-11-02]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You have added the key for ‘your-colleague’. We now need to trust the key. Notice that your key has &lt;code class=&quot;language-text&quot;&gt;[ultimate]&lt;/code&gt; but the new one has &lt;code class=&quot;language-text&quot;&gt;[unknown]&lt;/code&gt;. Also note the ID for the new key. That’s &lt;code class=&quot;language-text&quot;&gt;C351DB397FDFFD4499AB760435C0B93754D6ACD0&lt;/code&gt; in the example above. From now on we will refer to that key as &lt;code class=&quot;language-text&quot;&gt;$GPG_ID&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;export GPG_ID=&apos;C351DB397FDFFD4499AB760435C0B93754D6ACD0&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Edit the key. This will activate and interactive session with gpg.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --edit-key $GPG_ID&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Type the trust command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg&gt; trust&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pub  rsa3072/35C0B93754D6ACD0
     created: 2020-11-02  expires: 2022-11-02  usage: SC
     trust: unknown      validity: unknown
sub  rsa3072/84E6664F5F6A5734
     created: 2020-12-16  expires: 2022-12-16  usage: E
[unknown] (1). your-colleague &amp;lt;your-colleague@email.com&gt;

Please decide how far you trust this user to correctly verify other users&apos; keys
(by looking at passports, checking fingerprints from different sources, etc.)

  1 = I don&apos;t know or won&apos;t say
  2 = I do NOT trust
  3 = I trust marginally
  4 = I trust fully
  5 = I trust ultimately
  m = back to the main menu

Your decision? 5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Say yes until it is accepted and then exit gpg.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Do you really &lt;strong&gt;need&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;ultimate&lt;/code&gt;? You do not necessarily need it but it will get very annoying if you use a lower level of trust so I would say just go with ultimate.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Now you need to update the password store with the new key as in this example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass init `cat $PASSWORD_STORE_DIR/.gpg-id` $GPG_ID&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That command is short hand for listing every public key ID in the init command. We store the ID for each public key, representing each team member, in the &lt;code class=&quot;language-text&quot;&gt;.gpg-id&lt;/code&gt; file in the repo. This command will add the new public key ID to the &lt;code class=&quot;language-text&quot;&gt;.gpg-id&lt;/code&gt; file and re-encrypt the store. This will allow your team member to decrypt the store with their key but they will not be able to encrypt.&lt;/p&gt;
&lt;p&gt;Run &lt;code class=&quot;language-text&quot;&gt;pass git push&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Your team member can now run &lt;code class=&quot;language-text&quot;&gt;pass git pull&lt;/code&gt; or just do a &lt;code class=&quot;language-text&quot;&gt;git pull&lt;/code&gt; in the password store directory.&lt;/p&gt;
&lt;p&gt;Now your team member can run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass GitHub/backstage-example-token&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;They should see the decrypted secret.&lt;/p&gt;
&lt;h3&gt;Read/Write&lt;/h3&gt;
&lt;p&gt;To allow your team member to encrypt the store they must have trusted all the public keys in the &lt;code class=&quot;language-text&quot;&gt;.gpg-id&lt;/code&gt; file. Their own public key must also have been trusted on the machine that encrypted the store last. We essentially need to setup a circle of trust with gpg keys.&lt;/p&gt;
&lt;p&gt;I think it’s reasonable to actually commit all public gpg keys to the pass store repository to make it easy for a new team member to go through and trust each one. It’s possible to script this although I don’t have a good script handy since gpg edit is interactive and I haven’t used this in a team big enough where it was too annoying to trust each key one by one.&lt;/p&gt;
&lt;p&gt;So to get write access, you follow the same steps that we did for &lt;a href=&quot;#readonly&quot;&gt;Readonly&lt;/a&gt; but with an additional step to trust all existing public keys on the machine that wants write permissions.&lt;/p&gt;
&lt;p&gt;All those steps are true for every new member we add. Everyone must have all the public keys and have trusted them.&lt;/p&gt;
&lt;h2&gt;Removing a Team Member &lt;a name=&quot;removing-a-team-member&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;If you ever need to remove a team member, remove their public key from the &lt;code class=&quot;language-text&quot;&gt;.gpg-id&lt;/code&gt; file and re-encrypt the store.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass init `cat $PASSWORD_STORE_DIR/.gpg-id`&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Conclusion &lt;a name=&quot;conclusion&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;From this point on the secret store will work as a git repository and all the considerations will apply there around keeping in sync and handling conflicts. You may want to protect the main branch and use pull requests for modifying secrets for example.&lt;/p&gt;
&lt;p&gt;Of course consider some good practices here. I would not use this to store highly sensitive data or production credentials. There’s always a risk someone can get hold of this but that is always the case. At least keeping the data encrypted at rest gives you the best chance of avoiding accidental leaks during a normal development workflow.&lt;/p&gt;
&lt;p&gt;This is one method I have seen evolve over years of dealing with secrets in teams. I hope this description helps. If you have more interesting ways of doing this I would love to hear about them! Also if you see something I got wrong here, I’d really appreciate if you let me know.&lt;/p&gt;
&lt;h2&gt;Command Summary &lt;a name=&quot;command-summary&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;h3&gt;Setting up a new pass store&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --gen-key&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check the key:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --list-keys&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You need to copy the key ID. This gets just the key IDs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --list-keys --with-colons | grep fpr | cut -d: -f10&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Setup pass:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;export GPG_KEY=&apos;you-key-id&apos;
pass init $GPG_KEY
pass insert some-secret
pass git init
pass git push -u --all&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Getting read access to an existing store&lt;/h3&gt;
&lt;p&gt;Generate a gpg key as above.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --export --armor $GPG_KEY &gt; pass-publickey.asc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Send &lt;code class=&quot;language-text&quot;&gt;pass-publickey.asc&lt;/code&gt; to someone who can decrypt the store.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;On their machine:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --import pass-publickey.asc
gpg --edit-key $GPG_ID

gpg&gt; trust&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Trust the key ultimately.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass init `cat $PASSWORD_STORE_DIR/.gpg-id` $GPG_ID
pass git push&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Back on your machine:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Either:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:you/your-pass.git ~/.password-store&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;or if you already setup the repo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pass git pull&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Getting write access to an existing store&lt;/h3&gt;
&lt;p&gt;Same as read access but you also need to trust each public key in &lt;code class=&quot;language-text&quot;&gt;.gpg-id&lt;/code&gt;. Either each team member send you their exported key or you have them stored in one place. Maybe in the pass store repo itself?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;For each gpg key:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gpg --import ${the-key-file}
gpg --edit-key $GPG_ID

gpg&gt; trust&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Tech stuff found in the second half of 2020]]></title><description><![CDATA[2020 has not been the best year ever but with more time at home and less time commuting I did find time to read and discover more online…]]></description><link>https://ruarfff.com/tech-stuff-found-2nd-half-2020/</link><guid isPermaLink="false">https://ruarfff.com/tech-stuff-found-2nd-half-2020/</guid><pubDate>Thu, 31 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;2020 has not been the best year ever but with more time at home and less time commuting I did find time to read and discover more online. The following is a list of the best resources I have found while trying to become a better developer in the second half of 2020.&lt;/p&gt;
&lt;h2&gt;Contents&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#community&quot;&gt;Community&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#projects-and-tools&quot;&gt;Projects&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#learning-and-practice&quot;&gt;Learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#good-news&quot;&gt;Good News&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#videos&quot;&gt;Videos&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#articles-and-sites&quot;&gt;Articles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#podcasts&quot;&gt;Podcasts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#conferences&quot;&gt;Conferences&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#books&quot;&gt;Books&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#funny&quot;&gt;Funny&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#gadgets&quot;&gt;Gadgets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#twitter&quot;&gt;Twitter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#coding-music&quot;&gt;Coding Music&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Community &lt;a name=&quot;community&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In the second half of this year, I discovered &lt;a href=&quot;https://www.indiehackers.com/&quot;&gt;Indie Hackers&lt;/a&gt;. I really like the content and ideas there. If you are looking to work on a side project it’s certainly worth a look.&lt;/p&gt;
&lt;h2&gt;Projects and Tools &lt;a name=&quot;projects-and-tools&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A brief list of the best tools I discovered and used recently.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://backstage.io/&quot;&gt;Backstage&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When I worked at Spotify I was blown away by the internal tooling and how quickly I could get set up and deploying code. I got to use an early version of the developer portal there which has since been opensourced. We are using this at my company now and it’s really worth a look if you want a nice way to do internal tooling.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/backstage/backstage&quot;&gt;Backtsage GitHub repo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://www.hashicorp.com/blog/hashicorp-boundary&quot;&gt;Hashicorp Boundary&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Most access tools I’ve had to use kind of suck if your job is actually making stuff (looking at you Cyberark). &lt;a href=&quot;https://www.boundaryproject.io/&quot;&gt;Hashicorp Boundary&lt;/a&gt; looks like a really promising alternative so far.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://github.blog/2020-09-17-github-cli-1-0-is-now-available/&quot;&gt;GitHub CLI&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;GitHub CLI is a great tool and a lot of fun to use.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/cli/cli&quot;&gt;GitHub CLI repo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://sizzy.co/&quot;&gt;Sizzy&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A browser for devs that is very cool.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/kubectl&quot;&gt;ZSH Kubectl plugin&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I use &lt;a href=&quot;https://www.zsh.org/&quot;&gt;zsh&lt;/a&gt; + &lt;a href=&quot;https://github.com/ohmyzsh/ohmyzsh&quot;&gt;ohmyzsh&lt;/a&gt; and I work with Kubernetes a bit. It only occurred to me to use the kubectl plugin for zsh recently which is silly but I am happy I am using it now.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://www.jetbrains.com/help/idea/code-with-me.html&quot;&gt;Jetbrains Code with me&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;VSCode has had &lt;a href=&quot;https://code.visualstudio.com/learn/collaboration/live-share&quot;&gt;Live Share&lt;/a&gt; for a while. A lot of people prefer Jetbrains tools though so I was happy to see this: &lt;a href=&quot;https://www.jetbrains.com/help/idea/code-with-me.html&quot;&gt;https://www.jetbrains.com/help/idea/code-with-me.html&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Learning and Practice &lt;a name=&quot;learning-and-practice&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;This article encouraged me to make this list &lt;a href=&quot;https://www.learninpublic.org/v1-principles-learn-in-public.pdf&quot;&gt;https://www.learninpublic.org/v1-principles-learn-in-public.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://testingjavascript.com/&quot;&gt;Testing JavaScript&lt;/a&gt; is unfortunately quite expensive but this is a subject I keep struggling with despite having a lot of experience with it. That course has changed how I think about writing tests in JavaScript and has made me feel more confident that I understand what’s going on now.&lt;/p&gt;
&lt;p&gt;If you want to learn about using GCP (Google Cloud Platform), &lt;a href=&quot;https://www.qwiklabs.com/&quot;&gt;QwikLabs&lt;/a&gt; is a great resource where you learn by doing.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://repl.it/&quot;&gt;repl.it&lt;/a&gt; is a site that seems to consistently deliver amazing content and is also a very nice site to use. I recommend signing up for the newsletter.&lt;/p&gt;
&lt;p&gt;I am not looking to interview soon but I suffer serious interview anxiety. To help reduce the stress I practice as often as I can. I love the 30 days challenges at &lt;a href=&quot;https://leetcode.com/&quot;&gt;LeetCode&lt;/a&gt;.
My last attempt (I didn’t finish the month) &lt;a href=&quot;https://github.com/ruarfff/leetcode-typescript-practice&quot;&gt;https://github.com/ruarfff/leetcode-typescript-practice&lt;/a&gt;.
Will try again in January.&lt;/p&gt;
&lt;p&gt;I love to code games but I haven’t done much of that since college. I get to dabble a little in it using &lt;a href=&quot;https://screeps.com/&quot;&gt;Screeps&lt;/a&gt;. An RTS game where you code the AI for your units. It’s a lot of fun and good coding practice.&lt;/p&gt;
&lt;p&gt;This is my admittedly poor attempt so far: &lt;a href=&quot;https://github.com/ruarfff/screeps-scripts&quot;&gt;https://github.com/ruarfff/screeps-scripts&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This massive list of resources to learn and practice with:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/charlax/professional-programming&quot;&gt;https://github.com/charlax/professional-programming&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Good News &lt;a name=&quot;good-news&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Just some good tech news I came across recently.&lt;/p&gt;
&lt;p&gt;I did not realise that cookie banners were only required if you use cookies not needed for a site to function i.e. evil tracking cookies and the like. This is good news from GitHub:
&lt;a href=&quot;https://github.blog/2020-12-17-no-cookie-for-you/&quot;&gt;https://github.blog/2020-12-17-no-cookie-for-you/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I love Hashicorp. I for sure might be wrong but I consider this good news for people like me who spend a lot of time automating deployments and I am very much looking forward to trying it out: &lt;a href=&quot;https://www.hashicorp.com/blog/announcing-waypoint&quot;&gt;https://www.hashicorp.com/blog/announcing-waypoint&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Videos &lt;a name=&quot;videos&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I could watch GeePaw code all day. There’s something so modest and natural about this series. It doesn’t make me feel stupid and I am learning a lot from it: &lt;a href=&quot;https://www.geepawhill.org/series/real-programming/&quot;&gt;https://www.geepawhill.org/series/real-programming/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Rich Hickey is a great speaker and &lt;a href=&quot;https://clojure.org/&quot;&gt;clojure&lt;/a&gt; is my most favourite language I never use for anything:&lt;/p&gt;
&lt;iframe
        width=&quot;560&quot;
        height=&quot;400&quot;
        src=&quot;https://www.youtube.com/embed/MCZ3YgeEUPg&quot;
        frameborder=&quot;0&quot;
        allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;p&gt;If you have been struggling to get going with machine learning despite lots of &lt;a href=&quot;https://www.coursera.org/&quot;&gt;Coursera&lt;/a&gt; courses done, the insights here might be interesting to you:&lt;/p&gt;
&lt;iframe
        width=&quot;560&quot;
        height=&quot;400&quot;
        src=&quot;https://www.youtube.com/embed/EHXwFhitqvo&quot;
        frameborder=&quot;0&quot;
        allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;h2&gt;Articles and Sites &lt;a name=&quot;articles-and-sites&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Despite all the improvements in hardware, software performance, in general, doesn’t feel like it has improved at the same speed. This is an interesting read on that subject:
&lt;a href=&quot;https://fabiensanglard.net/silicone/&quot;&gt;https://fabiensanglard.net/silicone/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Some crazy JavaScript demos: &lt;a href=&quot;https://www.dwitter.net/&quot;&gt;https://www.dwitter.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Something I used in college but only rediscovered recently &lt;a href=&quot;https://processing.org/&quot;&gt;https://processing.org/&lt;/a&gt;. It’s a very interesting project to help with visualisations in code.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geepawhill.org/&quot;&gt;GeePaw&lt;/a&gt; is great. These articles are particularly good ones I read recently:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geepawhill.org/2020/07/17/the-rat-rework-avoidance-theory/&quot;&gt;https://www.geepawhill.org/2020/07/17/the-rat-rework-avoidance-theory/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geepawhill.org/2020/08/14/pathing-a-style-of-laying-out-work/&quot;&gt;https://www.geepawhill.org/2020/08/14/pathing-a-style-of-laying-out-work/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I don’t think I will ever go into management but I still love every post by &lt;a href=&quot;https://twitter.com/mipsytipsy&quot;&gt;@mipsytipsy&lt;/a&gt; at &lt;a href=&quot;https://charity.wtf/&quot;&gt;https://charity.wtf/&lt;/a&gt;. I appreciate the extra insight I get about management.&lt;/p&gt;
&lt;p&gt;If you have worked in a “big corp”, you have almost certainly encountered bad COTS (“commercial, off the shelf” software): &lt;a href=&quot;https://sboots.ca/2020/09/16/fake-cots-and-the-one-day-rule/&quot;&gt;https://sboots.ca/2020/09/16/fake-cots-and-the-one-day-rule/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pretty much every article by &lt;a href=&quot;https://twitter.com/KentBeck&quot;&gt;Kent Beck&lt;/a&gt; is great. This is a good one I read recently:
&lt;a href=&quot;https://medium.com/@kentbeck_7670/monolith-services-theory-practice-617e4546a879&quot;&gt;https://medium.com/@kentbeck_7670/monolith-services-theory-practice-617e4546a879&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;A reminder about the risk in crypto:
&lt;a href=&quot;https://decrypt.co/51692/a-crypto-user-sent-50000-to-a-smart-contract-its-gone-forever&quot;&gt;https://decrypt.co/51692/a-crypto-user-sent-50000-to-a-smart-contract-its-gone-forever&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Generally, I am not a fan of the “why I left some big tech company” posts but there was something really nice about this one:
&lt;a href=&quot;https://mtlynch.io/why-i-quit-google/&quot;&gt;https://mtlynch.io/why-i-quit-google/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Some tips on working on a side project while not immediately having to quit the day job: &lt;a href=&quot;https://www.indiehackers.com/article/f7697df2d7&quot;&gt;https://www.indiehackers.com/article/f7697df2d7&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you ever worked at a “big corp”, you have probably encountered pain with certs on the network. This series helped me understand this stuff better and I learned a bit of rust too:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://dev.to/wayofthepie/a-rust-cli-for-decoding-certs-280i&quot;&gt;https://dev.to/wayofthepie/a-rust-cli-for-decoding-certs-280i&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Bit of a cheat here since this site isn’t really on tech but it isn’t 100% not tech either and I love it a lot: &lt;a href=&quot;https://www.brainpickings.org/&quot;&gt;https://www.brainpickings.org/&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Podcasts &lt;a name=&quot;podcasts&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I listen to a great many tech podcasts. One I discovered late in 2020 is the Idealcast and I highly recommend it for its positivity and thought-provoking content:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://itrevolution.com/the-idealcast-podcast/&quot;&gt;https://itrevolution.com/the-idealcast-podcast/&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Conferences &lt;a name=&quot;conferences&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I was lucky to get to go to &lt;a href=&quot;https://events.itrevolution.com/&quot;&gt;The DevOps Summit&lt;/a&gt; in October. The focus was largely on dealing with problems in large organisations and more on culture than tech but this is a problem I care a lot about lately. I really loved this conference and how they made the virtual &amp;#x26; remote aspects work well. I loved chatting with the speakers in slack for example.&lt;/p&gt;
&lt;p&gt;I also got to attend &lt;a href=&quot;https://githubuniverse.com/&quot;&gt;GitHub Universe&lt;/a&gt;. It’s one of the most fun conferences for developers I think as you end up trying out so many new things at it. They have done a great job of going virtual too.&lt;/p&gt;
&lt;h2&gt;Books &lt;a name=&quot;books&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;When I was at the DevOps Summit I attended a talk by &lt;a href=&quot;https://markschwartz.me/&quot;&gt;Mark Schwartz&lt;/a&gt; and learned about his new book &lt;a href=&quot;https://itrevolution.com/delicate-art-of-bureaucracy/&quot;&gt;The (Delicate) Art of Bureaucracy&lt;/a&gt;. It’s not the kind of book I would ever have thought to buy, to be honest, but the talk was so entertaining I decided to give it a go. It ended up being one of my favourite books this year. If you struggle with bureaucracy in any aspect of life, you will likely find something useful in this book.&lt;/p&gt;
&lt;p&gt;Brain melting assembly problems &lt;a href=&quot;https://www.xorpd.net/pages/xchg_rax/snip_00.html&quot;&gt;https://www.xorpd.net/pages/xchg_rax/snip_00.html&lt;/a&gt;. I can’t really review this book except to say it hurts my brain but I still love it. It’s free but you can support the author by getting a hard copy.&lt;/p&gt;
&lt;p&gt;I got into coding late in life and really messed up in my younger years by completely ignoring maths. The book &lt;a href=&quot;https://www.manning.com/books/math-for-programmers&quot;&gt;Math for Programmers&lt;/a&gt; has helped me catch up a little bit and fill in some of the gaps in my knowledge left by a squandered youth.&lt;/p&gt;
&lt;p&gt;I read the first edition of &lt;strong&gt;Release It!&lt;/strong&gt; by &lt;a href=&quot;https://www.michaelnygard.com/&quot;&gt;Michael Nygard&lt;/a&gt; about 5 years ago and it changed how I thought about running apps in production in a big way. I am now reading &lt;a href=&quot;https://pragprog.com/titles/mnee2/release-it-second-edition/&quot;&gt;Release It! Second Edition&lt;/a&gt; and I am learning just as much again looking at it with more personal experience and enjoying some nice updates in the book.&lt;/p&gt;
&lt;h2&gt;Funny &lt;a name=&quot;funny&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Some amazing CSS &lt;a href=&quot;https://tholman.com/obnoxious/&quot;&gt;https://tholman.com/obnoxious/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Microservices&lt;/strong&gt;&lt;/p&gt;
&lt;iframe
        width=&quot;560&quot;
        height=&quot;400&quot;
        src=&quot;https://www.youtube.com/embed/y8OnoxKotPQ&quot;
        frameborder=&quot;0&quot;
        allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;p&gt;&lt;strong&gt;All your programming pain in one video…&lt;/strong&gt;&lt;/p&gt;
&lt;iframe
        width=&quot;560&quot;
        height=&quot;400&quot;
        src=&quot;https://www.youtube.com/embed/ePhAj8ktiEA&quot;
        frameborder=&quot;0&quot;
        allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;h2&gt;Gadgets &lt;a name=&quot;gadgets&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The only gadget I bought for my dev setup in the last 6 months was this keyboard: &lt;a href=&quot;https://dygma.com/&quot;&gt;https://dygma.com/&lt;/a&gt;. It is absolutely amazing.&lt;/p&gt;
&lt;p&gt;This just looks so cool and I want one: &lt;a href=&quot;https://www.clockworkpi.com/devterm&quot;&gt;https://www.clockworkpi.com/devterm&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Twitter &lt;a name=&quot;twitter&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;On needing a good strategy and vision from your leadership (a thread):&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;a big learning the last year is the degree to which your most passionate team members will *expect* leaders/managers to coherently frame strategy&lt;br&gt;&lt;br&gt;this is where &amp;quot;autonomy&amp;quot; often hits a snag. Leaders assume it means &amp;quot;bottom up&amp;quot; planning. But that isn&amp;#39;t it ... (1/n)&lt;/p&gt;&amp;mdash; John Cutler (@johncutlefish) &lt;a href=&quot;https://twitter.com/johncutlefish/status/1338224893645651968?ref_src=twsrc%5Etfw&quot;&gt;December 13, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;On things going bad in a rewrite and sunk cost fallacy (a thread):&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-conversation=&quot;none&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;So a team was formed to build a new mobile architecture for this new app. The driving charter for the team was to build an architecture that would “sustain mobile development at Uber for the next 5 years”. We did both platforms at once. Product and Design also started over.&lt;/p&gt;&amp;mdash; McLaren Stanley (@StanTwinB) &lt;a href=&quot;https://twitter.com/StanTwinB/status/1336893874904567808?ref_src=twsrc%5Etfw&quot;&gt;December 10, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;A profound thought on hackathons:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Companies think, “oh, we should have hackathons!” and miss that _actually_ they should have an organization where hackathons are worth having.&lt;/p&gt;&amp;mdash; Beth (@bethcodes) &lt;a href=&quot;https://twitter.com/bethcodes/status/1320165499863396352?ref_src=twsrc%5Etfw&quot;&gt;October 25, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;It’s always DNS:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://twitter.com/makdaam/status/1313858239298260993&quot;&gt;https://twitter.com/makdaam/status/1313858239298260993&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Interesting war story (a thread):&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Back story.&lt;br&gt;&lt;br&gt;Way back I worked in a PPT factory at an investment bank. Our job was to assemble “decks” for investment bankers. The operation ran 24hrs a day with dozens of “operators”.&lt;br&gt;&lt;br&gt;Young bankers would work CRAZY hours.&lt;br&gt;&lt;br&gt;Reflecting (1/n)&lt;/p&gt;&amp;mdash; John Cutler (@johncutlefish) &lt;a href=&quot;https://twitter.com/johncutlefish/status/1312536583401160704?ref_src=twsrc%5Etfw&quot;&gt;October 3, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;On being an opensource dev:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Them: I contribute to open source.&lt;br&gt;Me: &lt;a href=&quot;https://t.co/kwvSh71s04&quot;&gt;pic.twitter.com/kwvSh71s04&lt;/a&gt;&lt;/p&gt;&amp;mdash; 👉😎👉 Jay Phelps (@_jayphelps) &lt;a href=&quot;https://twitter.com/_jayphelps/status/1310776927599423489?ref_src=twsrc%5Etfw&quot;&gt;September 29, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;Same:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;My productivity algorithm is something like:&lt;br&gt;&lt;br&gt;* Start to do something&lt;br&gt;&lt;br&gt;* Remember higher-priority thing, switch to doing that&lt;br&gt;&lt;br&gt;* Remember that high-priority thing is hard&lt;br&gt;&lt;br&gt;* Do nothing&lt;/p&gt;&amp;mdash; Sean Carroll (@seanmcarroll) &lt;a href=&quot;https://twitter.com/seanmcarroll/status/1306613673952149504?ref_src=twsrc%5Etfw&quot;&gt;September 17, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;GraphQL VS Rest:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Someone shouted “GraphQL is a better REST” and then this happened &lt;a href=&quot;https://t.co/eHO36cUAit&quot;&gt;pic.twitter.com/eHO36cUAit&lt;/a&gt;&lt;/p&gt;&amp;mdash; Marc-André Giroux (@__xuorig__) &lt;a href=&quot;https://twitter.com/__xuorig__/status/1303673198500814848?ref_src=twsrc%5Etfw&quot;&gt;September 9, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;How I felt when I saw JSS:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-dnt=&quot;true&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;js devs applying js solutions to css problems &lt;a href=&quot;https://t.co/umxJJgt3Yf&quot;&gt;pic.twitter.com/umxJJgt3Yf&lt;/a&gt;&lt;/p&gt;&amp;mdash; I Am Devloper (@iamdevloper) &lt;a href=&quot;https://twitter.com/iamdevloper/status/1303268890638778368?ref_src=twsrc%5Etfw&quot;&gt;September 8, 2020&lt;/a&gt;&lt;/blockquote&gt;

&lt;h2&gt;Coding Music &lt;a name=&quot;coding-music&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://open.spotify.com/playlist/5e1dfPbE4qElO9wCQ2AOCm?si=cD2-ZYDnSsu8aENDufNP5A&quot;&gt;&lt;iframe src=&quot;https://open.spotify.com/embed/playlist/5e1dfPbE4qElO9wCQ2AOCm&quot; width=&quot;100%&quot; height=&quot;400&quot; frameborder=&quot;0&quot; allowtransparency=&quot;true&quot; allow=&quot;encrypted-media&quot;&gt;&lt;/iframe&gt;&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Does Test Driven Development Work?]]></title><description><![CDATA[Introduction Bertrand Russell was concerned about the issue of having to accept certain axioms to be able to proceed with an education in…]]></description><link>https://ruarfff.com/does-tdd-work/</link><guid isPermaLink="false">https://ruarfff.com/does-tdd-work/</guid><pubDate>Mon, 24 Sep 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Bertrand_Russell&quot;&gt;Bertrand Russell&lt;/a&gt; was concerned about the issue of having to accept certain axioms to be able to proceed with an education in mathematics even though those axioms had not necessarily been rigorously proven. He treats aspects of this in his book &lt;a href=&quot;https://people.umass.edu/klement/imp/imp-ebk.pdf&quot;&gt;An Introduction to Mathematical Philosophy&lt;/a&gt;. An example that is given in the &lt;a href=&quot;http://www.bbc.co.uk/programmes/b01p8fsr&quot;&gt;In Our Time Episode&lt;/a&gt; about Bertrand Russell is, for any two points in space there exists a line between those two points. This is intuitive but no proof existed of the truth of it. One major problem with a lack of proof is that, even if something might be intuitive, it is possible to argue that thing is not intuitive to you, or some other answer is more intuitive and there is no proof to appeal to that says an argument is right or wrong.&lt;/p&gt;
&lt;p&gt;A question that will be explored in this post is, do we have any proof that Test Driven Development (TDD) works?&lt;/p&gt;
&lt;p&gt;What does ‘Work’ mean in this context? Two measurements often used are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Productivity&lt;/li&gt;
&lt;li&gt;Code Quality&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Does practising TDD mean a real improvement in productivity or code quality? Just measuring productivity or code quality is difficult enough.&lt;/p&gt;
&lt;p&gt;In this post, we will look at some of the discussion going on around TDD in the industry and some of the efforts made to evaluate TDD in a scientific way.&lt;/p&gt;
&lt;h2&gt;Opinions in Industry&lt;/h2&gt;
&lt;p&gt;Before we look at scientific studies and data, it’s worth going over some well known and subjective discussions around TDD for context.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Kent_Beck&quot;&gt;Kent Beck&lt;/a&gt; is &lt;a href=&quot;https://en.wikipedia.org/wiki/Test-driven_development&quot;&gt;credited with having developed or ‘rediscovered’&lt;/a&gt; TDD somewhere around 1999. Since then there have been many proponents of TDD and a &lt;a href=&quot;https://www.amazon.com/s/ref=nb_sb_ss_i_1_14?url=search-alias%3Dstripbooks&amp;#x26;field-keywords=test+driven+development&amp;#x26;sprefix=test+driven+de%2Cstripbooks%2C218&amp;#x26;crid=2ADA7QMBPC5FP&quot;&gt;multitude of books&lt;/a&gt; on the subject. There is certainly a vocal group in the industry that claims TDD is critically important to writing good software.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://david.heinemeierhansson.com/&quot;&gt;David Heinemeier Hansson&lt;/a&gt; (whose name is often abbreviated to DHH) is the creator of &lt;a href=&quot;http://rubyonrails.org/&quot;&gt;Ruby on Rails&lt;/a&gt; expressed what seems to be a fairly widely held opinion against TDD in his blog post &lt;a href=&quot;http://david.heinemeierhansson.com/2014/tdd-is-dead-long-live-testing.html&quot;&gt;TDD is dead. Long live testing&lt;/a&gt;. An interesting aspect of that post is the point of view is taken that TDD has somehow won to become accepted as the right way to do development in the industry and is even causing harm. The post was written a few years ago now but the arguments don’t appear to have changed too much.&lt;/p&gt;
&lt;p&gt;In my personal experience, TDD is not generally accepted as a necessary process in software development and is rarely mandated. There is a lot of debate and while being a practitioner of TDD is not looked down upon, it is not generally seen as being important or necessarily correct. This differs between software teams of course but in general, this is my experience. It is very common at standups I have attended to hear developers say things like, ‘I am done but just need to add tests now’. In conversations like this, I have never heard anyone suggest the TDD process should have been used. It is left to the individual developers to decide that for the most part.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&quot;&gt;Bob Martin&lt;/a&gt; can be a polarizing individual but he is an important proponent of TDD. He attempts to refute DHH’s points in his post &lt;a href=&quot;https://8thlight.com/blog/uncle-bob/2014/04/30/When-tdd-does-not-work.html&quot;&gt;When TDD doesn’t work&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A reference within the original ‘TDD is dead’ post is the article &lt;a href=&quot;http://rbcs-us.com/documents/Why-Most-Unit-Testing-is-Waste.pdf&quot;&gt;Why Most Unit Testing is Waste&lt;/a&gt; by &lt;a href=&quot;https://en.wikipedia.org/wiki/Jim_Coplien&quot;&gt;Jim Coplien &lt;/a&gt; which is discussed in the video where &lt;a href=&quot;https://www.youtube.com/watch?v=KtHQGs3zFAM&quot;&gt;Jim Coplien and Bob Martin Debate TDD&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The TDD is dead subject also led to a long discussion between &lt;a href=&quot;https://www.facebook.com/kentlbeck&quot;&gt;Kent Beck&lt;/a&gt;, &lt;a href=&quot;http://www.martinfowler.com/&quot;&gt;Martin Fowler&lt;/a&gt; and &lt;a href=&quot;http://david.heinemeierhansson.com/&quot;&gt;David Heinemeier Hansson&lt;/a&gt; which is quite entertaining and can be watched here if you are interested:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=z9quxZsLcfo&quot;&gt;TW Hangouts | Is TDD dead? - YouTube&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=JoTB2mcjU7w&quot;&gt;TW Hangouts | Is TDD dead? Part II - YouTube&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=YNw4baDz6WA&quot;&gt;TW Hangouts | Is TDD dead? Part III - YouTube&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=gWD6REVeKW4&quot;&gt;TW Hangouts | Is TDD dead? Part V &amp;#x26; VI - YouTube&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;One interesting detail in those videos was the discussion around a pleasurable workflow and if there is a notable distinction in this area between a mind that prefers to write a test to begin solving a problem or a mind that prefers not to write a test until some form of solution to the problem has already been written.&lt;/p&gt;
&lt;p&gt;All this covers the input of only a few people in the industry and there are many more examples. I am pointing these out here because, despite the rich debate that took place in all these blog posts and discussions, no conclusive answers can be arrived at. It seems rare that one side convinces. That may just be the nature of things but maybe we can explore it a little deeper.&lt;/p&gt;
&lt;p&gt;In nearly all the discussions there was a consensus that automated testing is important. Most disagreements seemed to be around the perception of TDD as a process and perhaps the granularity of automated tests too.&lt;/p&gt;
&lt;p&gt;As with so many subjects in software development, a lot of the information about TDD that we share and consume is based on opinions and anecdotes. We hear about many stories from the perspective of the storyteller and we try to build up a picture of what is right so we can try to apply that to our own situations. We generally just try things to see if they work. Some data would be useful. Is it just that software development is very difficult to measure in this way? When it comes to TDD at least some efforts have been made to gather data.&lt;/p&gt;
&lt;h2&gt;Studies on TDD&lt;/h2&gt;
&lt;p&gt;In 2003 a study called &lt;a href=&quot;http://staff.unak.is/andy/MScTestingMaintenance/Homeworks/STMHeima7TestDrivenDevelopment.pdf&quot;&gt;An Initial Investigation of Test Driven Development in
Industry&lt;/a&gt; was conducted with ’24 professional pair programmers’ where one group developed with TDD and another group used a more conventional (at the time) design-develop-test-debug waterfall approach. That study also references an earlier German Study that was run with 19 graduate students that concluded that&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;test-first manner neither leads to quicker development nor provides
an increase in quality. However, the understandability of the
program increases, measured in terms of proper reuse of existing
interfaces.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There were a lot of limitations to that study which the 2003 study were trying to address.&lt;/p&gt;
&lt;p&gt;According to the George and Williams paper, the TDD group produced code that passed 18% more functional black box test cases but took 16% more time for development.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A hypothesis of this research was that the TDD approach would yield code with superior external code quality. Based on the data analysis conducted, the experimental findings are supportive that the TDD approach yields code with superior external code quality. However, the validity of the results must be considered within the context of the limitations discussed in external validity section.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There were also some interesting findings on the lack of testing done by the control group. Not practising TDD appeared to cause a leaning towards a lack of testing in general.&lt;/p&gt;
&lt;p&gt;This study had many limitations but it was still a good effort to gather some real data on how TDD might work in the industry. In terms of proof that TDD works or not, this study is far from that.&lt;/p&gt;
&lt;p&gt;An interesting paper to look at is &lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.94.9412&amp;#x26;rep=rep1&amp;#x26;type=pdf&quot;&gt;Janzen, D. S., (2006). An Empirical Evaluation of the Impact of
Test-Driven Development on Software Quality&lt;/a&gt; which looks at other studies and does analysis on data gathered by them. This is a long paper and I won’t repeat much of it here but I will highlight some interesting data and points from it. The data is interesting but it is worth keeping in mind the data is from the early 2000’s with relatively small sample sizes.&lt;/p&gt;
&lt;p&gt;Below are tables with summaries of findings from various papers referenced in &lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.94.9412&amp;#x26;rep=rep1&amp;#x26;type=pdf&quot;&gt;Janzen, D. S., (2006)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Type (CE) is a controlled experiment and (CS) is a case study.&lt;/p&gt;
&lt;h4&gt;In Industry&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Study&lt;/th&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;No.of Companies&lt;/th&gt;
&lt;th&gt;No. of Programmers&lt;/th&gt;
&lt;th&gt;Quality Effects&lt;/th&gt;
&lt;th&gt;Productivity Effects&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://pdfs.semanticscholar.org/616d/3f7e831c725b51220a34fbee3ca6ac1d711c.pdf&quot;&gt;George&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CE&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;TDD passed 18% more tests&lt;/td&gt;
&lt;td&gt;TDD took 16% longer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://faculty.salisbury.edu/~xswang/Research/Papers/SERelated/TDD/p564-maximilien.pdf&quot;&gt;Maximilien&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CS&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;50% reduction in defect density&lt;/td&gt;
&lt;td&gt;minimal impact&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://ieeexplore.ieee.org/document/1251029/&quot;&gt;Williams&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CS&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;40% reduction in defect density&lt;/td&gt;
&lt;td&gt;no change&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;In Academia&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Study&lt;/th&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;No. of Programmers&lt;/th&gt;
&lt;th&gt;Quality Effects&lt;/th&gt;
&lt;th&gt;Productivity Effects&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://www.cs.tufts.edu/~nr/cs257/archive/stephen-edwards/automated-feedback.pdf&quot;&gt;Edwards&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CE&lt;/td&gt;
&lt;td&gt;59&lt;/td&gt;
&lt;td&gt;54% fewer defects&lt;/td&gt;
&lt;td&gt;n/a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://dl.acm.org/citation.cfm?id=949421&quot;&gt;Kaufmann&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CE&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;improved information flow&lt;/td&gt;
&lt;td&gt;50% improvement&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://ieeexplore.ieee.org/document/1049202/&quot;&gt;Muller&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CE&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;no change, but better reuse&lt;/td&gt;
&lt;td&gt;no change&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;#x26;arnumber=1248175&quot;&gt;Pancur&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CE&lt;/td&gt;
&lt;td&gt;38&lt;/td&gt;
&lt;td&gt;no change&lt;/td&gt;
&lt;td&gt;no change&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://ieeexplore.ieee.org/document/1423994/&quot;&gt;Erdogmus&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CE&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;no change&lt;/td&gt;
&lt;td&gt;improved productivity&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The data here suggest mostly positive or neutral results from TDD. There is one exception (the previously mentioned George paper) where TDD took 16% longer than the control group but it is noted the control group wrote fewer tests in that study.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The essence of TDD as a design methodology is virtually unstudied, yet scattered early adoption has proceeded based solely on anecdotal evidence.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;While empirical studies will rarely produce absolute repeatable results, such studies can provide evidence of causal relationships, implying results that will most likely occur in given contexts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This to me is a great point. Measurement is difficult and getting fully conclusive results for something like this is almost impossible but we can still use the evidence to help make decisions.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Survey data reveals that developer opinions about the TDD process improve with TDD experience whereas opinions of test-last programming decrease.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Much of the data in that paper relies on surveys. These surveys indicated that the more knowledge and experience a developer had with testing and software development in general, the more likely the developer would be of having a better experience with TDD as a process. Interesting but not a major revelation of course.&lt;/p&gt;
&lt;p&gt;A conclusion the paper arrived at:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This research has demonstrated that TDD can and is likely to improve some software quality aspects at minimal cost over a comparable test-last approach. In particular it has shown statistically significant differences in the areas of code complexity, size, and testing.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This conclusion seems very positive in favour of TDD. A notable issue with these studies is that the sample size is quite small, putting some doubt on the statistical significance of the results. That said, I would argue this work is better than nothing and gives us something to go on at least.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This research revealed a number of differences between TDD acceptance and efficacy in beginning and mature developers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is just an interesting observation to me. Why is there a correlation between experience and an acceptance of TDD?&lt;/p&gt;
&lt;p&gt;A similar work: &lt;a href=&quot;http://proceedings.informingscience.org/InSITE2012/InSITE12p165-187Bulajic0052.pdf&quot;&gt;Overview of the Test Driven Development
Research Projects and Experiments &lt;/a&gt; also looks at varied research papers. This one is slightly newer (2012) and included some more recent research. A significant addition is a study with IBM and Microsoft development teams.&lt;/p&gt;
&lt;p&gt;Final conclusion in this study was (Nagappan et al., 2008):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reducing of defect density (IBM 40%, Microsoft 60% - 90%)&lt;/li&gt;
&lt;li&gt;Increase of time taken to code feature (15% - 35%).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Threats to the validity of the study were identified as (Nagappan et al., 2008):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Higher motivation of developers that were using TDD methodology.&lt;/li&gt;
&lt;li&gt;The project developed by using TDD might be easier.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The findings of that paper were less positive than Janzen’s as they rightly noted the results were too varied and the sample sizes too small to draw any positive conclusions.&lt;/p&gt;
&lt;p&gt;Another &lt;a href=&quot;http://www.ipr.mdh.se/pdf_publications/2345.pdf&quot;&gt;controlled experiment conducted in 2012&lt;/a&gt; once again concluded that TDD is probably a good thing but that more evidence is needed.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://people.brunel.ac.uk/~csstmms/FucciEtAl_ESEM2016.pdf&quot;&gt;Another study from 2016&lt;/a&gt; looked at the effects of TDD compared to Test Last Development (TLD).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In this paper we reported a replication of an experiment
[13] in which TDD was compared to a test-last approach.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This study seemed to lean towards a verdict that TDD doesn’t improve things over TLD:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Given the limitations presented in Section 5, it appears that
TDD does not improve, nor deteriorate the participants’
performance with respect to an iterative development technique
in which unit tests are written after production code&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you look at how the tests were conducted though you can see an interesting aspect of it is how programmers were to use iterative development. There was a fairly tight loop between test and production code for both TDD and TLD. Perhaps a tight iterative loop is more important than the order of test code?&lt;/p&gt;
&lt;p&gt;In my opinion, this paper didn’t provide enough data to give a conclusion one way or the other. It certainly didn’t prove TDD was better or worse than writing all your tests after writing all your production code for a decent sized project.&lt;/p&gt;
&lt;p&gt;The final study we will glance at is one I just recently came across called &lt;a href=&quot;https://arxiv.org/pdf/1611.05994.pdf&quot;&gt;A dissection of the test-driven development process: does it really matter to test-first or to test-last?&lt;/a&gt; which is also by Fucci et al. This study actually appears to reach a similar conclusion to the previous study except that in this case, the programmers involved work in industry. Also, the comparisons were with iterative test last (ITL) development (which I think is a better term than TLD for this) and TDD.&lt;/p&gt;
&lt;p&gt;Another interesting conclusion in that study is that shorter cycle times (time between production code and test), to a point, do appear to lead to better quality.&lt;/p&gt;
&lt;h2&gt;Some Conclusions&lt;/h2&gt;
&lt;p&gt;Looking at the data it is fairly easy to say the answer to the questions ‘Does TDD Work?’ is inconclusive.&lt;/p&gt;
&lt;p&gt;If the question becomes more specific at least there are some answers.&lt;/p&gt;
&lt;p&gt;The evidence appears to be heavily stacked in favour of short iterative test cycles, very similar to that prescribed in TDD literature, being significantly better for code quality with minimal impact on productivity. A process of small iterations with small testable blocks of code does appear to lead to more maintainable code.&lt;/p&gt;
&lt;p&gt;Current evidence suggests that unit testing beats integration and higher level testing.&lt;/p&gt;
&lt;p&gt;There is currently very little evidence that practising TDD is bad.&lt;/p&gt;
&lt;p&gt;Whether writing a test first or last is better within a tight iterative cycle is inconclusive.&lt;/p&gt;
&lt;p&gt;Testing is a discipline that takes time to be learned before seeing the real benefits of it. That is my own observation but is supported by observations in some of the studies we looked at.&lt;/p&gt;
&lt;p&gt;Will we ever know for sure if TDD really works or not? I don’t know. On a positive note, It does seem that questions like this are being asked more often these days. More rigorous study is being done. Take the book &lt;a href=&quot;https://itrevolution.com/book/accelerate/&quot;&gt;Accelerate&lt;/a&gt; by &lt;a href=&quot;http://nicolefv.com/&quot;&gt;Nicole Forsgren&lt;/a&gt;, &lt;a href=&quot;https://twitter.com/jezhumble&quot;&gt;Jez Humble&lt;/a&gt; and &lt;a href=&quot;https://itrevolution.com/faculty/gene-kim/&quot;&gt;Gene Kim&lt;/a&gt; for example. It’s not about TDD specifically but it’s an amazing example of the work being done to try and figure out what techniques really work in software development so at least we should have more accurate information to help us make decisions about subjects like this.&lt;/p&gt;
&lt;h2&gt;Personal Thoughts On All This&lt;/h2&gt;
&lt;p&gt;I spend a lot of time urging other developers to do TDD or at least to try it out. Usually, people will give it a go but have difficulty sticking with it. I try to explain that it is something you learn over time and when you get good at it, it’s great!&lt;/p&gt;
&lt;p&gt;It occurred to me fairly often that I might be wrong. What if I am trying to get people to invest time in something that isn’t that great. What proof is there that TDD even works? Just because it seems to work for me, it does not automatically follow it will work for everybody.&lt;/p&gt;
&lt;p&gt;That was the reason for this post. I wanted to look for proof that TDD actually works. I also wanted to read as much as I could from people who are against TDD or some aspect of it. Just because I think TDD is good I tended to avoid them and that’s not a good way to learn.&lt;/p&gt;
&lt;p&gt;I personally do think varied approaches to TDD are OK. The definition of TDD shouldn’t be like some ancient text to be taken absolutely literally and never altered.&lt;/p&gt;
&lt;p&gt;To me, one of the biggest advantages (maybe the most under-appreciated advantage) of TDD is the design that it encourages. A complaint I always hear is that too many unit tests lead to code that’s difficult to maintain and change. That’s just a common pitfall in the learning process. Once you add TDD to your arsenal of software development techniques and learn it well, it should really help in achieving good software design. If good, clean, well-designed software is your goal, I believe TDD is something that will help really help you to achieve that.&lt;/p&gt;
&lt;p&gt;It does sometimes feel like TDD is just a little too hard though. It reminds me of trying to do functional programming in Java. If everything is designed from the beginning to facilitate TDD, it’s fairly easy. That is so rare still, and trying to do TDD all the time is really difficult in the systems we have to work with. Thanks to the tools and educational material out there today, things seem to be getting better though.&lt;/p&gt;
&lt;p&gt;Despite the downsides, after everything I have read and experienced, I still consider TDD an excellent tool to have. I will keep using it and encouraging others to do the same.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://staff.unak.is/andy/MScTestingMaintenance/Homeworks/STMHeima7TestDrivenDevelopment.pdf&quot;&gt;George, B., Williams, L., (2003). An Initial Investigation of Test Driven Development in Industry&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://digitalcommons.calpoly.edu/cgi/viewcontent.cgi?article=1034&amp;#x26;context=csse_fac&quot;&gt;Janzen, D., Saiedian, S., (2005). Test-Driven Development: Concepts, Taxonomy, and Future Direction&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.94.9412&amp;#x26;rep=rep1&amp;#x26;type=pdf&quot;&gt;Janzen, D. S., (2006). An Empirical Evaluation of the Impact of Test-Driven Development on Software Quality.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pdfs.semanticscholar.org/a00c/61b77e2df21b43d5e500341d5efec286c195.pdf&quot;&gt;Sanchez, J. C., Williams, L., Maximilien, M, (2007). On the Sustained Use of a Test-Driven Development Practice at IBM&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://proceedings.informingscience.org/InSITE2012/InSITE12p165-187Bulajic0052.pdf&quot;&gt;Bulajic, A., Sambasivam, S., Stojic, R., (2012). Overview of the Test Driven Development Research Projects and Experiments.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.ipr.mdh.se/pdf_publications/2345.pdf&quot;&gt;Causevic, A., Sundmark, D., Punnekkat, S, (2012). Impact of Test Design Technique Knowledge on Test Driven Development: A Controlled Experiment&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tuhat.halvi.helsinki.fi/portal/files/29553974/2014_01_swqd_author_version.pdf&quot;&gt;Mäkinen, S., Münch, J., (2014). Effects of Test-Driven Development: A Comparative Analysis of Empirical Studies&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://people.brunel.ac.uk/~csstmms/FucciEtAl_ESEM2016.pdf&quot;&gt;Fucci, D., Scanniello, G., Romano, S., Shepperd, M., Sigweni, B., Uyaguari, F., Turhan, B., Juristo, N., Oivo, M., (2016). An External Replication on the Effects of Test-driven Development Using a Multi-site Blind Analysis Approach&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.martinfowler.com/articles/testing-culture.html&quot;&gt;Goto Fail, Heartbleed, and Unit Testing Culture&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Test-driven_development&quot;&gt;Test-driven development - Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://arxiv.org/pdf/1611.05994.pdf&quot;&gt;A dissection of the test-driven development process: does it really matter to test-first or to test-last? Fucci et al., ICSE (2017)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.acolyer.org/2017/06/13/a-dissection-of-the-test-driven-development-process-does-it-really-matter-to-test-first-or-test-last/&quot;&gt;A dissection of the test-driven development process: does it really matter to test-first or test-last? | the morning paper&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=1bZv3pSaLtY&quot;&gt;Bertrand Russell - Face to Face Interview (BBC, 1959) - YouTube&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=z5JQjcSfUO0&quot;&gt;Bertrand Russell - In Our Time BBC Radio 4 - YouTube&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=9EF4I7HM0zI&quot;&gt;Bertrand Russell (Part 1 of 6) Authority and the Individual: Social Cohesion and Human Nature - YouTube&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Simple development environment setup with docker compose]]></title><description><![CDATA[All the code for this article is in this example project on Github. If you just want some quick sample code for a development environment…]]></description><link>https://ruarfff.com/docker-for-dev/</link><guid isPermaLink="false">https://ruarfff.com/docker-for-dev/</guid><pubDate>Wed, 11 Apr 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;All the code for this article is in &lt;a href=&quot;https://github.com/ruarfff/docker-dev-setup-example&quot;&gt;this example project on Github&lt;/a&gt;. If you just want some quick sample code for a development environment with docker-compose, that repository and its Readme should be helpful. This post will expand on that and go in to more detail to explain what’s going on in the example project.&lt;/p&gt;
&lt;h2&gt;The purpose of this post&lt;/h2&gt;
&lt;p&gt;I am assuming that you know what &lt;a href=&quot;https://www.docker.com/&quot;&gt;docker&lt;/a&gt; and &lt;a href=&quot;https://docs.docker.com/compose/&quot;&gt;docker compose&lt;/a&gt; are and won’t spend time in this post explaining them. This post will take what I learned from experience and reading the docs for those tools and present what I hope is a reasonably simple approach to using them to augment your development environment in a good way.&lt;/p&gt;
&lt;h2&gt;Setup&lt;/h2&gt;
&lt;p&gt;All you need to do to run the sample code is to &lt;a href=&quot;https://docs.docker.com/install/&quot;&gt;install docker&lt;/a&gt; and &lt;a href=&quot;https://docs.docker.com/compose/install/&quot;&gt;install docker compose&lt;/a&gt;. Docker compose generally installs along with docker.&lt;/p&gt;
&lt;p&gt;You will also need to get the sample code &lt;a href=&quot;https://github.com/ruarfff/docker-dev-setup-example&quot;&gt;from Github&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you have &lt;a href=&quot;https://git-scm.com/&quot;&gt;git&lt;/a&gt; installed you can run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:ruarfff/docker-dev-setup-example.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If not, you can use the ‘Download Zip` option on the project web page.&lt;/p&gt;
&lt;p&gt;Finally, a good editor to view and edit the code would be useful. For what it’s worth, I use &lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;Visual Studio Code&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The Scenario&lt;/h2&gt;
&lt;p&gt;Feel free to skip this section but I wanted to take a moment to mention some of the pain points this solution helps to address.&lt;/p&gt;
&lt;p&gt;You have an application and it connects to an external service such as a database. You probably have the tools to run the application installed locally but maybe it’s a bit annoying, like if for some reason the production environment is stuck on an old version of the database and you’re using some infrastructure where you have to go through a painful ticketing process to update (your next ticket should be to install docker!).&lt;/p&gt;
&lt;p&gt;Say the app uses a postgres database. You don’t really want to be connecting to a remote one or having it running locally all the time.&lt;/p&gt;
&lt;p&gt;Maybe you work on multiple applications that require different runtimes. For example one app need java 6 (shudder) and another needs Java 8 or maybe different version of node.&lt;/p&gt;
&lt;p&gt;Not sure if these are issues you have dealt with but I think it’s safe to assume you have run into something similar.&lt;/p&gt;
&lt;p&gt;Having your development environment in containers solves al lot of this pretty well. You really only need docker, docker compose and an editor to work on and run your application locally.&lt;/p&gt;
&lt;p&gt;Having your development environment use the same containers as production (assuming you deploy with containers) is even better again!&lt;/p&gt;
&lt;p&gt;The scenario we are working with here is needing to run a node app, a java app and a postgres database together. It’s not something you would typically need perhaps but serves as an example.&lt;/p&gt;
&lt;h2&gt;The Sample Application&lt;/h2&gt;
&lt;p&gt;The example project we will look at consists of 2 applications. They are not really related and don’t do much but are just examples in 2 different languages I commonly use. It may make sense for me to break them out into 2 repositories at some stage but until then, it’s just useful to have all the code in one place for demonstration purposes. Both applications connect to a postgres database, the same database in this setup which you wouldn’t normally do if these were microservices for example but that doesn’t do any harm here.&lt;/p&gt;
&lt;p&gt;One application is written in JavaScript using &lt;a href=&quot;https://nodejs.org/&quot;&gt;https://nodejs.org/&lt;/a&gt;. The code for the node app was generated using &lt;a href=&quot;https://expressjs.com/en/starter/generator.html&quot;&gt;the express generator&lt;/a&gt;. We will explore how we can have it run and build entirely in a docker container even though you can edit it in your editor on any host OS (by Host OS I mean the machine and operating system you are using for development currently). We will also look at having the application automatically restart on any file change and how we can setup debugging the app while it is running in the docker container. For auto restarting we are using &lt;a href=&quot;http://pm2.keymetrics.io/&quot;&gt;pm2&lt;/a&gt; but &lt;a href=&quot;https://nodemon.io/&quot;&gt;nodemon&lt;/a&gt; is another great option you could use instead.&lt;/p&gt;
&lt;p&gt;The second application is a Java application based on Spring Boot and was generated using the &lt;a href=&quot;https://start.spring.io/&quot;&gt;start.spring.io&lt;/a&gt; site. We will also look at running this application entirely in a docker container, having it automatically restart on code changes and enabling debugging for application while it’s running in a container.&lt;/p&gt;
&lt;h2&gt;The Compose Configuration&lt;/h2&gt;
&lt;p&gt;Here is our docker-compose.yml file in its entirety:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3.7&apos;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;alpine
    &lt;span class=&quot;token key atrule&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always
    &lt;span class=&quot;token key atrule&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; db
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;POSTGRES_USER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
      &lt;span class=&quot;token key atrule&quot;&gt;POSTGRES_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; password
      &lt;span class=&quot;token key atrule&quot;&gt;POSTGRES_DB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./.postgres/init&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;entrypoint&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;initdb.d
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;5432:5432&apos;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop
  &lt;span class=&quot;token key atrule&quot;&gt;pgadmin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pgadmin_container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dpage/pgadmin4
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;9000:80&apos;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;PGADMIN_DEFAULT_EMAIL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pgadmin4@pgadmin.org
      &lt;span class=&quot;token key atrule&quot;&gt;PGADMIN_DEFAULT_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; admin
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./.postgres/admin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/var/lib/pgadmin
    &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop
    &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; db
  &lt;span class=&quot;token key atrule&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; node/
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3000:3000&apos;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./node/src&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/usr/app/src
    &lt;span class=&quot;token key atrule&quot;&gt;working_dir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /usr/app
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;PGUSER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
      &lt;span class=&quot;token key atrule&quot;&gt;PGPASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; password
      &lt;span class=&quot;token key atrule&quot;&gt;PGDATABASE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
      &lt;span class=&quot;token key atrule&quot;&gt;PGHOST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; db
    &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pm2-runtime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;start&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ecosystem.config.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; db
  &lt;span class=&quot;token key atrule&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gradle&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;jdk&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;alpine
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;8080:8080&apos;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./java&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/home/gradle/project
    &lt;span class=&quot;token key atrule&quot;&gt;working_dir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/gradle/project
    &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gradle&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;build&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bootRun&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; develop&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The version (&lt;code class=&quot;language-text&quot;&gt;3.7&apos;&lt;/code&gt; in this case) is important. The capabilities from version to version of docker compose are significant. The reference manual for our version is &lt;a href=&quot;https://docs.docker.com/compose/compose-file/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;services&lt;/code&gt; field is a list of services we want docker compose to manage. The services are the various components we want to run together while developing. Our example here may be a bit contrived but imaging a more useful scenario where you would like to see how your app behaves connected to various services it uses in production like a database and maybe a cache, like &lt;a href=&quot;https://hub.docker.com/_/memcached&quot;&gt;memcached&lt;/a&gt;, or messaging service, like &lt;a href=&quot;https://hub.docker.com/_/rabbitmq&quot;&gt;rabbitmq&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;networks&lt;/code&gt; field is where we define the networks we want the services ot communicate over. We’re keeping it simple and just using one here but you can do more with networks if you need to.&lt;/p&gt;
&lt;h3&gt;The database configuration&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;alpine
  &lt;span class=&quot;token key atrule&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always
  &lt;span class=&quot;token key atrule&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; db
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./.postgres/init&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;entrypoint&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;initdb.d
  &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;POSTGRES_USER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
    &lt;span class=&quot;token key atrule&quot;&gt;POSTGRES_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; password
    &lt;span class=&quot;token key atrule&quot;&gt;POSTGRES_DB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;5432:5432&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first field, the name ‘db’ above could be any name. Like any name in software, it’s good to use something as clear and obvious as possible. You will use that to reference this service in other services.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;image&lt;/code&gt; is the &lt;a href=&quot;https://hub.docker.com/_/postgres&quot;&gt;postgres docker image&lt;/a&gt;. You can also define a version there e.g. &lt;code class=&quot;language-text&quot;&gt;postgres:11-alpine&lt;/code&gt; if you want a specific version. Otherwise it just uses the latest.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;restart: always&lt;/code&gt; tells compose to restart this image if it crashes.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;hostname: db&lt;/code&gt; you don’t actually need this here but if you wanted to change the hostname seen by other services you can use this field. My default other services will use the service name as the hostname. By hostname I mean, other containers can see the container by using that name as long as they are on the same network. The name will resolve to the IP address of the container.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;volumes&lt;/code&gt; we use volumes to mount a directory on our host system, into the running container. In this case we are mounting an sql script in to a particular place in the container so that the very first time the container is created, the script is run against the database and we can set up a scheme, populate with dummy data etc. Some other things we can do with this are, load a database configuration file and use a database file on our local file system for the database storage. By default, every time we tear down the database container we will lose all the data that was loaded into the database while we were working.&lt;/p&gt;
&lt;p&gt;If you want to keep the state of the database you can create a directory somewhere, e.g. from the root of the sample app run&lt;code class=&quot;language-text&quot;&gt;mkdir .postgres/data&lt;/code&gt;and add a new volume to the volumes field of the configuration:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;- ./.postgres/data:/var/lib/postgresql/data&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now the database’s data will be stored in that directory and can be deleted on the host.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;environment&lt;/code&gt; here we can specify environment variables to inject in to the running container. The variables we use are documented &lt;a href=&quot;https://hub.docker.com/_/postgres&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ports&lt;/code&gt; by default postgres serves on port 5432. Here we are exposing that on the host.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;networks&lt;/code&gt; we want all the services to be able to communicate on the same network. Docker allows us to define a network for our services to share. We are creating a network called ‘develop’ and this tells the postgres service to join it.&lt;/p&gt;
&lt;h3&gt;The node application configuration&lt;/h3&gt;
&lt;p&gt;First let’s look at the Dockerfile:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; keymetrics/pm2:latest-alpine&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /usr/app&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; bin/ ./bin/&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; package.json .&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; yarn.lock .&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; ecosystem.config.js .&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; NPM_CONFIG_LOGLEVEL warn&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yarn install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;FROM keymetrics/pm2:latest-alpine&lt;/code&gt; this is an image provided by the &lt;a href=&quot;http://pm2.keymetrics.io/&quot;&gt;pm2&lt;/a&gt; people which is handy for auto restarting our app on code changes but we have many options. We could use the &lt;a href=&quot;https://hub.docker.com/_/node/&quot;&gt;NodeJS image&lt;/a&gt; and start a little differently &lt;code class=&quot;language-text&quot;&gt;command: [&quot;npm&quot;, &quot;start&quot;]&lt;/code&gt; for example. We could also use a custom Dockerfile for our app. If you had a python app or whatever, you could just use the appropriate image for that here instead.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;WORKDIR /usr/app&lt;/code&gt; I am not sure is using /usr/app is a convention or just something I copied and kept using but I tend to use it as the place to put my app code in most docker containers. Any commands run after specifying that in the Dockerfile will be run in the context of that directory.&lt;/p&gt;
&lt;p&gt;After that point, with all the &lt;code class=&quot;language-text&quot;&gt;COPY&lt;/code&gt; calls, we’re doing a few slightly odd things here and I’ll explain why. We want the application to install all it’s dependencies in the Docker container. With the way node dependencies work, it can cause problems to install on the host and not in the container.&lt;/p&gt;
&lt;p&gt;Take an example where you are developing on Windows. If you install the dependencies on Windows first and then mount the code in a container, you will hit issues. Node will install and even compile dependencies for the OS you are on. Trying to run your Windows dependencies in Linux will cause issues.&lt;/p&gt;
&lt;p&gt;To get around this, we keep all our source code in a sub directory called &lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt;. We want to only mount the src directory during development. When we actually build our image, we want to copy in the build files and install dependencies. That way, even if you have run &lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt;, the node_modules directory won’t get copied over to the container. If you run docker compose with &lt;code class=&quot;language-text&quot;&gt;docker-compose up --build&lt;/code&gt;, it will pick up any changes you made to your dependencies and rebuild the image so you don’t get out of sync.&lt;/p&gt;
&lt;p&gt;It’s a little bit awkward and there may well be a better way to manage this but this is what I have come up with so far and I am sharing it with you.&lt;/p&gt;
&lt;p&gt;Now to look at the compose configuration for the node application:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; node/
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3000:3000&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./node/src&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/usr/app/src
  &lt;span class=&quot;token key atrule&quot;&gt;working_dir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /usr/app
  &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;PGUSER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
    &lt;span class=&quot;token key atrule&quot;&gt;PGPASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; password
    &lt;span class=&quot;token key atrule&quot;&gt;PGDATABASE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev
    &lt;span class=&quot;token key atrule&quot;&gt;PGHOST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; db
  &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop
  &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pm2-runtime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ecosystem.config.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; db&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;node&lt;/code&gt; is our service name. Could be anything but good to use a name that makes sense.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ports&lt;/code&gt; by default the port express serves on is 3000. With this we are exposing this on the host too.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;volumes&lt;/code&gt; mounting the source code for the application into the container so any edits we make in our editor will be reflected in the running container.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;environment&lt;/code&gt; setting up environment variables. In this case, just providing database connection information.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;networks&lt;/code&gt; puts the node app on the development network.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;command&lt;/code&gt; is the command to run when the container starts.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;depends_on&lt;/code&gt; tells the web service to wait until the db services container has at least started before starting itself. This does not guarantee the service itself e.g. the postgres database has actually started beforehand though. Only that the container is in a running state.&lt;/p&gt;
&lt;p&gt;Beyond all that setup, all the application does is test out its connection to postgres.&lt;/p&gt;
&lt;h2&gt;The java application configuration&lt;/h2&gt;
&lt;p&gt;The java app does not have its own Dockerfile although you could add one if you wish. It’s just not needed at this point.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gradle&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;jdk&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;alpine
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;8080:8080&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./java&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/home/gradle/project
  &lt;span class=&quot;token key atrule&quot;&gt;working_dir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/gradle/project
  &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; develop
  &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;gradle&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;build&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bootRun&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you have read over the last 2 configurations you probably won’t need much explanation but I will go over the properties briefly.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;java&lt;/code&gt; the name of the service.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;image&lt;/code&gt; we are using the &lt;a href=&quot;https://hub.docker.com/_/gradle&quot;&gt;official gradle image&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ports&lt;/code&gt; by default spring boot serves on port 8080. We are exposing that here.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;volumes&lt;/code&gt; we are mounting the source code into the container at the location &lt;code class=&quot;language-text&quot;&gt;/home/gradle/project&lt;/code&gt;. This is the expected location documented on the dockerhub page for this container.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;working_dir&lt;/code&gt; setting the working directory to where the code is.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;networks&lt;/code&gt; the develop network we configure for the services to talk to each other.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;command&lt;/code&gt; we call gradle and the tasks we want to be run on startup.&lt;/p&gt;
&lt;h2&gt;Running the applications&lt;/h2&gt;
&lt;p&gt;Once you have everything set up, starting the application is simply running &lt;code class=&quot;language-text&quot;&gt;docker-compose up --build&lt;/code&gt; in the directory that contains the compose file.&lt;/p&gt;
&lt;p&gt;If you want to teardown and delete the containers that were created, first hit ctrl+c to shutdown the current docker compose session. Then run &lt;code class=&quot;language-text&quot;&gt;docker-compose down&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Automatically restarting the applications on code change&lt;/h2&gt;
&lt;p&gt;Having a quick feedback loop is very important while developing. I thought it important to highlight the fact that you can still use the techniques you might be used to during normal development, while using docker.&lt;/p&gt;
&lt;h3&gt;node&lt;/h3&gt;
&lt;p&gt;If you develop with node, you probably have used &lt;a href=&quot;https://nodemon.io/&quot;&gt;nodemon&lt;/a&gt; or something similar to automatically restart your application after a file has changed. You can do the very same with docker even when working with volumes. In our example we are using &lt;a href=&quot;https://pm2.io/doc/en/runtime/overview/&quot;&gt;pm2&lt;/a&gt; which is a nice process manager for node and provides features for watching source files and reloading on change. Try out changing a file in the node project and see the app reload.&lt;/p&gt;
&lt;h3&gt;java&lt;/h3&gt;
&lt;p&gt;For the java application we are using &lt;a href=&quot;https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html&quot;&gt;Spring Devtools&lt;/a&gt;. They are pretty well documented but basically we are going for a similar effect to what nodemon does for node. Try out changing any source file in the java application and watch it automatically restart.&lt;/p&gt;
&lt;h2&gt;Debugging&lt;/h2&gt;
&lt;p&gt;I was going to put a tutorial based on tools I use here but it would honestly be a bit redundant. There are far more comprehensive tutorials out there. I will link them here:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Node&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.docker.com/2016/07/live-debugging-docker/&quot;&gt;VSCode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@creynders/debugging-node-apps-in-docker-containers-through-webstorm-ae3f8efe554d&quot;&gt;WebStorm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Java&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tutorials for &lt;a href=&quot;https://blog.docker.com/2016/09/java-development-using-docker/&quot;&gt;Eclipse, IntelliJ and Netbeans&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;If you are not already familiar with docker, there’s a bit to take in here. Once you pick of the concepts though, and work through a few of those slightly weird to get the head around bits, it’s amazingly useful. Maybe some new thing will come along and make it all redundant but in the meantime, I believe it’s worth the effort for most people working on any kind of coding or infrastructure tasks.&lt;/p&gt;
&lt;p&gt;I find myself jumping around to different computers, different OSes, occasionally trying out new Linux distros and having to setup environments is a real pain. Even if you automate some of it there’s always something to take up a bunch of time.&lt;/p&gt;
&lt;p&gt;With docker, I find for the most part I can get away with only 3 things on any system to get productive quickly. Docker, Git and an editor. I hope you find similar advantages to this stuff. Good luck!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Deploying an app to Elastic Beanstalk with Codeship]]></title><description><![CDATA[Codeship provides some docs on how to set up a deployment to AWS (Amazon Web Services) EB (Elastic Beanstalk) here. I didn’t find them great…]]></description><link>https://ruarfff.com/elastic-beanstalk-codeship/</link><guid isPermaLink="false">https://ruarfff.com/elastic-beanstalk-codeship/</guid><pubDate>Mon, 26 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Codeship provides some docs on how to set up a deployment to AWS (Amazon Web Services) EB (Elastic Beanstalk) &lt;a href=&quot;https://documentation.codeship.com/basic/continuous-deployment/deployment-to-elastic-beanstalk/&quot;&gt;here&lt;/a&gt;. I didn’t find them great since they assumed a lot of knowledge I didn’t have. I know I’ll have to do this again so here I am writing down all the steps I had to follow to get this to work.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Disclaimer: I can’t claim any of this is best practice. Just what I figured out as I went along. I don’t run critical large scale applications on AWS. Just simple apps and side projects.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;For this first step I will be deploying a simple nodejs application using the pre-configured Node.js platform on EB. The instructions should be basically the same for any other platform on EB though.&lt;/p&gt;
&lt;h2&gt;Assumptions&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;You’re using Codeship or some other similar CI (Continuous Integration) system (that system should allow you to configure an EB deployment as we won’t be looking in to how to deploy with the aws tools directly).&lt;/li&gt;
&lt;li&gt;You have an &lt;a href=&quot;http://aws.amazon.com&quot;&gt;AWS&lt;/a&gt; account and are aware of pricing etc. If you’re in your free trial this should all be free but might cost you a little otherwise.&lt;/li&gt;
&lt;li&gt;You have the ability to add a user with &lt;a href=&quot;https://aws.amazon.com/iam/&quot;&gt;IAM&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;You can create an EB application.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Checklist&lt;/h2&gt;
&lt;p&gt;Here’s the steps we will have gone through by the end of this post.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Create an Elastic Beanstalk application &amp;#x26; environment&lt;/li&gt;
&lt;li&gt;Configure IAM with a deployment user and user group&lt;/li&gt;
&lt;li&gt;Configure a deployment pipeline&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I am going to use the AWS UI for all this.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Account ID and region&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When working with AWS there are 2 values you will have that will likely be different to what I have here. Your account ID and your region. For the rest of this post, rather than calling out these in each place I am just going to use these values:&lt;/p&gt;
&lt;p&gt;AccountID: &lt;code class=&quot;language-text&quot;&gt;123456789123&lt;/code&gt;
Region: &lt;code class=&quot;language-text&quot;&gt;eu-west-1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;In all the examples I have, just replace these values with your own.&lt;/p&gt;
&lt;p&gt;You can find your account ID by selecting the dropdown with your name on the top right and viewing you account which should be at this URL: &lt;a href=&quot;https://console.aws.amazon.com/billing/home?#/account&quot;&gt;https://console.aws.amazon.com/billing/home?#/account&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1. Create an Elastic Beanstalk application &amp;#x26; environment&lt;/h2&gt;
&lt;p&gt;Go to your console and select Elastic Beanstalk in the services section. If your currently selected region is eu-west-1 and this is your first time creating an EB app, you will end up at a URL like this &lt;a href=&quot;https://eu-west-1.console.aws.amazon.com/elasticbeanstalk/home?region=eu-west-1#/getting_started&quot;&gt;https://eu-west-1.console.aws.amazon.com/elasticbeanstalk/home?region=eu-west-1#/getting_started&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Don’t use the default stuff in there. Instead use the &lt;code class=&quot;language-text&quot;&gt;Create New Application&lt;/code&gt; link on the top right.&lt;/p&gt;
&lt;p&gt;If it’s not your first time creating one, click the create new app link anyway to follow along.&lt;/p&gt;
&lt;p&gt;You will see a dialog prompting you to enter application details. Enter whatever you want there.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8ca002ecee2285e012a2eafadc60c876/b5bda/01-my-test-app.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuUlEQVQoz4XQy47TMBQG4D5NmZo0l0nS8jCseYwRGzZICHUPGoTEpWHV9hVYVumkadTCBmVVUCd4kvjuOEZpZlokFPHp6Cws/fY57lmW5Xne+MFoNBqPx77ve91833dd1zTN3nBoLhaL7XYbhuHNgyRJvnfY7XZpms7nc8uyeoZhbDYbrTWllHOOMSaYVFWlOyiltNZRFDUvm6YZRRHnPMsyCGFRlHeYZzmCJcG8OpVSdUtKqbVerVbt2MP1ei2EgBDmeV6U6HBXHn7nt7BEVJSEN50Kxrk4YoydXx4MBnEcn+ap65pSyhqUMdpsQQilBCGEMCKYcELP4dPOWZbt93sIIUIoz3MIIeeiVqqqKimlrKpaqZKTNP91DgMA2jA/EkKUZYkQKoqCHFFKpZRCyrpSGSmiww+t9c392ADE8ebvsdsMxphS2vbO3zYMIwxDrTUh5LgqE/+4P+eccYYJ0Vovl8smbNt2kiSnK7swWd8i+TMXz959e3qdvpl9feLZPcdxJpPJbDYLguBLt2kQfPw8/fBpevXq7dXr989fvLx07J7rugCAfr//6H8uLppyTHBpgqHx2HXdPy5jPpLHt9y6AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;my-test-app&quot;
        title=&quot;my-test-app&quot;
        src=&quot;/static/8ca002ecee2285e012a2eafadc60c876/f058b/01-my-test-app.png&quot;
        srcset=&quot;/static/8ca002ecee2285e012a2eafadc60c876/c26ae/01-my-test-app.png 158w,
/static/8ca002ecee2285e012a2eafadc60c876/6bdcf/01-my-test-app.png 315w,
/static/8ca002ecee2285e012a2eafadc60c876/f058b/01-my-test-app.png 630w,
/static/8ca002ecee2285e012a2eafadc60c876/b5bda/01-my-test-app.png 643w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You will end up at the screen listing any application you have created.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5d20e084baa0cba1102c4f0372d094ee/497e1/02-appllications-view-create-one.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVQY05XQ2w6DIAyAYd7/MRenY9JWBamUQxdnlmzZFd9Fr/iTFjNNk7UW8AQAwzCM44iI9Gee5/MlgHPuNj7vD2cwCIaciqpqrZWIYoztrf5ouZxaa8dxcIyqahbPgaXUegU5ZxFJKTGz/7L53e+cPkSkNTW4RYshHkn7GVqDdbQsq9+2UkpfDOAIgTkys2rri5EIEEXOs7vXvr7nmrWzfwED4NRrzA3JagAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;appllications-view-create-one&quot;
        title=&quot;appllications-view-create-one&quot;
        src=&quot;/static/5d20e084baa0cba1102c4f0372d094ee/f058b/02-appllications-view-create-one.png&quot;
        srcset=&quot;/static/5d20e084baa0cba1102c4f0372d094ee/c26ae/02-appllications-view-create-one.png 158w,
/static/5d20e084baa0cba1102c4f0372d094ee/6bdcf/02-appllications-view-create-one.png 315w,
/static/5d20e084baa0cba1102c4f0372d094ee/f058b/02-appllications-view-create-one.png 630w,
/static/5d20e084baa0cba1102c4f0372d094ee/40601/02-appllications-view-create-one.png 945w,
/static/5d20e084baa0cba1102c4f0372d094ee/78612/02-appllications-view-create-one.png 1260w,
/static/5d20e084baa0cba1102c4f0372d094ee/497e1/02-appllications-view-create-one.png 1891w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Select the option to create a new environment for your application, either in the Actions dropdown or by clicking the &lt;code class=&quot;language-text&quot;&gt;Create one now&lt;/code&gt; link.&lt;/p&gt;
&lt;p&gt;Choose the Web Server option.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/73411bab1711decc5a75e86a90a79dba/1e043/03-choose-env.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVQoz43RTY/SQBgHcD6LLNAKwdKSrDE0oJHEGwer4bSfZI96kLtHjxhrtcF48mCyuEcOe/fAqfPSaZvtlL7SgTEtlrjRVX+HmSeT/DPPM1Prdrvj8Xg6nT4rPa9omvb0TzRNm0wmvV5PkqTayUl9Pp9TSi3Lsm0bAAAhBABQSpMkiW+KoijP8/V6PRwOi3C9fsc0Tc55mqaMsW1lv9/z3xwOMcaj0agINxoNXdfjOAYAEEIwxhDCJEkYY2mabn+R53m2ZXvOIUI/w61WyzAMzrnneUEQUEo9zwvDcLPZUEqDUhiG5b65DrNoyy0AVVXtdDq1ZrNpmiZjzHEc3/dd102ShN/i2PZgMCjCgiDouh6GkWUBhJBlWRhj13Wdkm3bh5UQ4nkeIeTGzKIo6rq+CSiE0C4dCgghrsBSUSCUZRk6znxXFN/p723Pxxg7joMQIoQcb3Nd99BI+ZYIkmsa5xhXYVEQPnwsvmq32/F/qWauwoIgLBYLzjlj7C8xP8qz7e7TlXu+AMbl9yfjR917Uq3dbs9ms9VqtVwuL2/35evFxfLbqzefz14aL16/fThUJalXUxRF/g99RVZkeXC//1g9fXDal2VZUZQf6gYw4M77cvgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;choose-env&quot;
        title=&quot;choose-env&quot;
        src=&quot;/static/73411bab1711decc5a75e86a90a79dba/f058b/03-choose-env.png&quot;
        srcset=&quot;/static/73411bab1711decc5a75e86a90a79dba/c26ae/03-choose-env.png 158w,
/static/73411bab1711decc5a75e86a90a79dba/6bdcf/03-choose-env.png 315w,
/static/73411bab1711decc5a75e86a90a79dba/f058b/03-choose-env.png 630w,
/static/73411bab1711decc5a75e86a90a79dba/1e043/03-choose-env.png 690w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Fill in the form.&lt;/p&gt;
&lt;p&gt;For this example we will use the Node.js pre-configured platform. You can use the Sample application option for Application code. We will overwrite that soon.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bbb2bd64bd3cd25fd2ee4663bc828aed/c56af/04-new-env-form.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUUlEQVQoz5WSS3IbMQxEff975Q6prJMqSTP84kMSIMGUhpZlK2XLeQus0AU0Gi8/fv6S1mKM4YZzngjNrPc+xnirCzObN15+705VvPfbjfP5vPlEXMs7mJmImKm1dhfPOc0METNASqm22vsQHb0Ps7GYn/AqBoQQQowREZm51DXsCiKKyGpbfBDPOVWumxMxANRa5/c4Jk8rWqBAwBghZsqlFW4FCkZIEVLCnDD55KFSHW3YuIu7DVRKNe3oLnHbwXsKDsOffLrEbUv7nvc9u3O8RI6g2K1/WHvO2VpbJmuroiIq2vVhT5tm0x4PxodbEX3reb2NPfVss/cuIkeSTEVE7/HYPzxe++pclYgAYHcu5dxaq7WtkL6a/J56sD5xHI/5H2JmTjESZuLCVZ7nvIyJyBgj53w6nbZtc86nDN8Sj9EBcimFmEMIpRRVffphfwGal2/WTgSmBgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;new-env-form&quot;
        title=&quot;new-env-form&quot;
        src=&quot;/static/bbb2bd64bd3cd25fd2ee4663bc828aed/f058b/04-new-env-form.png&quot;
        srcset=&quot;/static/bbb2bd64bd3cd25fd2ee4663bc828aed/c26ae/04-new-env-form.png 158w,
/static/bbb2bd64bd3cd25fd2ee4663bc828aed/6bdcf/04-new-env-form.png 315w,
/static/bbb2bd64bd3cd25fd2ee4663bc828aed/f058b/04-new-env-form.png 630w,
/static/bbb2bd64bd3cd25fd2ee4663bc828aed/40601/04-new-env-form.png 945w,
/static/bbb2bd64bd3cd25fd2ee4663bc828aed/c56af/04-new-env-form.png 1231w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Click the Create button and wait for you environment to be created.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/08966e6ab8970794ccc403c3a80fb507/b6e50/05-env-creating.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.746835443037973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQY05WQzUrDUBBGr9qkdaG+XH2iZJP2EqQRTLWW4gPYrlz0CSKIW8WN1SR3ptcgNIJK789IEkG7ETycxWy+GeZjKLLFU3p3//Cc5XkusjQVIgcAAQCAAhARl4hLACllURQvNYtUPGbIiEjXGiJLf2GtXa9VPZDRmoiq8Oxq3h/E0XA8HF80nowmUTxqHMRnx6fnvaMoubmVpSrKT6VNs6sKH3a7O9tbB/t7bdepdV2n5bR+3O10GGNBEBDR6u1da22t/b58OZ36vs8571fwSr5BGIae5yXJdflh5GuplGpeZPQftCXzq5gvtN0XbYCWuzQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;env-creating&quot;
        title=&quot;env-creating&quot;
        src=&quot;/static/08966e6ab8970794ccc403c3a80fb507/f058b/05-env-creating.png&quot;
        srcset=&quot;/static/08966e6ab8970794ccc403c3a80fb507/c26ae/05-env-creating.png 158w,
/static/08966e6ab8970794ccc403c3a80fb507/6bdcf/05-env-creating.png 315w,
/static/08966e6ab8970794ccc403c3a80fb507/f058b/05-env-creating.png 630w,
/static/08966e6ab8970794ccc403c3a80fb507/40601/05-env-creating.png 945w,
/static/08966e6ab8970794ccc403c3a80fb507/78612/05-env-creating.png 1260w,
/static/08966e6ab8970794ccc403c3a80fb507/b6e50/05-env-creating.png 1862w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This will take a while to complete.&lt;/p&gt;
&lt;p&gt;AWS provides you with a public URL (as you saw in the create env form) so once your environment is up an running you can access it in the browser. In my case I saw this.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4e209589316e9406812844bf5ec3944/a655e/06-sample-app.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQoz9XN30rCUADH8T1K0UW0qajnnG0dmee4scFC6MIg6NagqXOrbRpCl71AE/VW5v4YdJ1kLxdnq8ygBwg+F7+bLz9uurHDjR2+fpq9ufPt3eKdmW9vc+7kceA6tuP2rF7X6l0XbqwuN4xEZ0dyInH4G1I7dSgrsIGF8jF/csDzh7kjbpS2CkFKg5T6MfEi4sfUXzHeigYJMa8UkbaxeY6NNtbP5JYqEyJhxPlJsxCk9H6teUvVntH+E+mHzGBKh4umcYkRMSVVF6kmEoqwjBqnQKztx5nGrLVRqo7X2jhTJ8/Gw4upX4BatQZRGQDhCw9AaRd7icLEue8RK36q6J16tSJAVAHwp/Iu/kuQNfO4xJ7hnn8afwAMY9tKpZZOlwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;sample-app&quot;
        title=&quot;sample-app&quot;
        src=&quot;/static/f4e209589316e9406812844bf5ec3944/f058b/06-sample-app.png&quot;
        srcset=&quot;/static/f4e209589316e9406812844bf5ec3944/c26ae/06-sample-app.png 158w,
/static/f4e209589316e9406812844bf5ec3944/6bdcf/06-sample-app.png 315w,
/static/f4e209589316e9406812844bf5ec3944/f058b/06-sample-app.png 630w,
/static/f4e209589316e9406812844bf5ec3944/40601/06-sample-app.png 945w,
/static/f4e209589316e9406812844bf5ec3944/78612/06-sample-app.png 1260w,
/static/f4e209589316e9406812844bf5ec3944/a655e/06-sample-app.png 1563w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you go back to the EB view you can see the application health and there’s even a button to upload new code to EB. If you didn’t want a deployment pipeline you could just use that button.&lt;/p&gt;
&lt;h3&gt;Optional - add RDS&lt;/h3&gt;
&lt;p&gt;Just to go over how to add and use another service in EB, we will add a MySQL database to our app. This will be similar for whatever else you might want to add. I only picked RDS with MySQL since it’s very simple.&lt;/p&gt;
&lt;p&gt;Go to the configuration tab for you application.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/840e3e0a6a59801a68caf56cd9b3bb2c/cc6fe/07-eb-config-tab.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVQoz22QyW7DMAxE/f+/WLSHHhrEm2Rr5Sa2FhsFRToHQRuHjzPd7svb+8ftPu+729Z133fn3LV675x33h9d/qHjOLZ9//xabrObYoaCzE1TgRBCKZWZiYhESZSbvqp/QFWdYjwAQFVTV+tSVQBIMYqI3RDReZ6IOG5a0+k4nsXbtjGz2ZdSlmUOIYxuKSURsaNtphDOnLM9I+LF270RsZQSYwSA1oSZB4KIWI+JiDumImJKCbtEpNa6rlsIwbiIyHufc7bX384jhsckzTpbbDa/cRIiXKpG8ae4dJlraw3gCr/WelmIEFFKyRyf2KMYAHLOIxIiAqgiPAJDxPH5H2ybnJnN2+BtyNfjT/E3ejJJ97pRiXgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;eb-config-tab&quot;
        title=&quot;eb-config-tab&quot;
        src=&quot;/static/840e3e0a6a59801a68caf56cd9b3bb2c/f058b/07-eb-config-tab.png&quot;
        srcset=&quot;/static/840e3e0a6a59801a68caf56cd9b3bb2c/c26ae/07-eb-config-tab.png 158w,
/static/840e3e0a6a59801a68caf56cd9b3bb2c/6bdcf/07-eb-config-tab.png 315w,
/static/840e3e0a6a59801a68caf56cd9b3bb2c/f058b/07-eb-config-tab.png 630w,
/static/840e3e0a6a59801a68caf56cd9b3bb2c/40601/07-eb-config-tab.png 945w,
/static/840e3e0a6a59801a68caf56cd9b3bb2c/78612/07-eb-config-tab.png 1260w,
/static/840e3e0a6a59801a68caf56cd9b3bb2c/cc6fe/07-eb-config-tab.png 1860w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Scroll down for the database card and click &lt;code class=&quot;language-text&quot;&gt;Modify&lt;/code&gt;. You will be presented with a form to create a new database. You can fill in the form similarly to how I have below. I have chosen the cheapest options as I will be deleting all this soon after.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3c42bdc4c17a5e3fd6337d756b77ec9e/701e9/08-db-config.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1klEQVQoz42SC27EIAxEc/+79Q49QBacxAzGfFwRqmizTbr7hBAghhnZTOtCATAzhOCcW9e1nagH5/NmZhNCKKWYGTPP8+ycIyLvvXP+4bynZdsBkFISkTEPyUREAcHMRISIjkuqWmur3eCWiZlFxMxS0mVZgKCqKaWc80hbShkhL8THSlV5J0qn1mrvmJ43sSNZ853Vf2IAzAzgE9tXsaoCEJEo8on5OTawbVsvmOqo02j0Rd/blXMIDPDuHfOOquY/2Pgkz+Lfh1ttfdzGjlq/vtdc2g8aiokViiWhgAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;db-config&quot;
        title=&quot;db-config&quot;
        src=&quot;/static/3c42bdc4c17a5e3fd6337d756b77ec9e/f058b/08-db-config.png&quot;
        srcset=&quot;/static/3c42bdc4c17a5e3fd6337d756b77ec9e/c26ae/08-db-config.png 158w,
/static/3c42bdc4c17a5e3fd6337d756b77ec9e/6bdcf/08-db-config.png 315w,
/static/3c42bdc4c17a5e3fd6337d756b77ec9e/f058b/08-db-config.png 630w,
/static/3c42bdc4c17a5e3fd6337d756b77ec9e/40601/08-db-config.png 945w,
/static/3c42bdc4c17a5e3fd6337d756b77ec9e/78612/08-db-config.png 1260w,
/static/3c42bdc4c17a5e3fd6337d756b77ec9e/701e9/08-db-config.png 1780w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Once you click Save, be sure to click Apply on the next screen.&lt;/p&gt;
&lt;p&gt;Worth noting, if you already have a database in AWS, you can bind that instead of creating a new one if you wish.&lt;/p&gt;
&lt;p&gt;You can also just access any database from your app as normal but there are some advantages to using the binding in EB. One being that you get some environment variables injected so that your app can use them to connect to the database&lt;/p&gt;
&lt;p&gt;For RDS these are:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;RDS_HOSTNAME
RDS_PORT
RDS_USERNAME
RDS_PASSWORD
RDS_DB_NAME&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For other services you get similar things so it’s really handy. You don’t need to worry about securely distributing credentials to your application yourself.&lt;/p&gt;
&lt;h3&gt;Step 1 done&lt;/h3&gt;
&lt;p&gt;Now we have our EB application ready to use. This will have created an EC2 instance to host our application with Node.js setup. We also happen to have a load balancer and auto-scaling which are nice things to have although we won’t use them here. You could have chosen a single instance deployment too.&lt;/p&gt;
&lt;p&gt;Next we’ll look at setting up a user and user group to allow our CI system permissions for deploying our application.&lt;/p&gt;
&lt;h2&gt;2. Configure IAM with a deployment user and user group&lt;/h2&gt;
&lt;p&gt;For this we want to create a user group that has the correct permissions to deploy to our EB application. We will create a user for CodeShip to use. We will also set up some policies that give just enough permissions for that user group.&lt;/p&gt;
&lt;p&gt;In this section we will:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a policy for S3 access&lt;/li&gt;
&lt;li&gt;Create a policy for EB access&lt;/li&gt;
&lt;li&gt;Create a deployment user group and attach the policies we created&lt;/li&gt;
&lt;li&gt;Create a deployment user for CodeShip and add them to the deployment user group&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Create a policy for EB access&lt;/h3&gt;
&lt;p&gt;Go to the &lt;a href=&quot;https://console.aws.amazon.com/iam/home&quot;&gt;IAM&lt;/a&gt; service in your AWS console. Click on the &lt;code class=&quot;language-text&quot;&gt;Policies&lt;/code&gt; link on the left.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cb31902c13ac74a94448458b43455252/65d79/09-policies-page.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVQoz3WRSY4TQRBFfWnuwY47cAXEIdi0wDZYdLtyLGdEZuU8onJZTVmCp9g+/fgRh5RySmn07mL++IV8+Pzr09erkvx6neZ5rrX2Z8aOQwjBOdd7r7WeL2/ffry+XDgTklKqANIzMUatUSkFAIh4QETr3BijtUbp9PPy++X78Xg8McqE4JxzsYMxdj6f3+6cTqfDsiyllE12Lph54tPlld6YBNTG2cU8QwiRUlpr1+SZ0y25t9bGaI4vQJlpDKLQSfuyLzn60FpLKXPOa+d7B3DOjd5LG8UKrSjDwsFT5ZVNpbYdVWsUUoYYe+9rZ0IIIo7Rax/Vcn0jE2SiPLn56+zBpjEep26tAQDnPMa4JpdSUkrbS1bZiQWYMFVgkDpyjDG3vaw1SilTTNur/GJMzvkhW2EUpViocgwCBS90TKW+y7hP/nuL1ra1F0WYLgw8hTCbiDZrl9u7jCCE+I/sxKLIPdkzCBxDSHW/NiL+S+6ttJGtNMDXZOU5BgphCeu9H1MrohZyDjG23v8Ayiat0ZsfRaUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;policies-page&quot;
        title=&quot;policies-page&quot;
        src=&quot;/static/cb31902c13ac74a94448458b43455252/f058b/09-policies-page.png&quot;
        srcset=&quot;/static/cb31902c13ac74a94448458b43455252/c26ae/09-policies-page.png 158w,
/static/cb31902c13ac74a94448458b43455252/6bdcf/09-policies-page.png 315w,
/static/cb31902c13ac74a94448458b43455252/f058b/09-policies-page.png 630w,
/static/cb31902c13ac74a94448458b43455252/65d79/09-policies-page.png 905w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Click the &lt;code class=&quot;language-text&quot;&gt;Create Policy&lt;/code&gt; button. Select the JSON tab like below.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e2b30ae591026f1a511b65bc6355bd1a/89048/10-iam-policy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVQoz52LyW7DMAxE9f8f1p/orUpSH2JtXCRbJFXIWdBbCw8eBjND0CFSzoWIRXUi01VNH/VY9LXL3McY4+Mz8tZdY2AsBBlLIsgPGDNTYZwZIb2uCaAQV+3NdDfZHcONwG90rXCpMzy94Rvf6DJB39BX+Gromb6lLi6FJYel5pt2MGUTOuAD+lXfI28bARau6Nb1HoIv6Sp0157N4E9EYe+lS3UhrMwFSpRGQ/cx+j8xE5dzHqdkZi6ldP45xnj+mYjsrH4AxepJZv/RJo4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;iam-policy&quot;
        title=&quot;iam-policy&quot;
        src=&quot;/static/e2b30ae591026f1a511b65bc6355bd1a/f058b/10-iam-policy.png&quot;
        srcset=&quot;/static/e2b30ae591026f1a511b65bc6355bd1a/c26ae/10-iam-policy.png 158w,
/static/e2b30ae591026f1a511b65bc6355bd1a/6bdcf/10-iam-policy.png 315w,
/static/e2b30ae591026f1a511b65bc6355bd1a/f058b/10-iam-policy.png 630w,
/static/e2b30ae591026f1a511b65bc6355bd1a/40601/10-iam-policy.png 945w,
/static/e2b30ae591026f1a511b65bc6355bd1a/89048/10-iam-policy.png 1242w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Insert the following JSON, replacing my region and account ID with yours.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;autoscaling:ResumeProcesses&quot;,
                &quot;elasticloadbalancing:RegisterTargets&quot;,
                &quot;autoscaling:SuspendProcesses&quot;,
                &quot;elasticloadbalancing:DeregisterTargets&quot;,
                &quot;elasticbeanstalk:CreateApplicationVersion&quot;,
                &quot;elasticbeanstalk:DeleteApplicationVersion&quot;,
                &quot;ec2:DescribeImages&quot;,
                &quot;elasticbeanstalk:DescribeEnvironments&quot;,
                &quot;autoscaling:DescribeScalingActivities&quot;,
                &quot;autoscaling:DescribeAutoScalingGroups&quot;,
                &quot;elasticloadbalancing:DescribeTargetHealth&quot;,
                &quot;elasticbeanstalk:UpdateEnvironment&quot;,
                &quot;elasticloadbalancing:DescribeInstanceHealth&quot;,
                &quot;ec2:DescribeKeyPairs&quot;,
                &quot;elasticloadbalancing:DeregisterInstancesFromLoadBalancer&quot;,
                &quot;elasticloadbalancing:RegisterInstancesWithLoadBalancer&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;sns:ListSubscriptionsByTopic&quot;,
                &quot;sns:GetTopicAttributes&quot;,
                &quot;sns:CreateTopic&quot;,
                &quot;cloudformation:DescribeStackResources&quot;,
                &quot;s3:CreateBucket&quot;,
                &quot;s3:ListBucket&quot;,
                &quot;cloudformation:DescribeStackResource&quot;,
                &quot;s3:GetBucketPolicy&quot;,
                &quot;s3:PutObject&quot;,
                &quot;s3:GetObjectAcl&quot;,
                &quot;s3:GetObject&quot;,
                &quot;cloudformation:GetTemplate&quot;,
                &quot;cloudformation:UpdateStack&quot;,
                &quot;sns:Subscribe&quot;,
                &quot;s3:DeleteObject&quot;,
                &quot;s3:PutObjectAcl&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:sns:eu-west-1:123456789123:*&quot;,
                &quot;arn:aws:s3:::elasticbeanstalk-eu-west-1-123456789123&quot;,
                &quot;arn:aws:s3:::elasticbeanstalk-eu-west-1-123456789123/*&quot;,
                &quot;arn:aws:cloudformation:eu-west-1:123456789123:*&quot;
            ]
        }
    ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Click review policy and fill out the next form. Fill in detail that make sense to you and will make it easy to find the policy later.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b449048780e46fa41a2dbef413d4fbed/5205c/11-eb-iam-review.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVQoz4VS227bMAz1/3/S/mDPQ1ekSZqL7S6RrbtEUtcUilsv2Ib1gBIgQSLPOWQHAEopa63WOud8+wqltv37Tnz7MXX1jvKJ+hVKrbdbZZpGgZ0xRkqplAKAP4r8J8XyoIsxeu+FEABAd+AdMcY1xd/ka238uyajlBACAgjOpRRaad1W44IIAL6Uf3vRPqeUck5AyXhyEDxGh8FBAGqXnhLFElJ9jJhqLrdmmNZaSqk9aWOtddY5Yy0gPpJcY3HbxaAodusLTxljxpApFooFQ4bQjkAJQ15rUmoieqvenPnQnFNCIuu8dc55cN4b6zwgIDnnQ4iltbPmeywN/dC8zIkxWkpBhIvnMYYYYzMSkfN5nqZ5mjifBefzNDHGPMBv2oyx/evr9coYYxNjfX/e73fjMFyv1+ET2+12s9kMw9D3vbW2WzvJOf/5/Hw4nk7H4+k87E7j08vhcH4TD7hcLuM4CiE454j4aFgcJsO1QwAk4tL8YnwWChHX+QUArTURLXP2Dq4a7+kpriw6AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;eb-iam-review&quot;
        title=&quot;eb-iam-review&quot;
        src=&quot;/static/b449048780e46fa41a2dbef413d4fbed/f058b/11-eb-iam-review.png&quot;
        srcset=&quot;/static/b449048780e46fa41a2dbef413d4fbed/c26ae/11-eb-iam-review.png 158w,
/static/b449048780e46fa41a2dbef413d4fbed/6bdcf/11-eb-iam-review.png 315w,
/static/b449048780e46fa41a2dbef413d4fbed/f058b/11-eb-iam-review.png 630w,
/static/b449048780e46fa41a2dbef413d4fbed/5205c/11-eb-iam-review.png 833w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Create a deployment user&lt;/h3&gt;
&lt;p&gt;In the IAM console, click the Users link on the left menu and click the Add user button.&lt;/p&gt;
&lt;p&gt;Create a user to use in your CI system (I am calling mine codeship-deployer since I am using CodeShip). Select the Programmatic access option.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/54d01f45c52a37d728759aaae1a5ca7f/0f67e/12-new-user.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz5WRy3LbMAxF9eld9UOy6KLbznTZH0gm6042iS05dvUwKYsAAZIAO6IcxW0yeZzBgq8LXIAVee8cEFF+E1HNOf+4/bNpXc4SY0wpVd4jAEzOIWJ+D0cpiS5rVa2MMfv9frfb9X0/Z5km59zk3GmaToURgvNRC0XyTLVmDSGgR6AwTnhynoJw1MtAlvhU9lx53TAzID4OcL+323Z0NIvpIoAl/ScWkVRQFVVNmoPkKFn1nf7PPbdt23V913V2tIFDYA5MRISI/hJET4ScYpJzzyEEImLmcRyNMQ7QGHM8Hq21q5gW5gX7J/P/9DzfEsWUmqapm2a73fbDME++gB4RcSnzysAWUkqbh819oa7rw+Hg0RPz6v31aa9HfT8AwLPbUq249uRJy2DnkBfiT1EBgLX2I0+TqKP086b+8u366/fbq1931WxD5CPi5edbC7/r4a45Nt3pLyKrL/g+mbI5AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;new-user&quot;
        title=&quot;new-user&quot;
        src=&quot;/static/54d01f45c52a37d728759aaae1a5ca7f/f058b/12-new-user.png&quot;
        srcset=&quot;/static/54d01f45c52a37d728759aaae1a5ca7f/c26ae/12-new-user.png 158w,
/static/54d01f45c52a37d728759aaae1a5ca7f/6bdcf/12-new-user.png 315w,
/static/54d01f45c52a37d728759aaae1a5ca7f/f058b/12-new-user.png 630w,
/static/54d01f45c52a37d728759aaae1a5ca7f/0f67e/12-new-user.png 921w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Create a deployment user group&lt;/h3&gt;
&lt;p&gt;Rather than give the user permissions directly, it can make sense to use a user group instead. This makes life a little easier if you end up wanting to add more CI systems with their own users or something like that.&lt;/p&gt;
&lt;p&gt;In the IAM console, click the Groups option on the left. Click the Create New Group button.&lt;/p&gt;
&lt;p&gt;Give the group a sensible name. I just called mine Deployment.&lt;/p&gt;
&lt;p&gt;In the user group menu, select the Permissions tab and click Attach Policy.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4baf6f277ef4e00906f7a1222de1b71e/3534c/13-attach-policy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVQY053PS1LDMBAEUF09XIJjhBNwA9ixCkVlQXBkaT7yRMIe/cCLLBNcvH1XdxsRIeLvcA72mIJjZuccIrbW+l+MiACgyAUQY4xENI4jAKhqvquUYnLO3g7j8OntFxFersJdzvt5nk0p5e3oXg729XAe7DobAZiZiFJKrbV6w9pcan18Pj3s33dPH15y733D2VWt1aiqME7kk3BKKW4TQliWZf0MiM57JI5xa3iaJlU1tdb+L7+zfwBy3Mze70F/vAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;attach-policy&quot;
        title=&quot;attach-policy&quot;
        src=&quot;/static/4baf6f277ef4e00906f7a1222de1b71e/f058b/13-attach-policy.png&quot;
        srcset=&quot;/static/4baf6f277ef4e00906f7a1222de1b71e/c26ae/13-attach-policy.png 158w,
/static/4baf6f277ef4e00906f7a1222de1b71e/6bdcf/13-attach-policy.png 315w,
/static/4baf6f277ef4e00906f7a1222de1b71e/f058b/13-attach-policy.png 630w,
/static/4baf6f277ef4e00906f7a1222de1b71e/3534c/13-attach-policy.png 808w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Find the policies we created earlier and attach them.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9a18dcb0043698f7b2f63563ba74167f/c1c45/14-policies-to-add.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQ4y+2UzU4DIRRGff+HceF7mLjQBZY2ddoR5pfLBQZm4E4NtCZ1V92Z9IQAC07ul2/Bw7rSOI5KgVJjjPH0Gx6IqO/7oQAAJoOI2th8GGuNMVprRCSi9SdZXpZlmcs2zz7M4bzyPcyFUEgpEVH6hoiy3Egp277uVDOA6PWAE4aEPmqfAHMOc8mTE0ghqqo6HA6ImOW2bYUQu92OMbbffzRNs91uGWPsndUFzjec8+OxFuKTMbbhvKqqi4xT8CEoNYoCIlprXSGE4JwTQjSy6brOOSelFEICAFHKso+5immacuPj4EO47ibGCJALM8bEuKDWAOB9uLR9+it3+S7/C3m9gfNDuv5Jbpyzridw82ttn176x+f2rXZfuPrRe/WWilkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;policies-to-add&quot;
        title=&quot;policies-to-add&quot;
        src=&quot;/static/9a18dcb0043698f7b2f63563ba74167f/f058b/14-policies-to-add.png&quot;
        srcset=&quot;/static/9a18dcb0043698f7b2f63563ba74167f/c26ae/14-policies-to-add.png 158w,
/static/9a18dcb0043698f7b2f63563ba74167f/6bdcf/14-policies-to-add.png 315w,
/static/9a18dcb0043698f7b2f63563ba74167f/f058b/14-policies-to-add.png 630w,
/static/9a18dcb0043698f7b2f63563ba74167f/c1c45/14-policies-to-add.png 824w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Access Keys&lt;/h3&gt;
&lt;p&gt;Before we go on to the next step, you will need to get access keys for the user we created. For this, select the user by clicking on any hyperlink with the user name or navigating to the user in the users menu. Select the Security credentials tab for the user You should end up at a URL like this &lt;a href=&quot;https://console.aws.amazon.com/iam/home?region=eu-west-1#/users/codeship-deployer?section=security_credentials&quot;&gt;https://console.aws.amazon.com/iam/home?region=eu-west-1#/users/codeship-deployer?section=security_credentials&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Click on &lt;code class=&quot;language-text&quot;&gt;Create Access Key&lt;/code&gt;. You will be shown an Access key ID and Secret access key. Keep this for the next step where we will configure our pipeline and will have to provide these keys.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bf7c8ab8b84039fbb41aeb8e7978dde5/9d76a/15-keys.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVQoz5XQ227DIAyAYd7/BddDki4BYohNmgOGHIg2NVWnrrvY9uu7wJZ8gzgej3meZ1l2Pp+VlISITfMbtMYCgKihDjGM7D3zGDxH9j9wDA985wOHGAQ6rCeEiHVs+nXkLbzwG/vkx3WXeFzZJ+7XMW6TADTD5k1nTjp7h7JGrazSzRcNDmgge7U00E2P1FM39THtx5z4GjoaCAdyvnWjo9390cXer/xiWMYpzcJaW+taSqm1JqKP/yTAQFEUh7dDWZbGGGvt5VKc9qSU1lrzyD4FALcPc3sAgIjGmBgjIlZVJWVVVaVSUiklZaW0dgMvy3xvmqaUkgCAlNLyWE978zw/jd+G50RRFG3bIiIRub+F2OR53jTNJ0f8MYfwBwe+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;keys&quot;
        title=&quot;keys&quot;
        src=&quot;/static/bf7c8ab8b84039fbb41aeb8e7978dde5/f058b/15-keys.png&quot;
        srcset=&quot;/static/bf7c8ab8b84039fbb41aeb8e7978dde5/c26ae/15-keys.png 158w,
/static/bf7c8ab8b84039fbb41aeb8e7978dde5/6bdcf/15-keys.png 315w,
/static/bf7c8ab8b84039fbb41aeb8e7978dde5/f058b/15-keys.png 630w,
/static/bf7c8ab8b84039fbb41aeb8e7978dde5/9d76a/15-keys.png 829w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;3. Configure a deployment pipeline with CodeShip&lt;/h2&gt;
&lt;p&gt;I will be using CodeShip specifically here but I guess the instructions would be reasonably similar for other tools too. I am going to assume you have a project setup and all you have left to do is configure a deployment. Select the deploy option in project settings and select Amazon ELastic Beanstalk.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/58354/16-cs-deploy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQoz3VSy07DMBDM/38LH8AFwZVKnBFXUqehVEASv707ixynVmjCaA87a8++7OZy+Tqq7qj691apru8/zqo7tarzIcZExUJM1V9bQxlJwIkopZkkYgYg1URkTYsxo8lxyGgjyq0ZPtrqAzh/t+vTGm9EJCS+P7yNxi1RxsvrU6JQqPXm4fmuakOg4ccxZ96UlMH7mhtAjKlSZvYu7FfeRv/D7cxVjM29WtZaq7VxLrd6u+2lcvwUmoowa67qGOOk7TAarXXK4L9iESETTo9YNgSBTL5sRIhhXBiGwRgzv+JWDBAxVj0zBDsz77W9+gWC6/yLXzA725l/ARfSh2iihWkkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cs-deploy&quot;
        title=&quot;cs-deploy&quot;
        src=&quot;/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/f058b/16-cs-deploy.png&quot;
        srcset=&quot;/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/c26ae/16-cs-deploy.png 158w,
/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/6bdcf/16-cs-deploy.png 315w,
/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/f058b/16-cs-deploy.png 630w,
/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/40601/16-cs-deploy.png 945w,
/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/78612/16-cs-deploy.png 1260w,
/static/057a71280eb9d4c3ec2f3bf7ebdc5fc5/58354/16-cs-deploy.png 1396w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You will be shown a form to fill in. If you have followed along so far you should have all the values you need for this ready to go. Fill in the form similar to what I have here.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0b344d1e3ad0360bf8f12514da218ad1/0931d/17-cs-eb-fill-in.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuklEQVQY042QS27DMAxEdf+zdNNsepWiQJAAKdJP3MiybIvkDOUg1raIAzxw98jhhNin2CdRqFHB+3yCWTAJwvnru/u7Gmh3E2qg+zOAHrruGvthNVnEZLXpdQNWA0MacjsrZnmcDNw2VxQMsU9qaJnbIq/Va92MbfTw89uptYc9p6IFopiKGv0RcDWGsn5Jeiz5/bL/uBzikIc8y+PC4QIPLfDC5ZhPL5+71/PbaLNzaUX8D92m0cZ8A48v0yVh663xAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cs-eb-fill-in&quot;
        title=&quot;cs-eb-fill-in&quot;
        src=&quot;/static/0b344d1e3ad0360bf8f12514da218ad1/f058b/17-cs-eb-fill-in.png&quot;
        srcset=&quot;/static/0b344d1e3ad0360bf8f12514da218ad1/c26ae/17-cs-eb-fill-in.png 158w,
/static/0b344d1e3ad0360bf8f12514da218ad1/6bdcf/17-cs-eb-fill-in.png 315w,
/static/0b344d1e3ad0360bf8f12514da218ad1/f058b/17-cs-eb-fill-in.png 630w,
/static/0b344d1e3ad0360bf8f12514da218ad1/40601/17-cs-eb-fill-in.png 945w,
/static/0b344d1e3ad0360bf8f12514da218ad1/78612/17-cs-eb-fill-in.png 1260w,
/static/0b344d1e3ad0360bf8f12514da218ad1/0931d/17-cs-eb-fill-in.png 1373w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;AWS Access Key ID&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;AWS Secret Access Key&lt;/code&gt; are the keys we generated for the deployment user. The &lt;code class=&quot;language-text&quot;&gt;Region&lt;/code&gt; is whatever region you created your EB stuff in. The &lt;code class=&quot;language-text&quot;&gt;Application&lt;/code&gt; is the name of the EB application we created. The &lt;code class=&quot;language-text&quot;&gt;Environment&lt;/code&gt; is the name of the environment we created for the application. The &lt;code class=&quot;language-text&quot;&gt;S3 Bucket&lt;/code&gt; is the name of the bucket being used by EB to store application resources.&lt;/p&gt;
&lt;p&gt;Now you can run your deployment pipeline. You probably need to push something to the branch you have configured to deploy.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;One little gotcha&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The first time I ran my pipeline I go this.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/162a57a7904041f2bbae48e233a27c03/98432/18-gotcha.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQY02N4/eH927fv374DoQ8fPn74+Onz5y9fvnz98uXr16/fvnz9BmGjoc+fv3z69IXh+9/fP37+/vXrz49fv//8+fufaPD333+GE0eOnDgMRSePHAWh4ydOnTl36sy5y1dvXLx87eTpsxAuMjpx6sz5i5cZpJR1JFV0pFR0pFR1pZS1wQwdKSUNaWUtO7cAcwcPCXk1aSVNZCSjrCUirWzv6sMgp2mgqGssq20ko2Uko24go6ovo6wto6AuraAuJqsiJqsiIa+GhiQV1AUl5G2dPRm6e/r7evq7uvs7uvo6u/s7ukFkZ/eEju4Jbd39bd39rV3oqK17QmNbz4y5CwErHdYQkyU4QwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gotcha&quot;
        title=&quot;gotcha&quot;
        src=&quot;/static/162a57a7904041f2bbae48e233a27c03/f058b/18-gotcha.png&quot;
        srcset=&quot;/static/162a57a7904041f2bbae48e233a27c03/c26ae/18-gotcha.png 158w,
/static/162a57a7904041f2bbae48e233a27c03/6bdcf/18-gotcha.png 315w,
/static/162a57a7904041f2bbae48e233a27c03/f058b/18-gotcha.png 630w,
/static/162a57a7904041f2bbae48e233a27c03/40601/18-gotcha.png 945w,
/static/162a57a7904041f2bbae48e233a27c03/78612/18-gotcha.png 1260w,
/static/162a57a7904041f2bbae48e233a27c03/98432/18-gotcha.png 1383w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To fix it I went in to the deployment menu in my EB app, removed the sample app and deployed the new app that Codeship had put there. The pipeline worked from then on. I presume I missed some step somewhere or perhaps I should have uploaded the app I was going to deploy in the earlier steps instead of selecting the Sample App.&lt;/p&gt;
&lt;h2&gt;Testing things out&lt;/h2&gt;
&lt;p&gt;Your app should now be available to test. For me the public URL for my app was here.&lt;/p&gt;
&lt;p&gt;mytestapp.eu-west-1.elasticbeanstalk.com&lt;/p&gt;
&lt;p&gt;For you it will be the name of you app without hyphens + your region + .elasticbeanstalk.com&lt;/p&gt;
&lt;p&gt;Hit the URL to make sure the app is running.&lt;/p&gt;
&lt;p&gt;You can go in and check out application logs.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/55f0d6b183d264e54ef147a7160530c4/b88bf/19-env.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.48101265822785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVQY06XPzQ4DIQgEYN//Tdf91dEVEaRZTZueeul3gkxIGIebMwkK55RyvomoVqqVqSmxNlF7672bmQ4xRiJyRGRmPIhIm7gxj0FUtdsXIgqPWGt1MwPg/bqu677vx3Gcg1+WxfsQI4bzPEMIAOLwHFdmM8uFU+Gc03VdAESk9w5g27b5kaqmlACoqgyq6kops8yn2Pf6m7M/vAAN6F+Ey37MqAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;env&quot;
        title=&quot;env&quot;
        src=&quot;/static/55f0d6b183d264e54ef147a7160530c4/f058b/19-env.png&quot;
        srcset=&quot;/static/55f0d6b183d264e54ef147a7160530c4/c26ae/19-env.png 158w,
/static/55f0d6b183d264e54ef147a7160530c4/6bdcf/19-env.png 315w,
/static/55f0d6b183d264e54ef147a7160530c4/f058b/19-env.png 630w,
/static/55f0d6b183d264e54ef147a7160530c4/40601/19-env.png 945w,
/static/55f0d6b183d264e54ef147a7160530c4/78612/19-env.png 1260w,
/static/55f0d6b183d264e54ef147a7160530c4/b88bf/19-env.png 1702w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If I hit issues deploying my app, I usually add a bunch of logging for things like the database connection or any other environment specific stuff and can check what is being picked up in those logs. Haven’t come up with a better way than that yet.&lt;/p&gt;
&lt;p&gt;That’s it. I hope it all worked out for you and you were able to get a deployment pipeline going. Please feel free to give any feedback or ask any questions in the comments section below.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Where to put Angular with Redux]]></title><description><![CDATA[I am reasonably new to Angular 2+ and have already made a bunch of bad decisions when using it with Redux. This is probably old news to most…]]></description><link>https://ruarfff.com/angular-and-redux/</link><guid isPermaLink="false">https://ruarfff.com/angular-and-redux/</guid><pubDate>Mon, 05 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I am reasonably new to Angular 2+ and have already made a bunch of bad decisions when using it with Redux. This is probably old news to most people but one thing I struggled with was how to work with Redux selectors and where to put them in components.&lt;/p&gt;
&lt;p&gt;I have dabbled with React and Redux and one thing I liked a lot was the concept of &lt;a href=&quot;https://reactjs.org/docs/components-and-props.html&quot;&gt;functional components&lt;/a&gt;. That’s where all the component state gets passed in as parameters and no internal modification of state is done. Therefore you can test any variation of the components behavior by modifying the inputs.&lt;/p&gt;
&lt;p&gt;If state needs to be changed, the component emits events that produce actions that alter the application state. Any interaction with external things like the Redux store would happen in container components where you bind the inputs and outputs for any child components.&lt;/p&gt;
&lt;p&gt;Good terms for these concepts that I came across in &lt;a href=&quot;https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0&quot;&gt;a post by Dan Abramov&lt;/a&gt; are Presentation and Container components. Presentation components being the simple components that take state as inputs and present it. Container components being the components that manage interaction with the likes of Redux and provide inputs to presentational components.&lt;/p&gt;
&lt;p&gt;I recently started working on a reasonably large angular project. I struggled with finding good examples and developing a good idea of where things should go to keep the code base clean.&lt;/p&gt;
&lt;p&gt;One thing that caught me out a lot was how coupled the component code was to Redux, or at least &lt;a href=&quot;https://github.com/angular-redux/store&quot;&gt;ng2-redux&lt;/a&gt;. This code base is making heavy use of the &lt;a href=&quot;https://github.com/angular-redux/store/blob/master/articles/select-pattern.md&quot;&gt;select pattern&lt;/a&gt; A typical component in the code base might look something like this, taking a really simple and made-up user list as an example.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;
@&lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;app-users&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./users.component.html&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UsersComponent&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OnInit&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  @&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;userManagement&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;users&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; users$&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Observable&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;userManagementActions&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserManagementActions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  @&lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ngOnInit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userManagementActions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fetchUsers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And a simple template for that.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;*ngFor&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;let user of (users$ | async)&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{ user.name }}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There’s nothing particularly wrong with this. It will work fine.&lt;/p&gt;
&lt;p&gt;From a design and clean code perspective, issues can start to crop up when this component is used in other components and if this component is going to get used in more that one place.&lt;/p&gt;
&lt;p&gt;Let’s look at how we might test this component.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;UsersComponent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;component&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UsersComponent
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;fixture&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ComponentFixture&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;UsersComponent&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;userManagementActions&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserManagementActions
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HTMLElement
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ngRedux
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; usersSelector

  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureTestingModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;imports&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NgReduxTestingModule&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;declarations&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;UsersComponent&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;providers&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;UserManagementActions&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;compileComponents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    MockNgRedux&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    usersSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MockNgRedux&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSelectorStub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;userManagement&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    ngRedux &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;NgRedux&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;spyOn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ngRedux&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;dispatch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    fixture &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;UsersComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    userManagementActions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;UserManagementActions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;componentInstance
    element &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;debugElement&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nativeElement

    fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;detectChanges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;should dispatch fetchUsers action&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ngRedux&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalledWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      userManagementActions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fetchUsers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;should render users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    usersSelector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;one&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;First&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;two&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Second&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;detectChanges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userElements &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;querySelectorAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;li&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userElements&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;textContent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toContain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;First&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userElements&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;textContent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toContain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Second&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s a really simple component but there is still a fairly large amount of boilerplate test setup code there. Also, we have really embedded Redux in to that component. The test needs to do a lot of mocking. We need to mock Redux, verify we dispatch an action on initialization, mock what comes from the store and test that we render that correctly.&lt;/p&gt;
&lt;p&gt;What if we need an almost identical component but want to dispatch a slightly different action on initialization?&lt;/p&gt;
&lt;p&gt;Doing all this setup for every component test gets to be a bit of a drag.&lt;/p&gt;
&lt;p&gt;There’s just a bunch of issues with doing components this way I think but it still seems to be a common pattern.&lt;/p&gt;
&lt;p&gt;The solution to avoid these issues may be really obvious to most but I had to struggle a bit before arriving at it.&lt;/p&gt;
&lt;h2&gt;Presentation Components&lt;/h2&gt;
&lt;p&gt;We don’t have the functional syntax for components that React has in Angular but we have something similar.&lt;/p&gt;
&lt;p&gt;Angular components have the &lt;a href=&quot;https://angular.io/api/core/Input&quot;&gt;@Input()&lt;/a&gt; and &lt;a href=&quot;https://angular.io/api/core/Output&quot;&gt;@Output()&lt;/a&gt; property decorators. These allow us to take all the required state as inputs and emit any internal events as outputs. If we emit an event to update the Redux store for example, the inputs can be changed in the container and the components can be re-rendered. This way the component only needs to know how to present the input state and what to emit on an interaction.&lt;/p&gt;
&lt;p&gt;We could instead write the component like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;@&lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;app-users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./users.component.html&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;changeDetection&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ChangeDetectionStrategy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OnPush&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UsersComponent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  @&lt;span class=&quot;token function&quot;&gt;Input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; User&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The template would be updated to look like this (just removing the async pipe).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;*ngFor&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;let user of users&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{ user.name }}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The tests get a bit easier for that component then. Just set the value of the input add test the rendering.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;UsersComponent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;component&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UsersComponent
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;fixture&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ComponentFixture&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;UsersComponent&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HTMLElement

  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureTestingModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;declarations&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;UsersComponent&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;compileComponents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fixture &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;UsersComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;componentInstance
    element &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;debugElement&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nativeElement
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;should render users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    component&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;users &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;one&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;First&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;two&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Second&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    fixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;detectChanges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userElements &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;querySelectorAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;li&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userElements&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;textContent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toContain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;First&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userElements&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;textContent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toContain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Second&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There’s a lot less boilerplate and I think the tests are a lot cleaner since we are not mocking or stubbing internal state.&lt;/p&gt;
&lt;p&gt;Because we have kept the component so simple and with less dependencies it is easier to test and also much more reusable than if we used those Redux selectors directly.&lt;/p&gt;
&lt;h4&gt;changeDetection: ChangeDetectionStrategy.OnPush&lt;/h4&gt;
&lt;p&gt;You may have noticed we set the &lt;a href=&quot;https://angular.io/api/core/ChangeDetectionStrategy&quot;&gt;changeDetection&lt;/a&gt; property for the component. This is something we should try to use when writing our components this way. When we set this we are saying we will not change the inputs internally. This allows a little optimization because Angular won’t check the internal state to see if it needs to update the rendering. Therefore if you change the state internally, the updates will not get picked up for rendering. The change detection strategy checks the reference of the input and if that has not changed, it does nothing. This makes it work well with Redux since we will always bring back a new reference from the store if there was a change.&lt;/p&gt;
&lt;h2&gt;Container Components&lt;/h2&gt;
&lt;p&gt;We can’t avoid having dependencies between Redux and our components completely but we can keep it in container components.&lt;/p&gt;
&lt;p&gt;Say you have a component representing a page that contains a list of users and maybe something else. That could be the Container component since it probably won’t have any complicated things to do itself. For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;some-other-thing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;some-other-thing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;app-users&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;[users]&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;users$ | async&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;app-users&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;@&lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;app-user-management&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./user-management.component.html&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserManagementComponent&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OnInit&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  @&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;userManagement&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;users&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; users$&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Observable&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;userManagementActions&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserManagementActions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  @&lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ngOnInit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userManagementActions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fetchUsers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we only need to test the Redux related things there (with all the mocking and boilerplate setup code), keeping the child components simple.&lt;/p&gt;
&lt;p&gt;In React the tendency is to have one container component for each presenter with the container having no makeup of its own. This is another potential pattern to try out here.&lt;/p&gt;
&lt;h2&gt;Interactions&lt;/h2&gt;
&lt;p&gt;What if you need a component to dispatch and action to the store?&lt;/p&gt;
&lt;p&gt;So lets say the user list has a delete button and on clicking it, you want to fire off an action to delete that user.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;@&lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;deleteUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userManagementActions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;deleteUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You could add that to the UsersComponent but then you’re back to adding all that Redux test stuff. Instead it might be good to emit that event using an Output.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;@&lt;span class=&quot;token function&quot;&gt;Output&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token literal-property property&quot;&gt;onDeleteUser&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EventEmitter&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventEmitter&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;deleteUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onDeleteUser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can dispatch the action in the container by listening for that event.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;some-other-thing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;some-other-thing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;app-users&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;[users]&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;users$ | async&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;(onDeleteUser)&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;deleteUser($event)&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;app-users&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I am definitely finding Angular code easier to understand and test using this technique. It’s still not great but it’s a bit more manageable. Angular and Redux are both fine tools but, like any code bases, the code base using them can start to get pretty messy unless some decent patterns are used. The Container &amp;#x26; Presenter pattern is a good one for this scenario I believe.&lt;/p&gt;
&lt;p&gt;Some runnable example code for the above is here: &lt;a href=&quot;https://github.com/ruarfff/angular-demo-code/tree/master/src/app/user-management&quot;&gt;https://github.com/ruarfff/angular-demo-code/tree/master/src/app/user-management&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Introduction to Kubernetes]]></title><description><![CDATA[This post is a relatively short introduction to Kubernetes looking at some of the basic features. We will look at using kubernetes in two…]]></description><link>https://ruarfff.com/kube-intro/</link><guid isPermaLink="false">https://ruarfff.com/kube-intro/</guid><pubDate>Tue, 27 Jun 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This post is a relatively short introduction to &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; looking at some of the basic features.&lt;/p&gt;
&lt;p&gt;We will look at using kubernetes in two ways. With the Google Cloud Platform (GCP) with &lt;a href=&quot;https://cloud.google.com/kubernetes-engine/&quot;&gt;GKE&lt;/a&gt; and with minikube.&lt;/p&gt;
&lt;p&gt;You can use one or the other or both, or indeed some other cloud provider but GCP and minikube are what we will use here. I recommend playing around with both GCP and minikube since it won’t cost you anything. For GCP you need a Google account but you will also need a way to setup billing which pretty much means you will need a credit card. You won’t have to spend money but you will need to have billing enabled in the GCP account.&lt;/p&gt;
&lt;h3&gt;Install the GCP SDK&lt;/h3&gt;
&lt;p&gt;Instructions here are good and cover all platforms: &lt;a href=&quot;https://cloud.google.com/sdk/&quot;&gt;https://cloud.google.com/sdk/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;You can also just use the cloud console in the GCP UI but I will use &lt;code class=&quot;language-text&quot;&gt;gcloud&lt;/code&gt; in the examples here.&lt;/p&gt;
&lt;h3&gt;Install kubectl&lt;/h3&gt;
&lt;p&gt;Assumes you have followed the instructions above and installed &lt;code class=&quot;language-text&quot;&gt;gcloud&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
 gcloud components &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; kubectl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Google Cloud Platform&lt;/h3&gt;
&lt;p&gt;You can just skip forward and setup minikube if you prefer but I recommend using this to have something a little more ‘real’.&lt;/p&gt;
&lt;p&gt;First you need a google account. Not much point me explaining how to do that I guess.&lt;/p&gt;
&lt;p&gt;Then you will need to setup a GCP dashboard for yourself (if you haven’t one already). Just open this link &lt;a href=&quot;https://console.cloud.google.com/start&quot;&gt;https://console.cloud.google.com/start&lt;/a&gt; and follow the instructions.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8105e4bab9a47f7ce2204908eb6d5caf/de9fe/dashboard.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVQoz52QwUrDQBCG87YioiBSBPVQX0GwgqCWHuoTiAcLrfGmojV9hUAS6UbZbdOd3ZhfZuNi1XjQhY9/YIaPmQ02jzNsn6ZonaVodTNsnSTYOIqx3omxchBj9TDBWifBbjfFXi9Duy/Q7uc/2D/PsdMTCC7vJC5uFa4jhcG9wOhJYhjNHINHhauHmnCicDPhOdlIGEkMxxKBIYKaE/DGFAAIgPk3gdYEIgKnJoOFpkbIWBDZX/uegGXfMcY4fM05nQoUxQL8qqpy+Hp59ovQNMiJavnri4CU0tVa64+r6rTWfgr9Nk34If6KcJzjWSgU8xmMsU7CPc4/CzmzXKNY8MYaZVk6ic/lk98BEI5YKnAUMNUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;Dashboard&quot;
        src=&quot;/static/8105e4bab9a47f7ce2204908eb6d5caf/f058b/dashboard.png&quot;
        srcset=&quot;/static/8105e4bab9a47f7ce2204908eb6d5caf/c26ae/dashboard.png 158w,
/static/8105e4bab9a47f7ce2204908eb6d5caf/6bdcf/dashboard.png 315w,
/static/8105e4bab9a47f7ce2204908eb6d5caf/f058b/dashboard.png 630w,
/static/8105e4bab9a47f7ce2204908eb6d5caf/40601/dashboard.png 945w,
/static/8105e4bab9a47f7ce2204908eb6d5caf/78612/dashboard.png 1260w,
/static/8105e4bab9a47f7ce2204908eb6d5caf/de9fe/dashboard.png 2146w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;When on that page click the ‘Create’ button to create a project.&lt;/p&gt;
&lt;p&gt;When selecting a name for your project try to use something globally unique to you. For example, for me I append my username.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6fad110f2cf65eaa5f0b0087ba7d6293/f4281/new-project-name.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVQ4y6WST2vUQBiH85W0R8GL+KfSo3oQSz148ODFnoogrfaiYttD8aD9GHryIwiCIspqd7PdZifZbGezSSYxyWaSR5KUCmV3rfoOD+8w8/5efi8zxuV1yYW1IdeeSBafSq6sSy49llzdkCxtjup88dER5x4OOb86nYVVl6VNyc0XHsbtl0fceDbk3q7kwesRy1suKzsud7Zc7u40+1vPByxuOFyfic3KtsP9VwMM4YywBxLLrhgxDhOCaEIQZfgqw48ywnhC9HM+YZzVGqNrdjA7bbqdNj++t9D5hP8J4/RBWZZoXVAUBfqM1LW6wbCsPqZpIvqCMFRN0fFlcSIof1NOpzzG2O+6fPy8z6cvbb62erTafTo9lyAuiRJQCQRxQRBp/Ap1ikgzVppcl83IaTzGl4KBY9MXDoeHFgcHPYSwEULU2fM85DglzUqqNc1p5a5u+P6Dx95bm54dEisfpRRZmpIkCWlFmpLnE3JdnIhmRT3ym3dD1vYE37oBrmMRBOqPollMfeWziOY5NZpC/ko09x/+i4t5DX8BM4LGeBo1OgQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;New Project&quot;
        src=&quot;/static/6fad110f2cf65eaa5f0b0087ba7d6293/f058b/new-project-name.png&quot;
        srcset=&quot;/static/6fad110f2cf65eaa5f0b0087ba7d6293/c26ae/new-project-name.png 158w,
/static/6fad110f2cf65eaa5f0b0087ba7d6293/6bdcf/new-project-name.png 315w,
/static/6fad110f2cf65eaa5f0b0087ba7d6293/f058b/new-project-name.png 630w,
/static/6fad110f2cf65eaa5f0b0087ba7d6293/40601/new-project-name.png 945w,
/static/6fad110f2cf65eaa5f0b0087ba7d6293/f4281/new-project-name.png 1016w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Notice it says ‘Your project ID will be {the ID}’ and in my case the ID matches the name I specified.&lt;/p&gt;
&lt;p&gt;Beware if you use a name that has already been used somewhere else in the world, like in this example:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/11922aac4d591b1290d23a345fb4b9b2/f79fa/new-project-random-id.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABl0lEQVQoz5XSwWsTQRTH8fmHRG9evHlQPIjov+DFCrXUVhQUqmBFPLcgNh5E/F/Ea6qr6W5DmsnubHaTNJtudicz85VNrVZNavzBhzc83uHBG3FxPebyk5hLD2NubCbcfJFw7dmxq08Tbr1Muf485cpGwvl7inPL811YiRDLrxWP3vVZ3Ul5/L7Hxoc+a7WYB28V93cU6zXFWk2x+kaxtB1xZ2u+u9shAqsJZYt+quiqDrEKqXrgAPvfRFlqvK/fkLJDEAT4fkDVq2IduFPsAoRzlj/jnMNai7N2WhdxMiu01tR3PRoNH99vko1y9MSewc1ljEOMS4u316b+ZR+v0WLXC2i2FIWGcQl5pYCjwv1gGY0tWW5+U/UOjwxiMjH00hgVSqQMOWiHtA7ktLbbIbITEUZdpIxIewNUWlAtMTHHW1X1NFGUhk+fUz7WY/qDjNEoYzg8JMt+1TzPKYoxWpdU89WB5kXIRHP7VZOVLYm336MZ7DEcZpwdNz3cLMJYR3egSQYaY+zPK//LydxfG876MrPei+Y7sQZ6JzeSYfEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;New Project Random ID&quot;
        src=&quot;/static/11922aac4d591b1290d23a345fb4b9b2/f058b/new-project-random-id.png&quot;
        srcset=&quot;/static/11922aac4d591b1290d23a345fb4b9b2/c26ae/new-project-random-id.png 158w,
/static/11922aac4d591b1290d23a345fb4b9b2/6bdcf/new-project-random-id.png 315w,
/static/11922aac4d591b1290d23a345fb4b9b2/f058b/new-project-random-id.png 630w,
/static/11922aac4d591b1290d23a345fb4b9b2/f79fa/new-project-random-id.png 940w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You will get a random ID, which is a pain because whenever you need to use the ID you have to go digging for it (for some reason I keep forgetting where to find it) but the name is always visible in the UI and easier to remember.&lt;/p&gt;
&lt;p&gt;Next you will want to go the the API manager dashboard.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f1515d7512fb90ec00256043f0c29da4/0b569/api-manager-menu.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoElEQVQoz1WRDW7UMBCFc/8LIBBFCND2BtBWiC0nobvdsInzY6+dPydxPjRuvSojjTJ+fvPmeZJ9/WX5tnfc/nZI/eGH5uZe8/57zce7lt2jZvdouH1NqXd7zW5vuLk3fHowfP554d2D5stdTjaMM103ENYVtkDXj8x+gm0EVmABPIQJ1gE2H/El9Li1pVtaLr7GeIMdHZmqGk75GW0crbG0WlMqheAiHjbwfqbVBmMsk5/ZBJsXilJRqgrretYQcM6RFUVBXdcsszh1NE2DEkGlGMeRbdtY1/X6XZblWsu9vdgrz1pHNk0TkhJCttbGSX3fE0JgnueISyRBCekxxkTeMAyRGx0mQEJAqcVx13X/OXubaZC8RtwlXhQUAXGViEKQC/lKk+De++hEcHElPQkTUTmnFUSHrW4jQQTlbJ29PnUNL4IilHYlIbXWmqqqoqBwpSeTQi5TiGiannYrIUJp6AsA0zgxvK4s/azsz+GJU34iP+fkec7x+cjT8cDheOBcnKmbOqa+aBrdxLo1mrJSHJ6PnP7mFGVBoUrKWvEPg4v7gVJjagoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;API manager menu&quot;
        src=&quot;/static/f1515d7512fb90ec00256043f0c29da4/f058b/api-manager-menu.png&quot;
        srcset=&quot;/static/f1515d7512fb90ec00256043f0c29da4/c26ae/api-manager-menu.png 158w,
/static/f1515d7512fb90ec00256043f0c29da4/6bdcf/api-manager-menu.png 315w,
/static/f1515d7512fb90ec00256043f0c29da4/f058b/api-manager-menu.png 630w,
/static/f1515d7512fb90ec00256043f0c29da4/40601/api-manager-menu.png 945w,
/static/f1515d7512fb90ec00256043f0c29da4/78612/api-manager-menu.png 1260w,
/static/f1515d7512fb90ec00256043f0c29da4/0b569/api-manager-menu.png 2878w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Click ‘Enable API’ near the top of the page.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3413de31980269322eda1e2d2188c3cc/60708/enable-api.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYklEQVQoz52Sb2vUQBCH8/2/jBYUrb5QxNJCPZXCYeHuTEuTXoh3+XfZ3Wx2k0dm27Sh4ot24OG3M7s7+5uQ6OjkD29Oc96fF3xYNLz+mnO8aHh12nJ0duDTheLzhQo6R2rHi5Z331o+fm95+9Pw5UdGlO9btnlDUWu6zqLqHJwCBl4SUdUo9kWD0hZtLGVV0xwUtnf4YQxY63B+YBgIemgNh1ZRFFVQrTuUNhjTEfV9zx02qFKKYbhzN45jUK3FfRfyqSZ5Xdd47x/OCpG1lglpKMUpl0tyYapJLkznJJxzGGMezkVTo0nnrz1dz+N/tX8azseVtWD7Aed8cDNHnMm+uBYNDacxplF2ux1lWYYLjw09fe94/N592NfG4LwPZnb7fdDoqe2yKMmy7Nm/S11VMEK0jjcIq99r4quY1WbF8nLJOl6TbtNAsk3uSe9JSLOUm9uE+Oaa5DZlefmLzXXMX6pzA2HyUXgjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;Enable API&quot;
        src=&quot;/static/3413de31980269322eda1e2d2188c3cc/f058b/enable-api.png&quot;
        srcset=&quot;/static/3413de31980269322eda1e2d2188c3cc/c26ae/enable-api.png 158w,
/static/3413de31980269322eda1e2d2188c3cc/6bdcf/enable-api.png 315w,
/static/3413de31980269322eda1e2d2188c3cc/f058b/enable-api.png 630w,
/static/3413de31980269322eda1e2d2188c3cc/40601/enable-api.png 945w,
/static/3413de31980269322eda1e2d2188c3cc/78612/enable-api.png 1260w,
/static/3413de31980269322eda1e2d2188c3cc/60708/enable-api.png 2872w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Select ‘Compute Engine API’ (click the link under Popular APIs or search for it in the unlikely event it’s not visible).
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c3227d60b192cceb626ea7b6188cbaae/0940f/select-compute-engine.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByklEQVQ4y52T2W7bMBBF9f8/1acCAQK0KNpsThMlXiTLlixZC8khKZ5CjB2nyFZ0gAM9SDy8miGT1WrFbrejKAq22y1lWaKUwhiD1hojhqqq4jtrLeM44r1/lyTPc5qmiQvyLGexWKKUjosnqXMubpamKc5apgohvEtiZUqi6No9RitC8DgrWCuI6Cg8lh9DTPgRSb6pKco9D/OcvNix7yXS9kLTGazzZKXlPjPUnedU4U2Ss2vN+cxwdm25nAs/U3VA8+NuoB0cTSsUlYobaC0oLYj1WDe+Iqnqjk3ZkD5m5OuSbpBn2t4gdmS3N+Sbhm3VkxUNq3VN0ztaNdIO/i8SEYMxGjX0aDXExkecjX2cJtd3Nc2ujMP7rJJpmhHn4lNEDkxTFsLoSbOe2bJhu8np2gajB4ahI4Tx1dSTk+CJo/R4bGDk6vaK9MtX1uuK778euJgtubhZoox7LXxO+IKXQj+FaL/h7s5ZbgOXj8J84+gUOH8SHcWfCJ96GA79KWrLzVxz/ai5XRiq/emMHqWfJ/R++hrCyKZ2/F4ZZgvDvBBWpaWop7T+XxMehIeahFO6+0yixMjIoKe7Hf5HGOLV2w/+zeNy/OU/mtk/BX4Zs48AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;Select compute engine&quot;
        src=&quot;/static/c3227d60b192cceb626ea7b6188cbaae/f058b/select-compute-engine.png&quot;
        srcset=&quot;/static/c3227d60b192cceb626ea7b6188cbaae/c26ae/select-compute-engine.png 158w,
/static/c3227d60b192cceb626ea7b6188cbaae/6bdcf/select-compute-engine.png 315w,
/static/c3227d60b192cceb626ea7b6188cbaae/f058b/select-compute-engine.png 630w,
/static/c3227d60b192cceb626ea7b6188cbaae/40601/select-compute-engine.png 945w,
/static/c3227d60b192cceb626ea7b6188cbaae/0940f/select-compute-engine.png 1154w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Then click the blue Enable button near the top.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1da901411d5f3a0db988d1494ba7ce93/8fc63/enable-compute-engine.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABYUlEQVQoz22PXU8UMRiF5/9f+he4MUsMqOAFGgxGWT6i0QsTNgq7AYYNs/NBt287bafdx8zMknhBk6enaXNOz5u9/rxi92TF3reGvVPN5EtDf7fzsWDnU8n7c2F/qjm80BxeysiF8OFSeHum2f2q2Z8Kb86EyVTIHss1D4+KRlli7IheE1oF0cKmZVwJ2LxA+u9t1KxshB5tAmI9ZVlTVjViLM4HWufx3g9qrcOnbrCPG3i/gZSIIdH6RBa8w7mWLgRCCOR5znw+5/b2Dq0FayzGWESELgWqmULPNDf+iVeLn7joOXro+KvT8EEWtkF9i157sxFBTIttx3YDzpOIrO8M7b2jDoaDxW+Ut5xWcC3bkZ8Nz6FFUZDf59R1jdYapdYopWieFCFEvv/6wfHJMWtgUjSYTeLo4B03139ebmjtOKIxZns2AyKG0CWWyyWL+QKJifNVQRs7rq5mrKpqCPwHI6YRCQJLTjkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;Enable compute engine&quot;
        src=&quot;/static/1da901411d5f3a0db988d1494ba7ce93/f058b/enable-compute-engine.png&quot;
        srcset=&quot;/static/1da901411d5f3a0db988d1494ba7ce93/c26ae/enable-compute-engine.png 158w,
/static/1da901411d5f3a0db988d1494ba7ce93/6bdcf/enable-compute-engine.png 315w,
/static/1da901411d5f3a0db988d1494ba7ce93/f058b/enable-compute-engine.png 630w,
/static/1da901411d5f3a0db988d1494ba7ce93/40601/enable-compute-engine.png 945w,
/static/1da901411d5f3a0db988d1494ba7ce93/78612/enable-compute-engine.png 1260w,
/static/1da901411d5f3a0db988d1494ba7ce93/8fc63/enable-compute-engine.png 2756w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;At this point you will likely be asked to setup billing (unless you have already setup billing with GCP before).
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/09b9c707bd14e49e9a5156f0237aabe6/c6162/enable-billing.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.405063291139236%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiUlEQVQoz22RS24TQRCGfTAuwAmQ2AErFmAh4kRCSTSW8fS8p1/zsCLFkwUniFiSLLiCJXtvL5KN7a1B+IumJyZCpKVPf1Wr9FdXdW8caryvMefDgDMv4NQTjPyUMDH4YY6IFEGiCWLd6YFYI+Kn+EDPGo2SOUYrqtJSVwXVI3VVPktVFpSldRhjsbbTlp5UijiOSdMUKRVJkri41SiKCMPoUUNXl2UZSmuqonTk6slMqtZQSlcshHDFs9mM+XzOYrFguVyyWq3+0uZ3d/d8v75mGIcInVOXBZm2RMpSFgW9PM8Zj8eMRiP3qs1mw3q9ZrvdstvteO78/HHDq7MBL7xPaJnRF4aXXzSqHdkY43agtWYymbDf7/8zaG9+7+HXny6/ub0l8n23Am0NyhaEsvNxI7fj+r5PEARMp1OapnG08VXTMLm45PLqGyKS9AenXNQ1R0nOaxFS1hUnx8e8efe2M1Tq349ozQ8NDur7AVmW43nnfOx/wCiFl0reizG2LBgOh3w+GjjDBwNayUTlEy4pAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;alt text&quot;
        title=&quot;Enable billing&quot;
        src=&quot;/static/09b9c707bd14e49e9a5156f0237aabe6/f058b/enable-billing.png&quot;
        srcset=&quot;/static/09b9c707bd14e49e9a5156f0237aabe6/c26ae/enable-billing.png 158w,
/static/09b9c707bd14e49e9a5156f0237aabe6/6bdcf/enable-billing.png 315w,
/static/09b9c707bd14e49e9a5156f0237aabe6/f058b/enable-billing.png 630w,
/static/09b9c707bd14e49e9a5156f0237aabe6/40601/enable-billing.png 945w,
/static/09b9c707bd14e49e9a5156f0237aabe6/78612/enable-billing.png 1260w,
/static/09b9c707bd14e49e9a5156f0237aabe6/c6162/enable-billing.png 2166w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You will be offered a free trial but you still have to enter a credit card to get it. You don’t really need the free trial for what we will be doing either but no harm setting it up.&lt;/p&gt;
&lt;h4&gt;Create a cluster in GCP&lt;/h4&gt;
&lt;p&gt;If you haven’t authorized gcloud already, do so now like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud auth login
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That should open a browser window where you can login to your google account.&lt;/p&gt;
&lt;p&gt;Now configure the project you created (PROJECT_ID should be replaced with the ID of your project):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud config &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; project PROJECT_ID
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Configure your desired zone like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud config &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; compute/zone europe-west1-d
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can list the available zones with this command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud compute zones list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Verify the configuration like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud config list core/project
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;core&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
project &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; kubernetes-practice-ruairi

Your active configuration is: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now create a cluster.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud container clusters create my-cool-cluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(probably pick a better cluster name)&lt;/p&gt;
&lt;p&gt;Verify it’s there.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
gcloud container clusters list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
NAME             ZONE           MASTER_VERSION  MASTER_IP       MACHINE_TYPE   NODE_VERSION  NUM_NODES  STATUS
my-cool-cluster  europe-west1-d &lt;span class=&quot;token number&quot;&gt;1.6&lt;/span&gt;.4           &lt;span class=&quot;token number&quot;&gt;130.211&lt;/span&gt;.181.72  n1-standard-1  &lt;span class=&quot;token number&quot;&gt;1.6&lt;/span&gt;.4         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;          RUNNING
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;minikube&lt;/h3&gt;
&lt;p&gt;Minikube basically lets you run kubernetes locally. Follow the instructions here to get it setup:
&lt;a href=&quot;https://github.com/kubernetes/minikube&quot;&gt;https://github.com/kubernetes/minikube&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;With minkube creating a clust is a little easier:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
minikube start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You also have the added advantage of not needing to setup a GCP account and all that but it’s only useful for developing stuff locally of course.&lt;/p&gt;
&lt;p&gt;To make sure kubectl is pointing at minikube try this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443
KubeDNS is running at https://192.168.99.100:8443/api/v1/proxy/namespaces/kube-system/services/kube-dns
kubernetes-dashboard is running at https://192.168.99.100:8443/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Switching contexts in kubectl&lt;/h3&gt;
&lt;p&gt;If you end up using both GCP and mimikube, it’s useful to easily switch contexts in kubectl&lt;/p&gt;
&lt;p&gt;These commands help:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl config get-contexts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl config use-context &lt;span class=&quot;token variable&quot;&gt;${context_name}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can also set the context in each call:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;some options here&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--context&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;minikube
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Deploy something&lt;/h3&gt;
&lt;p&gt;For this we can create a simple hello world application and put it in a container. Here’s one I made earlier: &lt;a href=&quot;https://hub.docker.com/r/ruairitobrien/hello-kubernetes-world/&quot;&gt;https://hub.docker.com/r/ruairitobrien/hello-kubernetes-world/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Note, these instructions should work the same whether you are using GCP or minikube.&lt;/p&gt;
&lt;p&gt;Code for that app is here but nothing interesting there really &lt;a href=&quot;https://github.com/ruarfff/hello-kubernetes-world&quot;&gt;https://github.com/ruarfff/hello-kubernetes-world&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl run hello-kubernetes &lt;span class=&quot;token parameter variable&quot;&gt;--image&lt;/span&gt; ruairitobrien/hello-kubernetes-world:latest
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should usually specify a version number so you have a history of deployed versions that you can switch to if needed but ‘:latest’ will do for this tutorial.&lt;/p&gt;
&lt;p&gt;You should see&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
deployment &lt;span class=&quot;token string&quot;&gt;&quot;hello-kubernetes&quot;&lt;/span&gt; created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Verify it worked&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
$ kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
hello-kubernetes   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;           1m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can also check the pod that was created:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
$ kubectl get pods
NAME                                READY     STATUS    RESTARTS   AGE
hello-kubernetes-3390701390-jds31   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          1m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pods are an important part of kubernetes but rather than me going on about them it’s best to read up here: &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/pods/pod/&quot;&gt;https://kubernetes.io/docs/concepts/workloads/pods/pod/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It’s also useful to check out the describe functions. Most things have them.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl describe deployment &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;deploymentName&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Example&lt;/span&gt;
kubectl describe deployment hello-kubernetes

kubectl describe pods &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;podName&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Example&lt;/span&gt;
kubectl describe pods hello-kubernetes-3390701390-jds31
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;You have a deployment&lt;/h3&gt;
&lt;p&gt;Now that you have a deployment, what are you going to do with it?&lt;/p&gt;
&lt;p&gt;I am just going to show a few simple things here to give you an idea of what’s available. Most of this and much more can be found [&lt;a href=&quot;https://kubernetes.io/docs/user-guide/kubectl-cheatsheet/%5D(in&quot;&gt;https://kubernetes.io/docs/user-guide/kubectl-cheatsheet/](in&lt;/a&gt; these docs).&lt;/p&gt;
&lt;p&gt;You will probably want to look at logs a bit. You can look at the logs for a pod with this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl logs &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;podName&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Example&lt;/span&gt;
kubectl logs hello-kubernetes-3390701390-jds31
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will give you the logs for this instance of that pod. You can go more in detail, for example in the case where you have a pod with multiple containers. More on that &lt;a href=&quot;https://kubernetes.io/docs/user-guide/kubectl/v1.6/#logs&quot;&gt;in the kubernetes docs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now let the world see your amazing app!&lt;/p&gt;
&lt;p&gt;First, run get services.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get services
NAME         CLUSTER-IP    EXTERNAL-IP   PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   AGE
kubernetes   &lt;span class=&quot;token number&quot;&gt;10.55&lt;/span&gt;.240.1   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;/TCP   1h
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see there is no external IP and no mention of the pod we created.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl expose deployment hello-kubernetes &lt;span class=&quot;token parameter variable&quot;&gt;--type&lt;/span&gt; LoadBalancer &lt;span class=&quot;token parameter variable&quot;&gt;--port&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt; --target-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we are using the load balancer option.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;LoadBalancer - Creates an external load balancer in the current cloud (if supported) and assigns a fixed, external IP to the Service. Superset of NodePort.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There are other types you can use.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Type for this service: ClusterIP, NodePort, or LoadBalancer. Default is ‘ClusterIP’.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We’re using LoadBalancer because it’s a nice option for us to play around with autoscaling soon.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--port&lt;/code&gt; is the port we are exposing our service on.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--target-port&lt;/code&gt; is the port our application in the Docker image happens to be exposed on.&lt;/p&gt;
&lt;p&gt;Wait a minute or so for things to work out and then run this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl describe svc hello-kubernetes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
Name:			hello-kubernetes
Namespace:		default
Labels:			&lt;span class=&quot;token assign-left variable&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hello-kubernetes
Annotations:		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Selector:		&lt;span class=&quot;token assign-left variable&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hello-kubernetes
Type:			LoadBalancer
IP:			&lt;span class=&quot;token number&quot;&gt;10.55&lt;/span&gt;.243.178
LoadBalancer Ingress:	&lt;span class=&quot;token number&quot;&gt;104.154&lt;/span&gt;.182.255
Port:			&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;unset&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/TCP
NodePort:		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;unset&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;31390&lt;/span&gt;/TCP
Endpoints:		&lt;span class=&quot;token number&quot;&gt;10.52&lt;/span&gt;.0.5:8000
Session Affinity:	None
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The ‘Endpoints’ value is the internal ip and port of your application running in the cluster.&lt;/p&gt;
&lt;p&gt;This value: LoadBalancer Ingress: 104.154.182.255 is what we can use to talk to our application externally. Stick the ip address that you see there in your browser and you should see ‘hello kubernetes world’ or whatever you have your application sending back if you wrote your own there.&lt;/p&gt;
&lt;h3&gt;Autoscaling&lt;/h3&gt;
&lt;p&gt;This for me was the first really cool thing I came across when playing around with kubernetes. Now our application is deployed, we can attach an autoscaler to it. Here is a command we can use to do that.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl autoscale deployment hello-kubernetes --cpu-percent&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--min&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--max&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we have attached an autoscaler.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--cpu-percent&lt;/code&gt; will try to average the utilization across all the pods to the percent we set i.e. will scale up until it hits the max amount of pods if cpu utilization goes above 10% on average across all existing pods. We set 1% for demonstration purposes so we have a chance of forcing the cluster to scale up when hitting it from our machine.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--min&lt;/code&gt; is the minimum amount of pods we want in the cluster.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--max&lt;/code&gt; is the maximum amount of pods we will allow the autoscaler to provision for us.&lt;/p&gt;
&lt;p&gt;The autoscaler will scale up when cpu is above 10% on average. It will also scale down to the minimum when cpu utilisation is below average.&lt;/p&gt;
&lt;p&gt;Try running this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl describe svc hello-kubernetes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
Name:			hello-kubernetes
Namespace:		default
Labels:			&lt;span class=&quot;token assign-left variable&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hello-kubernetes
Annotations:		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Selector:		&lt;span class=&quot;token assign-left variable&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hello-kubernetes
Type:			LoadBalancer
IP:			&lt;span class=&quot;token number&quot;&gt;10.55&lt;/span&gt;.245.180
LoadBalancer Ingress:	&lt;span class=&quot;token number&quot;&gt;104.198&lt;/span&gt;.145.117
Port:			&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;unset&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/TCP
NodePort:		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;unset&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;32063&lt;/span&gt;/TCP
Endpoints:		&lt;span class=&quot;token number&quot;&gt;10.52&lt;/span&gt;.0.5:8000,10.52.2.6:8000,10.52.2.7:8000,10.52.2.8:8000
Session Affinity:	None
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice we now have 4 endpoints. You could see this with &lt;code class=&quot;language-text&quot;&gt;kubectl get pods&lt;/code&gt; too. The autoscaler has already scaled up to meet the minimum requirements we set.&lt;/p&gt;
&lt;p&gt;To see the state of the autoscaler run this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get hpa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
NAME               REFERENCE                     TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
hello-kubernetes   Deployment/hello-kubernetes   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;% / &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;%   &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;          1m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And just to confirm the number of pods is 4.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get pods
NAME                                READY     STATUS    RESTARTS   AGE
hello-kubernetes-3390701390-jds31   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          3m
hello-kubernetes-3390701390-q1v74   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          3m
hello-kubernetes-3390701390-txg9z   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          3m
hello-kubernetes-3390701390-w6kjg   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          47m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now the fun part. Let’s see autoscaling in action!&lt;/p&gt;
&lt;p&gt;You probably have a better way of doing this (please comment with a suggestion) but what I did here was just run this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XGET&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${IP}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# So for my cluster in the above examples that was&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XGET&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;104.198&lt;/span&gt;.145.117 &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or something a little safer perhaps.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token for-or-select variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XGET&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${IP}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you go down the safe route with a limited loop, the timing where you check the following things is important.&lt;/p&gt;
&lt;p&gt;After a while you should start to see autoscaling kicking in:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get hpa
NAME               REFERENCE                     TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
hello-kubernetes   Deployment/hello-kubernetes   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;% / &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;%   &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;          4m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see the ‘TARGETS’ ratio (that’s the CPU utilisation) is grown above that which we specified. In my example it’s 3% but the autoscaler wants it to be below 1% on average so it should start scaling up to bring that back in balance.&lt;/p&gt;
&lt;p&gt;Check the new pods getting created.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get pods
NAME                                READY     STATUS    RESTARTS   AGE
hello-kubernetes-3390701390-1ght4   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          39s
hello-kubernetes-3390701390-2gp0c   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          39s
hello-kubernetes-3390701390-ddgv0   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          39s
hello-kubernetes-3390701390-jds31   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          4m
hello-kubernetes-3390701390-q1v74   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          4m
hello-kubernetes-3390701390-t6s63   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          39s
hello-kubernetes-3390701390-txg9z   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          4m
hello-kubernetes-3390701390-w6kjg   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          48m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Don’t forget to while loop! Unless you used the for loop of course.&lt;/p&gt;
&lt;p&gt;After a minute or 2 check again.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get hpa
NAME               REFERENCE                     TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
hello-kubernetes   Deployment/hello-kubernetes   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;% / &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;%   &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;          8m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See the pods are terminating.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;
kubectl get pods
NAME                                READY     STATUS        RESTARTS   AGE
hello-kubernetes-3390701390-1ght4   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Terminating   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          5m
hello-kubernetes-3390701390-2gp0c   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Terminating   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          5m
hello-kubernetes-3390701390-ddgv0   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Terminating   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          5m
hello-kubernetes-3390701390-jds31   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          9m
hello-kubernetes-3390701390-q1v74   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          9m
hello-kubernetes-3390701390-t6s63   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Terminating   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          5m
hello-kubernetes-3390701390-txg9z   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          9m
hello-kubernetes-3390701390-w6kjg   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1       Running       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          53m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;They may already be gone depending how long you waited to check.&lt;/p&gt;
&lt;p&gt;Maybe I am too easily impressed but I just think that is cool! Anyway, that was a brief run through of some of the basic Kubernetes features and barely scratches the surface of what is there.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Start Game Coding in ES6]]></title><description><![CDATA[TL;DR If you want to try my solution to developing with phaser 2 and es6, try this yeoman generator. What? A while back I discovered a HTML…]]></description><link>https://ruarfff.com/firing-phasers/</link><guid isPermaLink="false">https://ruarfff.com/firing-phasers/</guid><pubDate>Thu, 10 Nov 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; If you want to try my solution to developing with &lt;a href=&quot;http://phaser.io/&quot;&gt;phaser 2&lt;/a&gt; and es6, try &lt;a href=&quot;https://www.npmjs.com/package/generator-fire-phaser&quot;&gt;this yeoman generator&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;What?&lt;/h3&gt;
&lt;p&gt;A while back I discovered a HTML5 game development framework called &lt;a href=&quot;http://phaser.io/&quot;&gt;phaser&lt;/a&gt;. It is really cool and a lot of fun to work with. This post is about how I set up a good and simple development environment to work with Phaser 2 and es6. If you’re interested in getting started with phaser or have just been looking for a good way to use it with es6 then you might find some of the details below useful.&lt;/p&gt;
&lt;p&gt;If by some amazing coincidence you happen to be struggling with getting a JavaScript library that relies on globals to work with some es6 build process, this post may also be of use to you.&lt;/p&gt;
&lt;h3&gt;Why?&lt;/h3&gt;
&lt;p&gt;When I first became a programmer all I wanted to do was make games. In my opinion games are the most fun thing to code. They are also a huge amount of work which is probably why I have yet to fully complete one beyond some basic efforts.&lt;/p&gt;
&lt;p&gt;I have half built games with XNA, C++, even… Java. Phaser is the best thing I have come across yet. Despite my love of coding games I just can’t put in all the effort required to make a fancy 3D thing so I love the quick and simple 2D games I can make with phaser. I even had my 7 year old son coding a little on a game and he loves seeing changes like making a character run faster or jump higher. If you want to get started making simple games I can’t recommend phaser enough.&lt;/p&gt;
&lt;p&gt;Anyway, since this is JavaScript I immediately hit a problem starting new game projects beyond a simple tutorial and this blog post is about how I got a workflow going that I like and that I wanted to share.&lt;/p&gt;
&lt;p&gt;Besides using phaser I did not want to complicate things by adding any other frameworks and I did not want a complicated build process. I just want to make a game and keep things as simple and fun as possible. I really want to use full blown es6 with modules though and that presented a small challenge. Phaser 2 has been around for some time and was not designed to work with es6. Soon phaser 3 will come out and this post will be obsolete but until then, here’s how I got a a nice setup for phaser 2 and es6.&lt;/p&gt;
&lt;h3&gt;How?&lt;/h3&gt;
&lt;p&gt;The first thing I tried to do was use &lt;a href=&quot;https://babeljs.io/&quot;&gt;babel&lt;/a&gt; and &lt;a href=&quot;http://browserify.org/&quot;&gt;browserify&lt;/a&gt; on the command line. I have used npm to install phaser and I had a simple JavaScript file that has an &lt;code class=&quot;language-text&quot;&gt;import Phaser from &apos;phaser&apos;&lt;/code&gt; statement at the top. It didn’t start well. I was getting an error saying PIXI was not defined. After digging around the phaser source for a while I realized that the built phaser file assigned some dependencies on the global scope. I noticed that the &lt;a href=&quot;https://www.npmjs.com/package/phaser&quot;&gt;phaser node module&lt;/a&gt; had those dependencies separated into their own files too. It occurred to me that I would probably need to use webpack now.&lt;/p&gt;
&lt;p&gt;I always end up having to use webpack these days. Even though it’s a great tool, I always try not to use it because it just seems to add a bunch of complexity. Doesn’t seem to be any good way around it here though and I think the config I use is simple enough to be OK.&lt;/p&gt;
&lt;p&gt;I had come across the webpack &lt;a href=&quot;https://github.com/webpack/expose-loader&quot;&gt;expose-loader&lt;/a&gt; module before and it appears to solve the particular issue of using a library that relies on globals. I did pause to wonder if it was worth the effort now just so I would use &lt;code class=&quot;language-text&quot;&gt;import Phase from &apos;phaser&apos;&lt;/code&gt; instead of &lt;code class=&quot;language-text&quot;&gt;Phaser&lt;/code&gt; as a global and decided it was.&lt;/p&gt;
&lt;p&gt;The module loaders are configured like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; pixiiJs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pixi.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; p2Js &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;p2.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token literal-property property&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token regex-source language-regex&quot;&gt;\.css$&lt;/span&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;style-loader!css-loader&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token regex-source language-regex&quot;&gt;\.js$&lt;/span&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;exclude&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token regex-source language-regex&quot;&gt;node_modules&lt;/span&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;babel-loader&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token regex-source language-regex&quot;&gt;\.json$&lt;/span&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;json&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RegExp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pixiiJs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;expose?PIXI&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RegExp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p2Js&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;expose?p2&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;{ test: /\.css$/, loader: &apos;style-loader!css-loader&apos; }&lt;/code&gt; Allows importing of css files in scripts at build time using &lt;a href=&quot;https://github.com/webpack/css-loader&quot;&gt;css-loader&lt;/a&gt;. Totally optional. I just like that way of getting css in to the page.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;{ test: /\.js$/, exclude: /node_modules/, loader: &quot;babel-loader&quot; }&lt;/code&gt; This converts our es6 code to es5 for browser support.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;{ test: /\.json$/, loader: &apos;json&apos; }&lt;/code&gt; For importing JSON files to scripts at build time.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;{ test: new RegExp(pixiiJs), loader: &apos;expose?PIXI&apos; }&lt;/code&gt; This will assign PIXI to the global object when it gets imported in our es6 code. We do need to have &lt;code class=&quot;language-text&quot;&gt;import &apos;pixi&apos;&lt;/code&gt; in the entry point of our code. We do not need to use the global object in our code but it is there for phaser to use.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;{ test: new RegExp(p2Js), loader: &apos;expose?p2&apos; }&lt;/code&gt; Same as with PIXI, we are putting this on the global object for phaser to use. We also need &lt;code class=&quot;language-text&quot;&gt;import &apos;p2&apos;&lt;/code&gt; in the entry point of our code.&lt;/p&gt;
&lt;p&gt;That was pretty much the only tricky part.&lt;/p&gt;
&lt;p&gt;I am going to be working on a few games in parallel and will probably never finish any of them, so to help with that I created a yeoman generator that will generate a project with a webpack configuration and some sample phaser code written in es6.&lt;/p&gt;
&lt;p&gt;If you would like to use it or just want to see what I needed to do to get it all set up run this command (assuming you have nodejs installed)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm i -g yo generator-fire-phaser&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or for yarn (assuming you also installed yeoman globally with yarn)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;yarn global add generator-fire-phaser&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then in an empty directory run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;yo fire-phaser&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You’ll be prompted to answer a few questions that will be used to name the project and set some text in it.&lt;/p&gt;
&lt;p&gt;The reference code in there might be handy for seeing how to structure ES6 code with phaser too.&lt;/p&gt;
&lt;p&gt;The Github repo for the generator is &lt;a href=&quot;https://github.com/ruarfff/generator-fire-phaser&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Hope you make some games!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[About Communication]]></title><description><![CDATA[Over the years I have found that the debate about code standards in all programming languages is really never ending and that is probably a…]]></description><link>https://ruarfff.com/communication/</link><guid isPermaLink="false">https://ruarfff.com/communication/</guid><pubDate>Wed, 23 Mar 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Over the years I have found that the debate about code standards in all programming languages is really never ending and that is probably a good thing. However the many solutions I have come across for enforcing code quality don’t always lend themselves to helping developers produce better code. Why is that and why is it such a contentious issue?&lt;/p&gt;
&lt;h2&gt;Code Is Communication&lt;/h2&gt;
&lt;p&gt;I was in my &lt;a href=&quot;https://www.facebook.com/Alchemy-Coffee-and-Books-375457815953898&quot;&gt;favorite coffee shop&lt;/a&gt; the other day writing some code on my laptop when my mind began to drift and I started hearing the conversations going on around me. I wasn’t intentionally listening in (OK, I was a bit). I was mostly just feeling the ebb and flow of the conversations. I started to notice just how much people talk. People put a lot of energy in to their conversations, even when all they’re are talking about is the weather (which is most people, most of the time, in Ireland). If you think about it a certain way, it’s all a bit strange. Communication really is a very complex and very interesting thing.&lt;/p&gt;
&lt;p&gt;Talking is just one form of communication but a fascinating one. It invokes a wide range of feelings in us and we mostly just enjoy doing it. Writing is in a similar category. It’s a form of communication and an incredibly powerful one. Carl Sagan once said about books&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;One glance at it and you’re inside the mind of another person, maybe somebody dead for thousands of years. Across the millennia, an author is speaking clearly and silently inside your head, directly to you. Writing is perhaps the greatest of human inventions, binding together people who never knew each other, citizens of distant epochs. Books break the shackles of time. A book is proof that humans are capable of working magic.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Speaking, writing and any other form of communication are also skills that people develop. Being a great speaker or writer is a prized skill and one that can be learned and refined.&lt;/p&gt;
&lt;p&gt;Speaking and writing can also be considered art in the right context. Is art also communication? When you look at a painting or listen to a song, what is the purpose of that? What makes a piece of art good? I think a large part of it is the artist’s ability to communicate. This seems to be true in the spoken and written arts and I think it’s also true in many other art forms. The ability to clearly transmit some emotions and contents of your mind in to the minds of other human beings.&lt;/p&gt;
&lt;p&gt;Does this apply to software at all? Do you consider a program’s source code a form of communication?&lt;/p&gt;
&lt;p&gt;It is possible, even helpful, when writing code to imagine you are communicating with somebody as you write it. Admittedly it’s most often yourself some time in the future but in many cases it will be other people, even people that you may never know. As you write code you want what you have written to be easy to understand and even in some way aesthetically pleasing.&lt;/p&gt;
&lt;p&gt;It can be said code is just a way to communicate with machines. That is not entirely true anymore. If you were to communicate directly with a machine you would be doing things completely alien to most contemporary programmers. The code we write is designed to be written, read and maintained by humans. Of course a programmer having a deep understanding of the technical aspects is still important. It is just becoming true that writing difficult to read code to suit the compiler or machine is becoming much less important as compilers/interpreters adapt to optimize for things that suit humans better than them.&lt;/p&gt;
&lt;h2&gt;Keeping Code Communicating&lt;/h2&gt;
&lt;p&gt;As we write more and more code, we start to develop our own preferences about how it should look. We are influenced by code we read, styles we see in books or style guides we come across. Whether it’s open source, a startup or in enterprise, the issue of code style is something you will inevitably encounter over and over. How much time is taken up by this? What are the methods you have seen to deal with this issue? Here we will go over some that you will likely have encountered or you likely will if you haven’t yet and you work as a programmer.&lt;/p&gt;
&lt;h4&gt;The Coding Standards/Conventions Document&lt;/h4&gt;
&lt;p&gt;Coding standard documents are well intentioned. Sometimes, so much effort goes into them that they almost become sacred texts and we know how humans can get about sacred texts. I know the alternative of having nothing to keep code style consistent is much worse but a document that all developers must read and remember to adhere to is not something that should be considered an acceptable solution either.&lt;/p&gt;
&lt;p&gt;One of the first documents of this nature I ever saw was the &lt;a href=&quot;http://www.oracle.com/technetwork/java/codeconventions-150003.pdf&quot;&gt;Java one&lt;/a&gt; which is nearly 20 years old now. It’s a whopper at 24 pages. Some fun light reading that must have brought a lot of pleasure to the life of many a developer.&lt;/p&gt;
&lt;p&gt;There’s also the fairly hilarious &lt;a href=&quot;https://www.kernel.org/doc/Documentation/CodingStyle&quot;&gt;Linux Kernel Coding Style Doc&lt;/a&gt;. This at least is funny. There’s some good advise at the start too.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;First off, I’d suggest printing out a copy of the GNU coding standards,
and NOT read it. Burn them, it’s a great symbolic gesture.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The GNU standards are tough going and a bit mad (in my humble opinion). Feel free to look &lt;a href=&quot;https://www.gnu.org/prep/standards/standards.html&quot;&gt;here&lt;/a&gt; and decide that for yourself though.&lt;/p&gt;
&lt;p&gt;Google have theirs too such as their &lt;a href=&quot;https://google.github.io/styleguide/javaguide.html&quot;&gt;Java Guide&lt;/a&gt;. It’s not too massive at least. They do make a good point at the start:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Like other programming style guides, the issues covered span not only aesthetic issues of formatting, but other types of conventions or coding standards as well. However, this document focuses primarily on the hard-and-fast rules that we follow universally, and avoids giving advice that isn’t clearly enforceable (whether by human or tool).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The document should be enforceable by a tool. That’s very important.&lt;/p&gt;
&lt;p&gt;I’ll focus on Java a bit here but these points cover a lot of languages indirectly. A particular pain point for me is Javadocs. A code convention that keeps cropping up over and over is the requirement to Javadoc everything. Even private methods! This happens. This is a very bad code convention for a number of reasons.&lt;/p&gt;
&lt;p&gt;It’s worth exploring the reason a convention like this might exist first. If you are building a library, Javadocs are very handy of course. It’s great to have documentation generated in HTML and available to users of your library. Particularly if you consider that they may not even have access to the source code. This is obviously much better than crafting the documents by hand and a convention for Javadocs on public and protected fields makes perfect sense then. No objections there.&lt;/p&gt;
&lt;p&gt;What if you’re not building a library though as is probably the case most of the time? What if your code is in your application, constantly changing and being released. Not an artifact that gets released occasionally with documentation for a specific version but something being worked on daily by many people who only want to read the code. Do these conventions make sense then? Does a convention to Javadoc private methods ever make sense?&lt;/p&gt;
&lt;p&gt;If you go back to the purpose of a convention like this, it should be obvious that having this for all your code is a misinterpretation of the original intention of Javadocs which is really about generating documentation for people who don’t need to read how your code is implemented.&lt;/p&gt;
&lt;p&gt;Application code should be easy to read and change. It should be self documenting where possible, friendly to an editor and friendly to human eyes. An application in the majority of cases is not an artifact that needs generated code documentation. The code is what matters. Comments are not code. If you change a comment it will not affect how the application runs. The code is always the truest representation of what a program does. If a developer never reads a single comment they may still understand how a program works.&lt;/p&gt;
&lt;p&gt;If code is a form of communication what are comments in relation to it? If a painting is a form of communication, does a painter need to provide notes to go with the painting to help us understand it? If that was the case wouldn’t that be a pretty bad painting? OK, that’s probably an terrible metaphor. The point though is the description is not the painting or what I really mean, comments are not the code and may even just confuse the reader about the code. Perhaps the worst use of comments is when they are used to gloss over shortcomings in how the code reads.&lt;/p&gt;
&lt;p&gt;Code should only in the rarest of cases need comments to be understood. This was not always true and is certainly not true for all languages but for most languages that we use today this is the case. They are designed to be human readable. You can document your code by a good folder structure with good file names and good class name and good function and variable names etc. The ultimate documentation for any code is it’s tests. &lt;a href=&quot;https://en.wikipedia.org/wiki/Test-driven_development&quot;&gt;TDD&lt;/a&gt; is one of the best ways to write clean code and is also one of the best ways to document it.&lt;/p&gt;
&lt;p&gt;Back to the coding standards document. I am not trying to say they shouldn’t exist and all conventions are bad. The comments issue I mentioned above is a symptom of an abidance of such a document being the rule that is just a bit too difficult to question and change. We should codify coding standards of course but they should be concise, easy to change and easy to understand. More importantly even than being understandable to developers, the document should be easily consumed by static code analysis tools.&lt;/p&gt;
&lt;p&gt;Ideally a coding standard document would be in source control and could be updated and checked in after going through a review process. Once checked in the current document could be used for code analysis and to automatically block merges or however you see fit to use it. Something like &lt;a href=&quot;http://www.sonarqube.org&quot;&gt;SonarQube&lt;/a&gt; can be configured like this.&lt;/p&gt;
&lt;p&gt;Having the coding standard stored and distributed as static document like a PDF for people to study and having it maintained by a small number of people who put a lot of effort and themselves in to it is a recipe for trouble. Wikis are a bit better but still, can be trouble to change. The dynamic of a pull request is better for change than what most Wikis provide. Making it part of the development tool suite that tests it all the time will help ensure that if real problems exist with it, they are more likely to be addressed quickly. Much like a bug in code.&lt;/p&gt;
&lt;p&gt;There are a lot of tools that support this type of thing out there. A lot of teams use them already. If you already use a static code analysis tool but also have a coding standard document, it could be time well spent seeing how much of that document could be automated away to your .jshintrc, HLint.hs, lint.xml or whatever you use. Or use something as part of the CI process such as &lt;a href=&quot;http://www.sonarqube.org&quot;&gt;SonarQube&lt;/a&gt; as I mentioned before. For things like conventions around indentation etc. consider something like &lt;a href=&quot;http://editorconfig.org/&quot;&gt;EditorConfig&lt;/a&gt;. Almost every editor and IDE supports it. Much better than passing around IDE specific code formatting documents. The editor config file should be stored with the source code where it belongs although you may prefer to have a centralized one that gets pulled in somehow.&lt;/p&gt;
&lt;p&gt;It’s worth differentiating between a standards document and a style guide too. Style guides are a nice way to share good patterns. One great example is John Papa’s &lt;a href=&quot;https://github.com/johnpapa/angular-styleguide&quot;&gt;Angular Style Guide&lt;/a&gt;. It’s a great resource for learning sensible patterns for writing code using that particular framework. It’s not about a language style but about patterns for a particular context and these are nice to have.&lt;/p&gt;
&lt;h4&gt;The Code Review&lt;/h4&gt;
&lt;p&gt;The code review is a blessing and a curse. The benefits are that other people will see any code that will be checked in and ideally the code will be well critiqued and understood by at least one other person before being merged. This should lead to better code quality over all. If you’re lucky you’ll get in to some really interesting discussions and fun arguments and these are very constructive generally.&lt;/p&gt;
&lt;p&gt;Code reviews are important but they don’t always work as we as we would like. One of the biggest issues I have seen is that pull requests for review are often too large. Nobody wants to read them. I won’t go in to this too much as it’s well known and really an issue of personal discipline for developers. If there is a feasible way to automate handling such pull request I haven’t seen it. This is just something people have to work through in their teams and only the team can decide how best to do that. The basic rule of thumb is keep pull requests as small as possible though.&lt;/p&gt;
&lt;p&gt;Kent Beck recently gave an interview at the &lt;a href=&quot;https://hacksummit.org/&quot;&gt;HackSummit&lt;/a&gt; which centered a lot around how he’s finding working at Facebook. You can see the recording &lt;a href=&quot;https://www.crowdcast.io/e/hacksummit-2016/12&quot;&gt;here&lt;/a&gt;. He mentioned that he had the opportunity to gather real data on subjects that he could only have an opinion on before based on his own knowledge and experience. One very interesting observation he had was that the optimal number of reviewers for a code review is &lt;strong&gt;one&lt;/strong&gt;. If you only have one reviewer then that person has a lot of responsibility to ensure the code is good. A large number of reviewers appears to lead to some issues. You can get some variation of the &lt;a href=&quot;https://en.wikipedia.org/wiki/Bystander_effect&quot;&gt;bystander effect&lt;/a&gt; or perhaps more accurately a &lt;a href=&quot;https://en.wikipedia.org/wiki/Diffusion_of_responsibility&quot;&gt;diffusion of responsibility&lt;/a&gt;. If the code is difficult to understand, many people will assume it might just be out of their domain and someone else will understand and review it. If one or two people approve then others may well just approve assuming it’s all OK.&lt;/p&gt;
&lt;p&gt;Another big issue with pull requests and code reviews is Coding Standards Pollution. For example, a new developer comes along, hasn’t really read the coding standards properly, opens a pull request and then hits a saturation of comments about coding standard violations. Anybody coming late to the party may not easily see what the PR was about any more and is hesitant to add any more comments. Maybe nobody even knows what the code does but it just looks like it got heavily reviewed because of all the comments which in fact don’t address the real workings of the code at all. All we see are piles of comments like ‘missing Javadoc’, ‘wrong indentation’ and many more. I’m sure you can think of a few to add to that list straight away. Eventually the developer fixes all those and gets an approval for fixing the issues commented on and merges. What are the chances the actual code ever really got reviewed? At least the developer got a good lesson on the coding standards I guess.&lt;/p&gt;
&lt;p&gt;Obviously the answer there is to automate all that away with code analysis. In the ideal circumstances no code review should ever contain a comment about coding standards. All the discussion should be about how well written the code is, how well it communicates what it is supposed to do. If your code is good enough and the tests are extensive enough, nobody should even have to ask what the code does. If they do then it might be a sign that the code could be improved. Focusing on code quality over adherence to standards is a much better use of time in a code review.&lt;/p&gt;
&lt;h4&gt;Pair programming&lt;/h4&gt;
&lt;p&gt;Pair programming is a great way to come to quick agreement on code style and standards. Mob programming is another similar method that’s worth looking into too. Programming is a very human endeavor. Pair programming is a natural thing to do. If two people can come to a consensus on a piece of code then it’s probably OK. If more than two can all agree it’s good, that’s a beautiful thing.&lt;/p&gt;
&lt;p&gt;Pair programming seems to be a good answer to some of the problems mentioned in the Code Review section above and is even touted by some as a way to avoid code reviews altogether, allowing faster code integration. I would say that in most places a code review still makes sense even if pair programming is being practiced but if you find code reviews aren’t working as you hoped they would or code quality is a big issue, perhaps give pair programming a shot.&lt;/p&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;I made the comment that programming is a very human endeavor. This may not always be the case. Maybe AIs will be replacing all us human coders at some stage but for now at least, coding is still primarily done by humans. Trying to force that act of coding to be a regulated clinical act won’t pay off (unless you’re trying to build that AI to replace us all). We get better at coding by constantly challenging ourselves and really caring about the code we produce. Not by memorizing and strictly following a large set of rules.&lt;/p&gt;
&lt;p&gt;I genuinely believe it’s a similar thing to so many creative disciplines. Take writing again as an example. I write code in a similar way to how I might write some text, like this blog post. In small units, one or two sentences or a few lines of code:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Think about what needs to be communicated&lt;/li&gt;
&lt;li&gt;Write something out&lt;/li&gt;
&lt;li&gt;Ensure it fulfills whatever criteria was set out initially&lt;/li&gt;
&lt;li&gt;Refactor&lt;/li&gt;
&lt;li&gt;Ensure it still fulfills whatever criteria was set out initially&lt;/li&gt;
&lt;li&gt;Repeat&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Our code is the artifact, the text, the painting, the thing that might be there long after we are (bit melodramatic I know). We should always be focusing on creating the best code. Whatever it takes. Not through standards and regulations but through always asking does the code communicate well enough. Does it look good? Can you quickly understand what this does by reading it?&lt;/p&gt;
&lt;p&gt;Every programmer will spend &lt;a href=&quot;http://stackoverflow.com/questions/3455488/code-is-read-more-than-it-is-written&quot;&gt;more time reading code than writing it&lt;/a&gt;. We should always be able to read it easily or we will be wasting a lot of time. Next time you’re doing a review and you see a block of code you don’t understand, how will you react? Will you ignore it? Will you say ‘please add a comment explaining what this code does’? How about asking is there any way this code can be written that will make it easier to understand?&lt;/p&gt;
&lt;p&gt;When you’re writing code, you are not only programming a computer. You are most likely also communicating with another human mind that might never get to ask you anything about what you’ve done.&lt;/p&gt;
&lt;h3&gt;Some Links&lt;/h3&gt;
&lt;p&gt;This post is a bit of a rant about some things that have been on my mind but I attempted to also research some of the points and here are some sources I used.&lt;/p&gt;
&lt;p&gt;From one of my favorite blogs &lt;a href=&quot;http://blog.codinghorror.com/&quot;&gt;Coding Horror&lt;/a&gt; by &lt;a href=&quot;https://en.wikipedia.org/wiki/Jeff_Atwood&quot;&gt;Jeff Atwood&lt;/a&gt; there’s &lt;a href=&quot;http://blog.codinghorror.com/coding-without-comments&quot;&gt;this post&lt;/a&gt;.
It’s a great read and does contradict some of what I said here but it’s a similar subject and well worth looking at if you’re interested in it. Another good thread on the subject &lt;a href=&quot;https://www.quora.com/Are-comments-in-code-a-good-or-bad-thing&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Another one by Jeff Atwood &lt;a href=&quot;http://blog.codinghorror.com/pair-programming-vs-code-reviews/&quot;&gt;here&lt;/a&gt; on pair programming vs code reviews.&lt;/p&gt;
&lt;p&gt;An interesting stack exchange question here which briefly discusses coding standards documents &lt;a href=&quot;https://programmers.stackexchange.com/questions/196706/creating-a-coding-standards-document&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JavaScript Singleton]]></title><description><![CDATA[If you are new to JavaScript but have learned to program in Java, C++, C# or some other C based object orientated language then you might…]]></description><link>https://ruarfff.com/javascript-singleton/</link><guid isPermaLink="false">https://ruarfff.com/javascript-singleton/</guid><pubDate>Fri, 17 Feb 2012 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If you are new to JavaScript but have learned to program in Java, C++, C# or some other C based object orientated language then you might think JavaScript is a bit weird. I straight away found myself wondering why I can’t make a class. The whole variable scope thing got to me a bit too but eventually I found that these are minor issues with many methods to overcome them. Also nowadays you can just use something like CoffeeScript which compiles to JavaScript but offers better syntax and stuff like classes.&lt;/p&gt;
&lt;p&gt;That said, you will probably just end up coding in JavaScript most of the time, if you’re doing web development. Here I am going to give an example of how I usually create a JavaScript singleton.&lt;/p&gt;
&lt;p&gt;If you’re thinking – what is a singleton? – checkout this &lt;a href=&quot;http://wiki.c2.com/?SingletonPattern&quot;&gt;great wiki page on the singleton pattern&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Also if you haven’t already heard of &lt;a href=&quot;https://jsfiddle.net/&quot;&gt;JS Fiddle&lt;/a&gt;, it is a great tool to practice JavaScript code that you could use to follow along here.&lt;/p&gt;
&lt;p&gt;Basically – in my opinion – the easiest way to implement a JavaScript Singleton is to use the module pattern with a self calling function. If you are attempting to organize your JavaScript code or make it look more like other class based languages you will generally end up using some variation of either the module or prototype pattern.&lt;/p&gt;
&lt;p&gt;The module pattern looks a bit better than the prototype pattern with less typing involved. The prototype pattern is part of, and supported by, standard JavaScript as well as being more efficient in memory usage but that is a subject for another post.&lt;/p&gt;
&lt;p&gt;To implement a singleton pattern in JavaScript it is easier to just use the module pattern.&lt;/p&gt;
&lt;p&gt;Here is a quick example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; singleton &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; hello &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello&quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; howMany &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;There can be only one&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; hello&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;sayHowManyOfMeExist&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; howMany&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;singleton&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hello&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
singleton&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sayHowManyOfMeExist&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will give 2 alerts, the first saying hello, the second saying there can be only one.&lt;/p&gt;
&lt;p&gt;It’s worth noting the hello variable is private so something like this would not work:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; singleton &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; hello &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;singleton&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hello&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Also if you go doing something crazy like&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;you will end with an ‘object is not a function’ error.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Java Singleton]]></title><description><![CDATA[As the name suggests, a singleton is used when you want exactly one of something in you program. I remember in the early days of college a…]]></description><link>https://ruarfff.com/java-singleton/</link><guid isPermaLink="false">https://ruarfff.com/java-singleton/</guid><pubDate>Wed, 01 Feb 2012 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;As the name suggests, a singleton is used when you want exactly one of something in you program.&lt;/p&gt;
&lt;p&gt;I remember in the early days of college a lot of people had trouble grasping the concept of the static keyword in Java. I did too at first but then I figured out it basically meant you only want to have one of this thing.&lt;/p&gt;
&lt;p&gt;I got in to making games and ended up using the singleton pattern a lot. I did most of my Java programming on Android in college so using things that cost a little less memory became important.&lt;/p&gt;
&lt;p&gt;There is a lot of stuff on the internet about the singleton pattern written by people way more knowledgeable than me so I wont go in to it here.&lt;/p&gt;
&lt;p&gt;I will go in to how I implement a singleton in Java in my day to day work. I did a bit of research and came up with a template I was happy with. Here I am just providing this template that you can copy and past or make a file template with, depending on your choice of IDE.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// This is just something I find useful for logging&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TAG&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSimpleName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// This is private so unscrupulous people can&apos;t go newing it&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// This is useful if you need to expose non-static methods&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// You can do MySingleton.getInstance().myNonStaticMethod();&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton_Holder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CloneNotSupportedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CloneNotSupportedException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TAG&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot; is a singleton! It can&apos;t be cloned.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;/**
    * MySingleton_Holder is loaded on the first execution of MySingleton.getInstance() or
    * the first access to MySingleton_Holder.INSTANCE, not before.
    */&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton_Holder&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>