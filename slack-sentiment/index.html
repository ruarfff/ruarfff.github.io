<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.331c385503a9a8984a99.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}


/*! modern-normalize v1.0.0 | MIT License | https://github.com/sindresorhus/modern-normalize */:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}table{text-indent:0;border-color:inherit}[type=button],button{-webkit-appearance:button}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af}input::placeholder,textarea::placeholder{color:#9ca3af}button{cursor:pointer}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.flex{display:flex}.table{display:table}.fixed{position:fixed}*{--tw-shadow:0 0 transparent;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 transparent;--tw-ring-shadow:0 0 transparent}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{line-height:var(--lineHeight-normal);font-size:var(--fontSize-root);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-body);font-size:var(--fontSize-1);color:var(--color-text)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);height:1px;border:0}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);margin-top:var(--spacing-12);margin-bottom:var(--spacing-6);line-height:var(--lineHeight-tight);letter-spacing:-.025em}h2,h3,h4,h5,h6{font-weight:var(--fontWeight-bold);color:var(--color-heading)}h1{font-weight:var(--fontWeight-black);font-size:var(--fontSize-6);color:var(--color-heading-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{line-height:var(--lineHeight-relaxed);--baseline-multiplier:0.179;--x-height-multiplier:0.35;margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{margin-left:var(--spacing-0);margin-right:var(--spacing-0);margin-bottom:var(--spacing-8);list-style-position:outside;list-style-image:none}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{color:var(--color-text-light);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6);border-left:var(--spacing-1) solid var(--color-primary);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{width:100%;margin-bottom:var(--spacing-8);border-collapse:collapse;border-spacing:.25rem}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{font-size:var(--fontSize-4);color:var(--color-primary);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-weight:var(--fontWeight-bold);font-family:var(--font-heading);text-decoration:none;font-size:var(--fontSize-2)}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio-avatar,.bio p{margin-bottom:var(--spacing-0)}.bio-avatar{margin-right:var(--spacing-4);min-width:50px;border-radius:100%}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-size:var(--fontSize-2);font-family:var(--font-heading)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4);margin-left:var(--spacing-0)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.29.2"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=3d2daffdda02655a99f9d2ded68aec1f" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=3d2daffdda02655a99f9d2ded68aec1f"/><title data-react-helmet="true">Check the Mood of a Slack Channel using Machine Learning | Ruairí&#x27;s Blog</title><meta data-react-helmet="true" name="description" content="Sentiment a thought, opinion, or idea based on a feeling about a situation, or a way of thinking about something Sentiment analysis, in the context of this…"/><meta data-react-helmet="true" property="og:title" content="Check the Mood of a Slack Channel using Machine Learning"/><meta data-react-helmet="true" property="og:description" content="Sentiment a thought, opinion, or idea based on a feeling about a situation, or a way of thinking about something Sentiment analysis, in the context of this…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="ruarfff"/><meta data-react-helmet="true" name="twitter:title" content="Check the Mood of a Slack Channel using Machine Learning"/><meta data-react-helmet="true" name="twitter:description" content="Sentiment a thought, opinion, or idea based on a feeling about a situation, or a way of thinking about something Sentiment analysis, in the context of this…"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-fff8b336f7088aa14de9.js"/><link as="script" rel="preload" href="/styles-755093da0c07f4b49226.js"/><link as="script" rel="preload" href="/framework-8e528b732ab2eaadb7b7.js"/><link as="script" rel="preload" href="/app-ebae11825dc525114c50.js"/><link as="script" rel="preload" href="/commons-d9dafa7b739cb27f2739.js"/><link as="script" rel="preload" href="/cd7d5f864fc9e15ed8adef086269b0aeff617554-da6fc16db65998c8e4c0.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-9d982ded75bfbb0a31d5.js"/><link as="fetch" rel="preload" href="/page-data/slack-sentiment/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/916993862.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">Ruairí&#x27;s Blog</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Check the Mood of a Slack Channel using Machine Learning</h1><p>February 10, 2021</p></header><section itemProp="articleBody"><p><a href="https://dictionary.cambridge.org/dictionary/english/sentiment">Sentiment</a></p>
<blockquote>
<p>a thought, opinion, or idea based on a feeling about a situation, or a way of thinking about something</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Sentiment_analysis">Sentiment analysis</a>, in the context of this article, is the use of natural language processing to quantify the general opinion or mood of some text. We will keep it simple and only look at determining if some text is positive or negative. Positive being generally complimentary in nature. Negative being generally critical in nature. To add some level of (perhaps impractical) practicality we will look at analysing text from a <a href="https://slack.com/">Slack</a> channel.</p>
<p>In this article we will:</p>
<ul>
<li>Download chat history from a public slack channel (which is optional as you can really use any text)</li>
<li>Use some python tools to process and inspect the chat data</li>
<li>Use a pre-trained model to classify sentences from the chat as positive or negative</li>
<li>Train our own custom model with some training data</li>
<li>Test our own model and use it on the slack data</li>
<li>Prepare a docker image with our model so we can deploy and use it as a service</li>
</ul>
<p>If you just want to look at some code, <a href="https://github.com/ruarfff/slack-sentiment">this GitHub repository</a> has everything. The <a href="https://jupyter.org">jupyter notebook</a> in it also includes a lot of the instructions from here. In this article we will look at all the steps in excruciating detail so we really understand how it all works.</p>
<h2>Setup</h2>
<p>The easiest thing to do it the clone <a href="https://github.com/ruarfff/slack-sentiment">this GitHub repository</a>. It is using <a href="https://packaging.python.org/tutorials/managing-dependencies/#managing-dependencies">pipenv</a> to manage dependencies so if you follow the <a href="https://github.com/ruarfff/slack-sentiment/blob/main/README.md">Readme</a> and you have a recent version of <a href="https://www.python.org">python</a> as well as <a href="https://pipenv-fork.readthedocs.io/en/latest/">pipenv</a> installed, you should be good to go.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> clone git@github.com:ruarfff/slack-sentiment.git

<span class="token builtin class-name">cd</span> slack-sentiment

pipenv <span class="token function">sync</span> --dev

pipenv run notebook</code></pre></div>
<p>The example is mostly run in a <a href="https://jupyter.org">jupyter notebook</a>. Of course feel free to use your own setup instead and copy code from here as needed. If you don’t want to use <code class="language-text">pipenv</code> you can also install all the dependencies listed in the Pipfile using pip directly.</p>
<p>e.g.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">pip <span class="token function">install</span> jupyter slack-sdk nltk numpy pandas matplotlib</code></pre></div>
<h2>Get Data from a Slack Channel</h2>
<p>I know I don’t need to say this but obviously be careful and understand the sensitivity of your slack data. I ran this against a slack channel with friends. I used slack as I thought it was a nice example for taking data from an arbitrary source and processing it. It was also a fun example to use.</p>
<p>I won’t go into too much detail here as the <a href="https://api.slack.com">slack documentation</a> is good but here’s a brief explanation of how to get the chat history for a channel.</p>
<p>You will need to get the ID for the channel and a token to make a request to the slack api.</p>
<p><strong>To get the slack channel ID:</strong></p>
<p>There is probably an easier way but the one I use is to right click the channel name in the channel menu and select “Copy link”. The link will look something like <code class="language-text">https://your-org.slack.com/archives/C12345</code>. The channel ID is the last piece. That’s <code class="language-text">C12345</code> in the example URL.</p>
<p><strong>To get a token:</strong></p>
<p>Setup a bot user following these instructions <a href="https://api.slack.com/bot-users">https://api.slack.com/bot-users</a>.
The OAuth scope must allow <code class="language-text">channels:history</code>. Add the bot user to the channel you wish to read messages from. The channel should be public. I have not tested any of this with private channels.</p>
<p>The next section assumes you have 2 environment variables:</p>
<p><code class="language-text">SLACK_SENTIMENT_BOT_TOKEN</code> - The bot token we setup previously.</p>
<p><code class="language-text">SLACK_SENTIMENT_CHANNEL_ID</code> - The channel ID we retrieved previously.</p>
<p>If you are not familiar with how to setup environment variables, feel free to just replace those values with hardcoded values but obviously be careful not to accidentally push your token up to Github or something like that :)
Incidentally, I do have a <a href="https://dev.to/ruarfff/managing-local-app-secrets-and-sharing-secrets-with-your-team-34m1">post on managing secrets while developing</a> if you’re interested.</p>
<p>The following python example gets all the slack messages for a channel and prints them:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Get a timestamp for 7 days ago in a weird way. I need to lean more python.</span>
<span class="token comment"># This is only used if we want to limit how far back in time we go for fetching slack messages.</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta<span class="token punctuation">,</span> datetime<span class="token punctuation">,</span> date
today <span class="token operator">=</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span>
week_ago <span class="token operator">=</span> today <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
week_ago_timestamp <span class="token operator">=</span> <span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>combine<span class="token punctuation">(</span>week_ago<span class="token punctuation">,</span> datetime<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> datetime<span class="token punctuation">(</span><span class="token number">1970</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> os
<span class="token comment"># Import WebClient from Python SDK (github.com/slackapi/python-slack-sdk)</span>
<span class="token keyword">from</span> slack_sdk <span class="token keyword">import</span> WebClient
<span class="token keyword">from</span> slack_sdk<span class="token punctuation">.</span>errors <span class="token keyword">import</span> SlackApiError
<span class="token keyword">import</span> json
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

token <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"SLACK_SENTIMENT_BOT_TOKEN"</span><span class="token punctuation">)</span>
channel_id <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"SLACK_SENTIMENT_CHANNEL_ID"</span><span class="token punctuation">)</span>
page_size <span class="token operator">=</span> <span class="token number">100</span>

client <span class="token operator">=</span> WebClient<span class="token punctuation">(</span>token<span class="token operator">=</span>token<span class="token punctuation">)</span>

conversation_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
has_more <span class="token operator">=</span> <span class="token boolean">True</span>
cursor <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> has_more<span class="token punctuation">:</span>
        has_more <span class="token operator">=</span> <span class="token boolean">False</span>
        result <span class="token operator">=</span> client<span class="token punctuation">.</span>conversations_history<span class="token punctuation">(</span>
            channel<span class="token operator">=</span>channel_id<span class="token punctuation">,</span>
            limit<span class="token operator">=</span>page_size<span class="token punctuation">,</span>
            cursor<span class="token operator">=</span>cursor
            <span class="token comment"># If you wanted to limit to the last 7 days uncomment the next line and put a , after cursor on the previous line</span>
            <span class="token comment"># oldest = week_ago_timestamp</span>
        <span class="token punctuation">)</span>
        conversation_history<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"messages"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        has_more <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'has_more'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">'response_metadata'</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Still fetching'</span><span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'response_metadata'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'next_cursor'</span><span class="token punctuation">]</span>
            sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token comment"># Avoid being rate limited</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done!'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> SlackApiError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error getting conversations: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>conversation_history<span class="token punctuation">)</span></code></pre></div>
<h2>Prepare the Data</h2>
<p>In data engineering a huge amount of time is spent organising and cleaning data. Slack is just one example of a wide variety of extremely versatile data sources. In the following example we will gently dip our toes into that kind of work. Let’s take our slack messages and clean them up a bit. Let’s also break them up into sentences and words.</p>
<p>I will just drop our main data cleaning function in here and then go through it line by line.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> nltk
<span class="token keyword">from</span> nltk<span class="token punctuation">.</span>tokenize <span class="token keyword">import</span> word_tokenize<span class="token punctuation">,</span> sent_tokenize
<span class="token keyword">import</span> itertools

<span class="token keyword">def</span> <span class="token function">get_test_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    all_text <span class="token operator">=</span> <span class="token punctuation">[</span>message<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> message <span class="token keyword">in</span> conversation_history <span class="token keyword">if</span> <span class="token string">'text'</span> <span class="token keyword">in</span> message<span class="token punctuation">]</span>
    tokenized_text <span class="token operator">=</span> <span class="token punctuation">[</span>sent_tokenize<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token keyword">for</span> text <span class="token keyword">in</span> all_text<span class="token punctuation">]</span>
    sentences <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token operator">*</span>tokenized_text<span class="token punctuation">)</span><span class="token punctuation">)</span>
    tokenized_words <span class="token operator">=</span> <span class="token punctuation">[</span>word_tokenize<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span> <span class="token keyword">for</span> sentence <span class="token keyword">in</span> sentences<span class="token punctuation">]</span>
    words <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token operator">*</span>tokenized_words<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>sentences<span class="token punctuation">,</span> words<span class="token punctuation">)</span>

main_sentences<span class="token punctuation">,</span> main_words <span class="token operator">=</span> get_test_data<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>Line by line</strong></p>
<p><code class="language-text">all_text = [message['text'] for message in conversation_hissory if 'text' in message]</code></p>
<p>The response from the Slack API stores the text from the slack conversation in a field called text. We don’t want any of the other information like the user who posted it or the time it was posted. That line iterates over each response and extracts the text to a new list.</p>
<p><code class="language-text">tokenized_text = [sent_tokenize(text) for text in all_text]</code></p>
<p>Iterate over all the text and use NLTK’s sentence tokeniser to split the text up into sentences.</p>
<p><code class="language-text">sentences = list(itertools.chain(*tokenized_text))</code></p>
<p>The previous line actually gave us a list of lists since <code class="language-text">sent_tokenize</code> returns a list. This line flattens that to a single list.</p>
<p><code class="language-text">tokenized_words = [word_tokenize(sentence) for sentence in sentences]</code></p>
<p>This line used NLTK’s word tokeniser to split each slack message up into words.</p>
<p><code class="language-text">words = list(itertools.chain(*tokenized_words))</code></p>
<p><code class="language-text">word_tokenize</code> returns a list so we ended up with a list of lists. This line flattens that to a single list.</p>
<p><code class="language-text">return (sentences, words)</code></p>
<p>Here we are returning a <a href="https://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuple">tuple</a> containing the sentences and words. In this case, a tuple is just a handy way to return multiple things from a function without going to the bother of creating a new data type for it.</p>
<p><code class="language-text">main_sentences, main_words = get_test_data()</code></p>
<p>We then assign the values from the returned tuple to 2 new variables. We will use these variables again throughout the rest of this example.</p>
<h2>Use a Pre-trained Model</h2>
<p>We will be training our own model and we will look at how to deploy our own trained model soon. First it could be useful to look at an example of using a pre-trained model. We will use NLTK’s <a href="https://www.nltk.org/api/nltk.sentiment.html">SentimentIntensityAnalyzer</a>.</p>
<p>You can import and setup the model like so:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> nltk <span class="token keyword">import</span> download
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> nltk<span class="token punctuation">.</span>sentiment <span class="token keyword">import</span> SentimentIntensityAnalyzer

<span class="token comment"># The SentimentIntensityAnalyzer model needs us to pull down the vader_lexicon</span>
download<span class="token punctuation">(</span><span class="token string">'vader_lexicon'</span><span class="token punctuation">)</span>

sia <span class="token operator">=</span> SentimentIntensityAnalyzer<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>Then you can take one of the sentences from our slack “corpus” and pass it in:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">sia<span class="token punctuation">.</span>polarity_scores<span class="token punctuation">(</span>main_sentences<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"compound"</span><span class="token punctuation">]</span></code></pre></div>
<p>That will return a number. If the number is greater than 0 then we say the sentence has a positive sentiment.</p>
<p>Here’s an example that checks each sentence and draws a pie chart showing the ratio of positive vs negative.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">num_pos <span class="token operator">=</span> <span class="token number">0</span>
num_neg <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">def</span> <span class="token function">is_positive</span><span class="token punctuation">(</span>sentence<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> sia<span class="token punctuation">.</span>polarity_scores<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"compound"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span>

<span class="token keyword">for</span> s <span class="token keyword">in</span> main_sentences<span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_positive<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        num_pos <span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        num_neg <span class="token operator">+=</span> <span class="token number">1</span>

labels <span class="token operator">=</span> <span class="token string">'Positive'</span><span class="token punctuation">,</span> <span class="token string">'Negative'</span>
sizes <span class="token operator">=</span> <span class="token punctuation">[</span>num_pos<span class="token punctuation">,</span> num_neg<span class="token punctuation">]</span>

fig1<span class="token punctuation">,</span> ax1 <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>sizes<span class="token punctuation">,</span> labels<span class="token operator">=</span>labels<span class="token punctuation">,</span> autopct<span class="token operator">=</span><span class="token string">'%1.1f%%'</span><span class="token punctuation">,</span>
        shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> startangle<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>Example output:</strong></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 333px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4607b4e1790fd5a65197a704f1b44c75/24c7e/sent-example-pie.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLUlEQVQoz22Tz2sTQRTHh0b04FXwoPUHmqZNYkARwYMH/wI9SwUjqHhJaLGb2TSbjfFgeylUFFKkB8GimFSTgLSk/gKliIo92AZ7CLb5QaQSbTXZZHdn5pnZTciP9rGws/v4zPf73rxB0BmsudAI1dQaMNL4zRhsC8QzrJHRKX9/zv2+HvtqnVycmRDg4UWSmoA/eZ6mZAfYDAOEsberPULc4n2Ghl8+EAfBv18fOQh3z8D3N4YD2gHXVVVVrdbU+se996vIE7XgxB5/AonzEckNoWN6+CQEjoM8APlvXTwihKxns4VcdmWtsE9KIl+ix5+04DjC85GAG+SjuuyEsAvwIZgeNGDWYZsYju+/SyNvdJfnEboxZRFmEZ6bClxpwLKDK4ccUEy3ixuwsdm1J4toaNYiJpAvvhs/R3ghErjahO1w+wT4eiG90N65Fux+/IHD3PMLhFPnxMmN4GmQ+5nsYEE7M+GVFOuGDdvjc0vIG+Otwq8u+Me2gi6Q++pWy2L/D4+1JNi47cJyt21qKC+vF/eOxBB+fXNUZEEblQcoL9XOn7CL4cMwfennxq9MJpPN5jRNa52zyQ9FP97yuiFsJSEnMUvl1bpAsrFRK6x9URn829qsVBRKaQs2Z6xS08ozw7rQy8QjIFlB6uMn7DtAgk59KbHDkLSmmrG6vkJo6VNyM3K5fOesEjqljJ9XngpqPm02mTWjG26/ABqltb+laqmoV8u0uff2i/EfZHqTptSp0HEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Sentiment pie chart showing neg and pos"
        title="Sentiment pie chart showing neg and pos"
        src="/static/4607b4e1790fd5a65197a704f1b44c75/24c7e/sent-example-pie.png"
        srcset="/static/4607b4e1790fd5a65197a704f1b44c75/c26ae/sent-example-pie.png 158w,
/static/4607b4e1790fd5a65197a704f1b44c75/6bdcf/sent-example-pie.png 315w,
/static/4607b4e1790fd5a65197a704f1b44c75/24c7e/sent-example-pie.png 333w"
        sizes="(max-width: 333px) 100vw, 333px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>This was just to show an example but it might also demonstrate the importance of the next step. The results we got from the data in its current state may not have been very accurate. Let’s see what we can do to clean up the data and reduce the noise in there.</p>
<h2>Clean the Data</h2>
<p>From this point on we won’t be using the sentences from our dataset anymore. We will focus on the individual words instead. Let’s create a frequency distribution graph of the words. This is also to demonstrate how many of them are more or less useless.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> nltk<span class="token punctuation">.</span>probability <span class="token keyword">import</span> FreqDist

fdist <span class="token operator">=</span> FreqDist<span class="token punctuation">(</span>main_words<span class="token punctuation">)</span>

fdist<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>cumulative<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ba090e062de841af01e288c0375f4f48/3c5de/sent-word-plot.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJ0lEQVQoz5WRi26DMAxF+/+fOE1oKqVNSEIeJg/evYGug2qdtCtjIcixr53TsizDMDDGjHPGOmfxvJVd/8YYl1WnFR5rzm6Nk86nkBXfyHu/5T08gGWadBv6LkHdG4FERvUdPI6cM2lJkO9S/AMGdoCnaVJKYWYfwkW3/b/gcRyFEJzzGELZkCbwKcRcI5c5CtNu+cc2eHTu8umuqI3zcRqGvu+fDdN3vHZ+LAydYwQB84Uw0rWasNiEAoihfwQ2gnyA53lGZ3zK3eA5JWY9t/6q6dLkEM4rCojakPWYb2cbghnc/jY8bk2KWgkhlUSqhSjKW1Gxz/L68VWer3k7B3gTYCICb6y9rcI71nM5nz25lpzRjTUaTn+BXySlqqoKdznN8xPY6w5JMbRoId8V7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Word plot"
        title="Word plot"
        src="/static/ba090e062de841af01e288c0375f4f48/3c5de/sent-word-plot.png"
        srcset="/static/ba090e062de841af01e288c0375f4f48/c26ae/sent-word-plot.png 158w,
/static/ba090e062de841af01e288c0375f4f48/6bdcf/sent-word-plot.png 315w,
/static/ba090e062de841af01e288c0375f4f48/3c5de/sent-word-plot.png 472w"
        sizes="(max-width: 472px) 100vw, 472px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>If you run that, you probably see a lot of words like “I”, “if”, “me” etc. Also maybe some punctuations. These are not too useful for our analysis.</p>
<p>Let’s look at a helper function to clean that up.</p>
<p>When we start training our own model we will be using a method where we store each word along with its frequency and train a model using those features (the words and frequency) along with labels (positive and negative).</p>
<p>We will need 2 functions. One to clean our data, removing noise such as meaningless words, punctuation etc. Then we need a function to convert a stream of words into a hashmap with words and number of occurences.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Assumes you previously had from nltk import download</span>
download<span class="token punctuation">(</span><span class="token string">'stopwords'</span><span class="token punctuation">)</span>
download<span class="token punctuation">(</span><span class="token string">'names'</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> nltk<span class="token punctuation">.</span>corpus <span class="token keyword">import</span> stopwords<span class="token punctuation">,</span> names
<span class="token keyword">from</span> string <span class="token keyword">import</span> punctuation

<span class="token comment"># A large set of names. We lowercase here as we will lowercase our own data first too</span>
name_words <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>n<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> names<span class="token punctuation">.</span>words<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># A set of stopwords provided by NLTK (if, as etc.)</span>
stop_words <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>stopwords<span class="token punctuation">.</span>words<span class="token punctuation">(</span><span class="token string">"english"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">clean_words</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token punctuation">[</span>w<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> words <span class="token keyword">if</span> w<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">if</span> w <span class="token keyword">not</span> <span class="token keyword">in</span> stop_words <span class="token keyword">and</span> w <span class="token keyword">not</span> <span class="token keyword">in</span> name_words <span class="token keyword">and</span> w <span class="token keyword">not</span> <span class="token keyword">in</span> punctuation<span class="token punctuation">]</span></code></pre></div>
<p>Let’s split <code class="language-text">clean_words</code> and look at each bit.</p>
<p><code class="language-text">w for w in [w.lower() for w in words if w.isalpha()]</code></p>
<p>Go through all the words in the words array which is passed as an argument to our function. Check if a word is alphanumeric (no special characters we can’t use). Then extract that out to a new list.</p>
<p><code class="language-text">if w not in stop_words and w not in name_words and w not in punctuation</code></p>
<p>This filters our list. We filter out all those stop words. We filter out any names and punctuations. This gives us a cleaner set to work with.</p>
<p>You may be wondering what we are doing here? How can we analyse the data without context? We are going to use a pretty basic model. We will more or less be taking bags of words with labels and training a model with them. Then we will feed other bags of words to the model and have it make a guess at the sentiment. It doesn’t know anything about actual sentences. It mostly goes off of word frequency.</p>
<p>To help us shape our data even more for later use we need one more function.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">word_counts</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">:</span>
    counts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
        counts<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> counts<span class="token punctuation">.</span>get<span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">return</span> counts</code></pre></div>
<p>This takes our words and puts them into a HashMap where the key is the word and the value is the number of times that word has shown up in our data.</p>
<p>Now we can get the data ready.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">main_words <span class="token operator">=</span> clean_words<span class="token punctuation">(</span>main_words<span class="token punctuation">)</span>
main_words_counts <span class="token operator">=</span> word_counts<span class="token punctuation">(</span>main_words<span class="token punctuation">)</span></code></pre></div>
<p>You can create a new distribution graph and see if it looks better.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">fdist <span class="token operator">=</span> FreqDist<span class="token punctuation">(</span>main_words<span class="token punctuation">)</span>
fdist<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>cumulative<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 419px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c3a150f1b0ffd0bc1eaac152367cd581/d587d/sent-word-plot-2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABg0lEQVQoz4WS63KCMBCFff9HK4jwR8dROq0iN4FAyIUQwB4IWm213RmWhOXby0kWl8tFKVWWZZARyjhnL41fg5RSeIALPCCLPC+YPBCORO0L67rOLJqmeYDzohi6NqU8KVmv20Y9Ma21WUgpv+G6rvM8Rz6h1D4tayGVan6bqTn+JsQMY1NMhnyXXmcVD0k96PE/+S+cJGmSJIQQE0ZJFE8qBrJrpyb/gI3UqHwLc9lEhCFFUFAmZHvln8B4sDIzmzAGRk0hm6LmflpllENCNR2DnGZ5gEe17+DbtBAXK7SQUVYx0ekxRzt+vFMbpw8YZN/38DiS2Wvdd10lmhNhIeFByQ9FndWCijsYOp/P5ziO4SFeFEXw2IZhGJxOaZzkCEDW9ByE0ebjuHn/xCUb4WEYDO+6rm3bjuOs12vLsjzP2+122+3WXi7fLNv1vJXjuKsVXu/+Hn3NlWG4emi+qip4JEJNzGxCvu+jC2zNlUZT0M6EZviHmXaQ63A8Zln2NAr7AuDHILyx5rVLAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Updated work plot"
        title="Updated work plot"
        src="/static/c3a150f1b0ffd0bc1eaac152367cd581/d587d/sent-word-plot-2.png"
        srcset="/static/c3a150f1b0ffd0bc1eaac152367cd581/c26ae/sent-word-plot-2.png 158w,
/static/c3a150f1b0ffd0bc1eaac152367cd581/6bdcf/sent-word-plot-2.png 315w,
/static/c3a150f1b0ffd0bc1eaac152367cd581/d587d/sent-word-plot-2.png 419w"
        sizes="(max-width: 419px) 100vw, 419px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>Training Our Own Model</h2>
<p>Now we will train a model so we can call ourselves AI scientists. We will use something called a <a href="https://en.wikipedia.org/wiki/Naive_Bayes_classifier">Naive Bayes classifier</a>. NLTK provides one for us to use. Our main job here really is to provide a lot of labelled data to train the model and the library does the rest. Over time as we become more familiar with the data we might figure out clever ways of modifying it to improve our model. We will look briefly at that concept but will not go into it in any depth here.</p>
<p>In <a href="https://github.com/ruarfff/slack-sentiment">the sample repo</a> for this there are some data files. These can also be downloaded from the <a href="https://archive.ics.uci.edu/ml/datasets/Sentiment+Labelled+Sentences">Sentiment Labelled Sentences Data Set</a>. We will also use some data provided by NLTK.</p>
<p>First we load the files from the repo using the <a href="https://pandas.pydata.org">pandas library</a>.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

amazon <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'sentiment_labelled_sentences/amazon_cells_labelled.txt'</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">,</span> <span class="token string">'sentiment'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
imdb <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'sentiment_labelled_sentences/imdb_labelled.txt'</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">,</span> <span class="token string">'sentiment'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
yelp <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'sentiment_labelled_sentences/yelp_labelled.txt'</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">,</span> <span class="token string">'sentiment'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span></code></pre></div>
<p>Those files must be located in a folder called <code class="language-text">sentiment_labelled_sentences</code> in the same directory as the python script if using the code as is.</p>
<p>Now we download the movie review corpus provided by NLTK.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Assumes you previously had from nltk import download</span>
download<span class="token punctuation">(</span><span class="token string">'movie_reviews'</span><span class="token punctuation">)</span></code></pre></div>
<p>The next step is to take all that data and split it into 2 lists. One list of negative reviews. The other of positive reviews.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">reviews <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span>amazon<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> <span class="token operator">*</span>imdb<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> <span class="token operator">*</span>yelp<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">]</span>
sentiment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span>amazon<span class="token punctuation">[</span><span class="token string">'sentiment'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> <span class="token operator">*</span>imdb<span class="token punctuation">[</span><span class="token string">'sentiment'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> <span class="token operator">*</span>yelp<span class="token punctuation">[</span><span class="token string">'sentiment'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">]</span>

positive_reviews <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
negative_reviews <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">from</span> nltk<span class="token punctuation">.</span>corpus <span class="token keyword">import</span> movie_reviews

<span class="token comment"># Process the corpus data which is split into files with IDs of pos and neg</span>
<span class="token keyword">for</span> f <span class="token keyword">in</span> movie_reviews<span class="token punctuation">.</span>fileids<span class="token punctuation">(</span><span class="token string">'pos'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    positive_reviews<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">(</span>clean_words<span class="token punctuation">(</span>movie_reviews<span class="token punctuation">.</span>words<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'pos'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> f <span class="token keyword">in</span> movie_reviews<span class="token punctuation">.</span>fileids<span class="token punctuation">(</span><span class="token string">'neg'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    negative_reviews<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">(</span>clean_words<span class="token punctuation">(</span>movie_reviews<span class="token punctuation">.</span>words<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'neg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Process the data we extracted from files into reviews and sentiment lists with matching indexes</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> r <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>reviews<span class="token punctuation">)</span><span class="token punctuation">:</span>
    review_words <span class="token operator">=</span> word_tokenize<span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    <span class="token keyword">if</span> sentiment<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        positive_reviews<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">(</span>clean_words<span class="token punctuation">(</span>review_words<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'pos'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        negative_reviews<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">(</span>clean_words<span class="token punctuation">(</span>review_words<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'neg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Now that we have all that data prepared we can train a model.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> nltk<span class="token punctuation">.</span>classify <span class="token keyword">import</span> NaiveBayesClassifier

<span class="token comment"># We will use 80% of the data set for training and 20% for testing</span>
split_pct <span class="token operator">=</span> <span class="token number">.80</span>

pos_split <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>positive_reviews<span class="token punctuation">)</span><span class="token operator">*</span>split_pct<span class="token punctuation">)</span>
neg_split <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>positive_reviews<span class="token punctuation">)</span><span class="token operator">*</span>split_pct<span class="token punctuation">)</span>

train_set <span class="token operator">=</span> positive_reviews<span class="token punctuation">[</span><span class="token punctuation">:</span>pos_split<span class="token punctuation">]</span> <span class="token operator">+</span> negative_reviews<span class="token punctuation">[</span><span class="token punctuation">:</span>neg_split<span class="token punctuation">]</span>
test_set <span class="token operator">=</span> positive_reviews<span class="token punctuation">[</span>pos_split<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> negative_reviews<span class="token punctuation">[</span>neg_split<span class="token punctuation">:</span><span class="token punctuation">]</span>

model <span class="token operator">=</span> NaiveBayesClassifier<span class="token punctuation">.</span>train<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span></code></pre></div>
<p>Here we split the data into training and testing sets:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">split_pct <span class="token operator">=</span> <span class="token number">.80</span>

pos_split <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>positive_reviews<span class="token punctuation">)</span><span class="token operator">*</span>split_pct<span class="token punctuation">)</span>
neg_split <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>positive_reviews<span class="token punctuation">)</span><span class="token operator">*</span>split_pct<span class="token punctuation">)</span>

train_set <span class="token operator">=</span> positive_reviews<span class="token punctuation">[</span><span class="token punctuation">:</span>pos_split<span class="token punctuation">]</span> <span class="token operator">+</span> negative_reviews<span class="token punctuation">[</span><span class="token punctuation">:</span>neg_split<span class="token punctuation">]</span>
test_set <span class="token operator">=</span> positive_reviews<span class="token punctuation">[</span>pos_split<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> negative_reviews<span class="token punctuation">[</span>neg_split<span class="token punctuation">:</span><span class="token punctuation">]</span></code></pre></div>
<p>It’s hard to know what the optimal split is but I have
<a href="https://stackoverflow.com/questions/13610074/is-there-a-rule-of-thumb-for-how-to-divide-a-dataset-into-training-and-validation">read some discussion indicating 80/20 might be a good start</a>.</p>
<p>Once we have our data read, the actual training of the model is simply calling one function provided by NLTK:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">model <span class="token operator">=</span> NaiveBayesClassifier<span class="token punctuation">.</span>train<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span></code></pre></div>
<p>At this point we can start using the model to classify all that data we prepared from slack.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">model<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>main_words_counts<span class="token punctuation">)</span></code></pre></div>
<p>It is a good idea for us to use our test data and determine the accuracy of the model first though.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> nltk<span class="token punctuation">.</span>classify<span class="token punctuation">.</span>util <span class="token keyword">import</span> accuracy

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> accuracy<span class="token punctuation">(</span>model<span class="token punctuation">,</span> test_set<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>When I checked the model it was coming in between 65% and 70% accurate. At this point there’s some work to do to improve the model. I am not going to go into that now except to provide some basic pointers. Perhaps in a follow up article I will get into it. For now let’s look at some things you can do to see where things need improving.</p>
<p>We can gather all the guesses that went wrong from the test data.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> label<span class="token punctuation">)</span> <span class="token keyword">in</span> test_set<span class="token punctuation">:</span>
    guess <span class="token operator">=</span> model<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> guess <span class="token operator">!=</span> label<span class="token punctuation">:</span>
        errors<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> guess<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>Looking at the places where guesses went wrong, maybe we can modify the data to improve the training. Maybe take variations on a word and ad that to the training set.</p>
<p>We can see which features our model believes are most informative.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">model<span class="token punctuation">.</span>show_most_informative_features<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>By getting a better understanding of how the model learns, we improve our ability to know how to train it. It’s difficult but also interesting.</p>
<h2>Deploying a Model</h2>
<p>Now we can save the model. You could push this model up somewhere and pull it in to some other useful location. For an example of how to deploy this model in a web service using docker please see the <a href="https://github.com/ruarfff/slack-sentiment/blob/main/README.md">Readme for this project</a>.</p>
<p>You can imagine some process whereby you train a model at some interval or on some event and push the model to a location from which it gets pulled down for use in another application or service.</p>
<p>Write the model to a file:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pickle

model_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'.models/sentiment_classifier.pickle'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>model<span class="token punctuation">,</span> model_file<span class="token punctuation">)</span>
model_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>For a full example of how to then use that model in a web service please make sure to look at the <a href="https://github.com/ruarfff/slack-sentiment">Example Repository</a>.</p>
<p>A quick example of how if might work follows:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">model_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'.models/sentiment_classifier.pickle'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
model <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_file<span class="token punctuation">)</span>
model_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> accuracy<span class="token punctuation">(</span>model<span class="token punctuation">,</span> test_set<span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>show_most_informative_features<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>main_words_counts<span class="token punctuation">)</span></code></pre></div>
<p>That’s it. Hopefully this has been useful. Thank you for reading.</p>
<h2>References</h2>
<p>I wrote this post as I was studying material from the following places:</p>
<p><a href="https://www.manning.com/liveproject/training-and-deploying-an-ml-model-as-a-microservice">Training and Deploying an ML Model as a Microservice</a></p>
<p><a href="https://www.datacamp.com/community/tutorials/text-analytics-beginners-nltk">Text Analytics for Beginners using NLTK</a></p>
<p><a href="https://realpython.com/python-nltk-sentiment-analysis/">Sentiment Analysis: First Steps With Python’s NLTK Library</a></p>
<p><a href="https://medium.com/dev-genius/training-an-ml-model-for-sentiment-analysis-in-python-63b6b8c68792">Training an ML Model for Sentiment Analysis in Python</a></p></section><hr/><footer><div class="bio"><div class="bio-avatar gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQCBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAG+S6MuppRysEXRFP8A/8QAGRAAAwEBAQAAAAAAAAAAAAAAAQIDABEi/9oACAEBAAEFAn6B2s25mz+n0aPSlyRpMXn/AP/EABcRAQEBAQAAAAAAAAAAAAAAAAEQITH/2gAIAQMBAT8BDIcn/8QAFhEBAQEAAAAAAAAAAAAAAAAAEAEx/9oACAECAQE/AS6f/8QAHxAAAQIGAwAAAAAAAAAAAAAAAQACEBESISIxI0Fh/9oACAEBAAY/Asdlcki3yE0G3hkelUDdBx2v/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFBgf/aAAgBAQABPyFECcr0Sos7dKSMUKo+QZTiO44vQsHJnwcM3ujNT//aAAwDAQACAAMAAAAQ8NfD/8QAFhEBAQEAAAAAAAAAAAAAAAAAAREg/9oACAEDAQE/EAacP//EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAgEBPxBW4P/EABsQAQADAQEBAQAAAAAAAAAAAAEAESFBYYGR/9oACAEBAAE/EGCUpfYsL15S0Pa6TSWGRLDrZwkRu+q/kpCiqwYGzaIyBKUZXuSoziKJ/9k=" alt="Ruairí O&#x27;Brien" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/8c0daa5d2f857b531fed1e4dba23ef9c/340ed/profile-pic.jpg 1x,
/static/8c0daa5d2f857b531fed1e4dba23ef9c/32ce1/profile-pic.jpg 1.5x,
/static/8c0daa5d2f857b531fed1e4dba23ef9c/04d41/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/8c0daa5d2f857b531fed1e4dba23ef9c/340ed/profile-pic.jpg 1x,
/static/8c0daa5d2f857b531fed1e4dba23ef9c/32ce1/profile-pic.jpg 1.5x,
/static/8c0daa5d2f857b531fed1e4dba23ef9c/04d41/profile-pic.jpg 2x" src="/static/8c0daa5d2f857b531fed1e4dba23ef9c/340ed/profile-pic.jpg" alt="Ruairí O'Brien" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Ruairí O&#x27;Brien</strong> <!-- -->who wants to be good.<!-- --> <a href="https://twitter.com/ruarfff">You can follow me on Twitter</a></p></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/github-codespaces/">← <!-- -->Using Devcontainer With GitHub Codespaces</a></li><li></li></ul></nav></main><footer>© <!-- -->2021<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J8S0YBL54N"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-J8S0YBL54N', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/slack-sentiment/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-78cdc6a84a6e659c51c0.js"],"app":["/app-ebae11825dc525114c50.js"],"component---src-pages-404-js":["/component---src-pages-404-js-994c3193491059bf8b6b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-5143a6c272517200ccdd.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-811c8e0cf309df5e3046.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-9d982ded75bfbb0a31d5.js"]};/*]]>*/</script><script src="/polyfill-78cdc6a84a6e659c51c0.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-9d982ded75bfbb0a31d5.js" async=""></script><script src="/cd7d5f864fc9e15ed8adef086269b0aeff617554-da6fc16db65998c8e4c0.js" async=""></script><script src="/commons-d9dafa7b739cb27f2739.js" async=""></script><script src="/app-ebae11825dc525114c50.js" async=""></script><script src="/framework-8e528b732ab2eaadb7b7.js" async=""></script><script src="/styles-755093da0c07f4b49226.js" async=""></script><script src="/webpack-runtime-fff8b336f7088aa14de9.js" async=""></script></body></html>